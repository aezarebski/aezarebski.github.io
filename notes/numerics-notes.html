<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2025-06-04 Wed 16:31 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>numerics-aez-notes</title>
<meta name="author" content="Alexander E. Zarebski" />
<meta name="generator" content="Org Mode" />
<style type="text/css">
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
<link rel="icon" type="image/png" href="../resources/nicemacs-favicon.png">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/milligram/1.4.1/milligram.css">
<link rel="stylesheet" href="../microgram.css">
<script>
  window.MathJax = {
    tex: {
      ams: {
        multlineWidth: '85%'
      },
      tags: 'ams',
      tagSide: 'right',
      tagIndent: '.8em'
    },
    chtml: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    svg: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    output: {
      font: 'mathjax-modern',
      displayOverflow: 'overflow'
    }
  };
</script>

<script
  id="MathJax-script"
  async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
</head>
<body>
<div id="content" class="content">
<h1 class="title">numerics-aez-notes</h1>
<p>
<a href="../index.html">Home</a>
</p>

<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org77a26d6">Linear algebra</a></li>
<li><a href="#org7cb925e">Numerics notes</a>
<ul>
<li><a href="#org38dfad7">Numbers</a></li>
<li><a href="#org37e891e">Numeric differentiation</a></li>
<li><a href="#orgd78232a">Mathematical optimisation</a></li>
<li><a href="#orgc8e0717">LogSumExp function</a></li>
<li><a href="#org180c536">Combinatoric functions</a></li>
<li><a href="#org0db2aa5">Factorial</a></li>
<li><a href="#orga5adf80">Pochhammer symbol</a></li>
<li><a href="#org7877b20">Computational complexity</a></li>
<li><a href="#org2f74878">Caching results</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-org77a26d6" class="outline-2">
<h2 id="org77a26d6">Linear algebra</h2>
<div class="outline-text-2" id="text-org77a26d6">
<ul class="org-ul">
<li>The <i>rank</i> of a matrix is the maximum number of linearly independent rows in
the matrix.</li>
<li>For a square matrix, the <i>trace</i> of the matrix is the sum of the elements on
the main diagonal. The trace of a matrix is equal to the sum of the
eigenvalues (counted with multiplicities).</li>
<li>The determinant of a triangular matrix is the product of the elements on its
main diagonal. For two matricies \(\mathbf{A}\) and \(\mathbf{B}\) we have
\(|\mathbf{AB}|=|\mathbf{A}||\mathbf{B}|\). For invertible matrices
\(|\mathbf{A}^{-1}|=|\mathbf{A}|^{-1}\).</li>
<li>The column space of a matrix is the space spanned by the column vectors. The
column space of a matrix \(\mathbf{A}\) consists of all the products of the
form \(\mathbf{Ax}\). The column space of \(\mathbf{A}\) is equal to the row
space of \(\mathbf{A}^{\text{T}}\).</li>
<li>Let \(\mathbf{L}\in\mathbb{R}^{n\times r}\) and
\(\mathbf{v}\in\mathbb{R}^{n}\) then
\(\mathbf{v}^{T}(\mathbf{L}\mathbf{L}^T)\mathbf{v}=(\mathbf{v}^{T}\mathbf{L})\mathbf{L}^T\mathbf{v}=(\mathbf{L}^{T}\mathbf{v})^T\mathbf{L}^T\mathbf{v}\geq0\)
so we know \(\mathbf{L}\mathbf{L}^T\) is positive semi-definite. If you add a
diagonal matrix, \(\mathbf{\sigma}\mathbf{I}\), which has positive elements on
the main diagonal, the matrix
\(\mathbf{\sigma}\mathbf{I}+\mathbf{L}\mathbf{L}^T\) is positive definite.</li>
<li>An <i>orthogonal matrix</i>, \(\mathbf{Q}\) is a real square matrix with
orthonormal rows and columns. As a consequence, the inverse of an orthogonal
matrix is its transpose: \(\mathbf{Q}^{-1}=\mathbf{Q}^{T}\). The determinant
of an orthogonal matrix is \(\pm1\).</li>
<li>The <i>QR decomposition</i> of a matrix \(\mathbf{A}\) is
\(\mathbf{A}=\mathbf{Q}\mathbf{R}\) where \(\mathbf{Q}\) is an orthogonal
matrix and \(\mathbf{R}\) is an upper triangular matrix. If \(\mathbf{A}\) is
\(m\times n\) with \(m>n\) then \(\mathbf{Q}\) is \(m\times m\) and still
orthogonal, and \(\mathbf{R}\) is \(m\times n\) with \(m-n\) rows of zeros at
the bottom.
<ul class="org-ul">
<li>The QR decomposition is useful for solving for \(\mathbf{x}\) in
\(\mathbf{A}\mathbf{x}=\mathbf{b}\). Since \(\mathbf{Q}\) is orthogonal, its
transpose is its inverse and back-substitution provides a very efficient
algorithm for solving \(\mathbf{R}\mathbf{x}=\mathbf{Q}^{T}\mathbf{b}\).</li>
</ul></li>
</ul>

<p>
If \(\mathbf{A}\) and \(\mathbf{B}\) are matrices such that
\(\mathbf{B}\mathbf{A}=\mathbf{I}\). If there is a matrix \(\mathbf{C}\) such
that \(\mathbf{A}\mathbf{C}=\mathbf{I}\), then \(\mathbf{C}=\mathbf{B}\), and so
\(\mathbf{B}\mathbf{A}=\mathbf{A}\mathbf{B}=\mathbf{I}\). To see why this is
true note
\(\mathbf{B}=\mathbf{BI}=\mathbf{B}(\mathbf{AC})=(\mathbf{BA})\mathbf{C}=\mathbf{IC}=\mathbf{C}\)
</p>
</div>
</div>
<div id="outline-container-org7cb925e" class="outline-2">
<h2 id="org7cb925e">Numerics notes</h2>
<div class="outline-text-2" id="text-org7cb925e">
</div>
<div id="outline-container-org38dfad7" class="outline-3">
<h3 id="org38dfad7">Numbers</h3>
<div class="outline-text-3" id="text-org38dfad7">
<p>
IEEE-754 compliant double precision numbers have a precision of about
16 decimal places.
</p>

<ul class="org-ul">
<li>There is a clever trick used by <a href="https://doi.org/10.3390/v14081648">Scire <i>et al</i> (2022)</a> to avoid
numerical underflow when solving a linear system of differential
equations (which represent a probability distribution).</li>
</ul>
</div>
</div>
<div id="outline-container-org37e891e" class="outline-3">
<h3 id="org37e891e">Numeric differentiation</h3>
<div class="outline-text-3" id="text-org37e891e">
<p>
The following functions use a five-point stencil to compute first and second
derivatives and have an error of order \(h^4\)
</p>

<div class="org-src-container">
<pre class="src src-haskell">firstDerivative :: Floating a =&gt; a -&gt; (a -&gt; a) -&gt; a -&gt; a
firstDerivative h f x =
  (-f (x + 2 * h) + 8 * f (x + h) - 8 * f (x - h) + f (x - 2 * h)) / (12 * h)

secondDerivative :: Floating a =&gt; a -&gt; (a -&gt; a) -&gt; a -&gt; a
secondDerivative h f x =
  (-f (x + 2 * h) + 16 * f (x + h) - 30 * f x + 16 * f (x - h) - f (x - 2 * h)) / (12 * h ** 2)
</pre>
</div>
</div>
<div id="outline-container-orga364b3d" class="outline-4">
<h4 id="orga364b3d">Gradient</h4>
<div class="outline-text-4" id="text-orga364b3d">
<p>
The <code>firstDerivative</code> function above can then be used to numerically evaluate
the gradient
</p>

<div class="org-src-container">
<pre class="src src-haskell">-- | The gradient vector computed using 'firstDerivative'.
gradient :: Floating a =&gt; a -&gt; ([a] -&gt; a) -&gt; [a] -&gt; [a]
gradient h f x =
  let n = length x
      es = [replicate (i-1) 0 ++ [1] ++ replicate (n-i) 0 | i &lt;- [1..n]]
      g e d = f [xi + d * ei | (xi,ei) &lt;- zip x e]
  in [firstDerivative h (g e) 0.0 | e &lt;- es]
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgd78232a" class="outline-3">
<h3 id="orgd78232a">Mathematical optimisation</h3>
<div class="outline-text-3" id="text-orgd78232a">
</div>
<div id="outline-container-org043635a" class="outline-4">
<h4 id="org043635a">Nelder-Mead</h4>
<div class="outline-text-4" id="text-org043635a">
<p>
The Nelder-Mead algorithm is a gradient free method which is a simple way to get
a rough estimate. The <span class="underline">rule of thumb</span> for the number of iterations to use for
this algorithm should be roughly 20&#x2013;200 times the dimension of the search
space.
</p>
</div>
</div>
<div id="outline-container-org959274a" class="outline-4">
<h4 id="org959274a">Golden section</h4>
<div class="outline-text-4" id="text-org959274a">
<p>
The golden section algorithm is a gradient free method which can be used to
obtain an estimate up to a precision of about \(\sqrt{\epsilon}\) where
\(\epsilon\) is machine precision. To initialise it, three points are needed,
\(a,b,c\) such that \(a < b < c\) and \(f(a) > f(b) < f(c)\). The name comes
from the fact that one of the parameters of the algorithm is the golden ratio.
</p>

<div class="org-src-container">
<pre class="src src-haskell">data Golden = Golden { gPoint      :: Double
                     , gValue      :: Double
                     , gDerivative :: Double } deriving (Show)

-- | Bracket the minimum
--
-- &gt;&gt;&gt; bracket (\x -&gt; x * (x - 1)) 0 0.1
--
bracket :: (Double -&gt; Double)
        -&gt; Double
        -&gt; Double
        -&gt; Either String (Double,Double,Double)
bracket f a b =
  let g = 1.618034
      c = b + g * (b - a)
      (fa, fb, fc) = (f a, f b, f c)
      in if | a &gt; b     -&gt; bracket f b a
            | fa &lt; fb   -&gt; Left "initial points given to bracket do not go downhill"
            | fb &lt; fc   -&gt; Right (a,b,c)
            | otherwise -&gt; bracket f b c

-- | Golden section search.
--
-- &gt;&gt;&gt; golden (\x -&gt; x * (x - 1)) (0.26,0.52,0.94)
--
golden :: (Double -&gt; Double)
       -&gt; (Double,Double,Double)
       -&gt; Either String Golden
golden f (a,b,c) =
  let
    r = 0.61803399
    tol = 3.0e-8
    (fa,fb,fc) = (f a,f b,f c)
    (x0,x3) = (a,c)
    (x1,x2) = if abs (c-b) &gt; abs (b-a)
              then (b,r*b+(1-r)*c)
              else ((1-r)*a+r*b,b)
    (xmin,fmin) = gwl r tol f (x0,x1,x2,x3) (f x1,f x2)
    fder = firstDerivative tol f xmin
  in if a &lt; b &amp;&amp; b &lt; c &amp;&amp; fa &gt; fb &amp;&amp; fb &lt; fc
     then Right $ Golden xmin fmin fder
     else Left "invalid triple given to golden"

-- | Golden while loop
gwl :: Double
    -&gt; Double
    -&gt; (Double -&gt; Double)
    -&gt; (Double,Double,Double,Double)
    -&gt; (Double,Double)
    -&gt; (Double,Double)
gwl r tol f (x0,x1,x2,x3) (f1,f2) =
  if abs (x3 - x0) &gt; tol * (abs x1 + abs x2)
  then if f2 &lt; f1
       then let x' = r*x2+(1-r)*x3
            in gwl r tol f (x1,x2,x',x3) (f2,f x')
       else let x' = r*x1+(1-r)*x0
            in gwl r tol f (x0,x',x1,x2) (f2,f x')
  else if f1 &lt; f2
       then (x1,f1)
       else (x2,f2)
</pre>
</div>
</div>
</div>
</div>
<div id="outline-container-orgc8e0717" class="outline-3">
<h3 id="orgc8e0717">LogSumExp function</h3>
<div class="outline-text-3" id="text-orgc8e0717">
<p>
Consider the LogSumExp (LSE) function
</p>

<p>
\[
\text{LSE}(x_1,\dots,x_n) = \log\left(\sum_i e^{x_i}\right).
\]
</p>

<p>
Let \(x^* = \max\{x_i\}\) and this can equally be expressed as
</p>

<p>
\[
x^* + \log\left(\sum_i e^{x_i - x^*}\right)
\]
</p>

<p>
which only takes the exponents of numbers closer to zero and hence can will not
overflow or underflow as easily.
</p>

<div class="org-src-container">
<pre class="src src-haskell">logSumExp :: (Floating a, Ord a) =&gt; [a] -&gt; a
logSumExp xs = x' + log (sum [exp (x - x') | x &lt;- xs])
               where x' = maximum xs
</pre>
</div>
</div>
</div>
<div id="outline-container-org180c536" class="outline-3">
<h3 id="org180c536">Combinatoric functions</h3>
<div class="outline-text-3" id="text-org180c536">
<p>
The following is taken from the <code>math-functions</code> haskell package which
demonstrates some useful implementations of functions for working with binomial
coefficients.
</p>

<div class="org-src-container">
<pre class="src src-haskell">----------------------------------------------------------------
-- Combinatorics
----------------------------------------------------------------

-- |
-- Quickly compute the natural logarithm of /n/ @`choose`@ /k/, with
-- no checking.
--
-- Less numerically stable:
--
-- &gt; exp $ lg (n+1) - lg (k+1) - lg (n-k+1)
-- &gt;   where lg = logGamma . fromIntegral
logChooseFast :: Double -&gt; Double -&gt; Double
logChooseFast n k = -log (n + 1) - logBeta (n - k + 1) (k + 1)

-- | Calculate binomial coefficient using exact formula
chooseExact :: Int -&gt; Int -&gt; Double
n `chooseExact` k
  = U.foldl' go 1 $ U.enumFromTo 1 k
  where
    go a i      = a * (nk + j) / j
        where j = fromIntegral i :: Double
    nk = fromIntegral (n - k)

-- | Compute logarithm of the binomial coefficient.
logChoose :: Int -&gt; Int -&gt; Double
n `logChoose` k
    | k  &gt; n    = (-1) / 0
      -- For very large N exact algorithm overflows double so we
      -- switch to beta-function based one
    | k' &lt; 50 &amp;&amp; (n &lt; 20000000) = log $ chooseExact n k'
    | otherwise                 = logChooseFast (fromIntegral n) (fromIntegral k)
  where
    k' = min k (n-k)

-- | Compute the binomial coefficient /n/ @\``choose`\`@ /k/. For
-- values of /k/ &gt; 50, this uses an approximation for performance
-- reasons.  The approximation is accurate to 12 decimal places in the
-- worst case
--
-- Example:
--
-- &gt; 7 `choose` 3 == 35
choose :: Int -&gt; Int -&gt; Double
n `choose` k
    | k  &gt; n         = 0
    | k' &lt; 50        = chooseExact n k'
    | approx &lt; max64 = fromIntegral . round64 $ approx
    | otherwise      = approx
  where
    k'             = min k (n-k)
    approx         = exp $ logChooseFast (fromIntegral n) (fromIntegral k')
    max64          = fromIntegral (maxBound :: Int64)
    round64 x      = round x :: Int64
</pre>
</div>
</div>
</div>
<div id="outline-container-org0db2aa5" class="outline-3">
<h3 id="org0db2aa5">Factorial</h3>
<div class="outline-text-3" id="text-org0db2aa5">
<p>
The factorial function has the following definition for positive integers
</p>

<p>
\[
n! = n \cdot (n-1) \cdot (n-2) \cdot \dots \cdot 2 \cdot 1
\]
</p>

<p>
It is related to the gamma function by \(x! = \Gamma ( x + 1)\). So you only
need a safe implementation of the gamma function to work with factorials.
</p>
</div>
</div>
<div id="outline-container-orga5adf80" class="outline-3">
<h3 id="orga5adf80">Pochhammer symbol</h3>
<div class="outline-text-3" id="text-orga5adf80">
<p>
For a positive integer, \(n\), the Pochhammer function, rising factorial, is
given by
</p>

<p>
\[
x^{(n)} = x \cdot (x+1) \cdot \dots \cdot (x+n-1) = \prod_{i=0}^{n-1} (x+i)
\]
</p>

<p>
with \(x^{(0)} = 1\). It is related to the factorial function and gamma function
</p>

<p>
\[
x^{(n)} = \frac{(x + n - 1)!}{(x-1)!} = \frac{\Gamma(x+n)}{\Gamma(x)}
\]
</p>

<p>
You need a reliable implementation of the gamma function to work with the
Pochhammer function.
</p>
</div>
</div>
<div id="outline-container-org7877b20" class="outline-3">
<h3 id="org7877b20">Computational complexity</h3>
<div class="outline-text-3" id="text-org7877b20">
<p>
Suppose you have a program that depends on a parameter <code>n</code> and takes <code>t</code> seconds
to evaluate. The following snippet can be used as a starting point for
estimating how long it will take to run on a larger input.
</p>

<div class="org-src-container">
<pre class="src src-R">df <span style="color: #D0372D;">&lt;-</span> data.frame(t = c(38,106,255,847), n = c(180,190,200,210))

ggplot(data = df, mapping = aes(x = n, y = t / 60)) +
  geom_point() +
  scale_y_log10(n.breaks = 10) +
  geom_smooth(method = <span style="color: #008000;">"lm"</span>, fullrange = <span style="color: #6434A3;">TRUE</span>) +
  xlim(c(170, 220))
</pre>
</div>

<p>
Of course, this assumes an exponential complexity, but is easy to tweak for
polynomial complexity.
</p>
</div>
<div id="outline-container-orgc413366" class="outline-4">
<h4 id="orgc413366">Time</h4>
<div class="outline-text-4" id="text-orgc413366">
<p>
Here is a table that might help you decide is something runs fast enough.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Seconds</th>
<th scope="col" class="org-left">Convenient</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">\(10^{0}\)</td>
<td class="org-left">\(<1\) minute</td>
</tr>

<tr>
<td class="org-left">\(10^{1}\)</td>
<td class="org-left">\(<1\) minute</td>
</tr>

<tr>
<td class="org-left">\(10^{2}\)</td>
<td class="org-left">\(\approx 2\) minute</td>
</tr>

<tr>
<td class="org-left">\(10^{3}\)</td>
<td class="org-left">\(\approx 20\) minutes</td>
</tr>

<tr>
<td class="org-left">\(10^{4}\)</td>
<td class="org-left">\(\approx 3\) hours</td>
</tr>

<tr>
<td class="org-left">\(10^{5}\)</td>
<td class="org-left">\(\approx 1\) day</td>
</tr>

<tr>
<td class="org-left">\(10^{6}\)</td>
<td class="org-left">\(\approx 10\) days</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="outline-container-org2f74878" class="outline-3">
<h3 id="org2f74878">Caching results</h3>
<div class="outline-text-3" id="text-org2f74878">
<p>
Consider the following Java programs. The first one computes the logarithms each
time they are used.
</p>

<div class="org-src-container">
<pre class="src src-java"><span style="color: #0000FF; font-weight: bold;">public</span> <span style="color: #0000FF; font-weight: bold;">class</span> <span style="color: #6434A3;">AAA</span> {
    <span style="color: #0000FF; font-weight: bold;">public</span> <span style="color: #0000FF; font-weight: bold;">static</span> <span style="color: #6434A3;">void</span> <span style="color: #006699;">main</span>(<span style="color: #6434A3;">String</span>[] <span style="color: #BA36A5;">args</span>) {
        <span style="color: #6434A3;">double</span> <span style="color: #BA36A5;">size</span> = 100000;
        <span style="color: #6434A3;">double</span> <span style="color: #BA36A5;">answer</span> = 1051287.7089736538;
        <span style="color: #6434A3;">int</span> <span style="color: #BA36A5;">repeats</span> = Integer.parseInt(args[0]);
        <span style="color: #0000FF; font-weight: bold;">for</span> (<span style="color: #6434A3;">int</span> <span style="color: #BA36A5;">m</span> = 0; m &lt; repeats; m++) {
            <span style="color: #6434A3;">double</span> <span style="color: #BA36A5;">x</span> = 0;
            <span style="color: #0000FF; font-weight: bold;">for</span> (<span style="color: #6434A3;">double</span> <span style="color: #BA36A5;">n</span> = 1.0; n &lt; size; n+=1.0) {
                x += Math.log(n);
            }
            <span style="color: #0000FF; font-weight: bold;">if</span> (x != answer) {
                <span style="color: #0000FF; font-weight: bold;">throw</span> <span style="color: #0000FF; font-weight: bold;">new</span> <span style="color: #6434A3;">RuntimeException</span>(<span style="color: #008000;">"incorrect value"</span>);
            }
        }
    }
}
</pre>
</div>

<p>
The second saves the results in an array and re-uses them.
</p>

<div class="org-src-container">
<pre class="src src-java"><span style="color: #0000FF; font-weight: bold;">public</span> <span style="color: #0000FF; font-weight: bold;">class</span> <span style="color: #6434A3;">BBB</span> {
    <span style="color: #0000FF; font-weight: bold;">public</span> <span style="color: #0000FF; font-weight: bold;">static</span> <span style="color: #6434A3;">void</span> <span style="color: #006699;">main</span>(<span style="color: #6434A3;">String</span>[] <span style="color: #BA36A5;">args</span>) {
        <span style="color: #6434A3;">int</span> <span style="color: #BA36A5;">size</span> = 100000;
        <span style="color: #6434A3;">double</span> <span style="color: #BA36A5;">answer</span> = 1051287.7089736538;
        <span style="color: #6434A3;">int</span> <span style="color: #BA36A5;">repeats</span> = Integer.parseInt(args[0]);
        <span style="color: #6434A3;">double</span>[] <span style="color: #BA36A5;">ls</span>;
        ls = <span style="color: #0000FF; font-weight: bold;">new</span> <span style="color: #6434A3;">double</span>[size+1];
        <span style="color: #0000FF; font-weight: bold;">for</span> (<span style="color: #6434A3;">int</span> <span style="color: #BA36A5;">ix</span> = 0; ix &lt;= size; ix++) {
            ls[ix] = Math.log(ix);
        }

        <span style="color: #0000FF; font-weight: bold;">for</span> (<span style="color: #6434A3;">int</span> <span style="color: #BA36A5;">m</span> = 0; m &lt; repeats; m++) {
            <span style="color: #6434A3;">double</span> <span style="color: #BA36A5;">x</span> = 0;
            <span style="color: #0000FF; font-weight: bold;">for</span> (<span style="color: #6434A3;">int</span> <span style="color: #BA36A5;">n</span> = 1; n &lt; size; n++) {
                x += ls[n];
            }
            <span style="color: #0000FF; font-weight: bold;">if</span> (x != answer) {
                <span style="color: #0000FF; font-weight: bold;">throw</span> <span style="color: #0000FF; font-weight: bold;">new</span> <span style="color: #6434A3;">RuntimeException</span>(<span style="color: #008000;">"incorrect value"</span>);
            }
        }
    }
}
</pre>
</div>

<p>
Running this program with varying number of repeats and timing the evaluation
produces the dataset shown in Listing <a href="#org1b11d78">1</a> which is also shown in Figure <a href="#org0d53b22">1</a>. This
shows that for even reasonably small problems it is useful to cache results.
</p>


<div id="org0d53b22" class="figure">
<p><img src="../images/java-log-timing.png" alt="java-log-timing.png" width="400px" />
</p>
</div>

<div class="org-src-container">
<pre class="src src-csv" id="org1b11d78">method,repeats,seconds
AAA,100,0.286
AAA,200,0.474
AAA,300,0.612
AAA,400,0.781
AAA,500,0.945
AAA,600,1.154
AAA,700,1.312
AAA,800,1.521
AAA,900,1.712
AAA,1000,1.764
AAA,1100,2.084
AAA,1200,2.177
AAA,1300,2.397
AAA,1400,2.619
AAA,1500,2.661
BBB,100,0.133
BBB,200,0.128
BBB,300,0.156
BBB,400,0.154
BBB,500,0.169
BBB,600,0.174
BBB,700,0.177
BBB,800,0.186
BBB,900,0.178
BBB,1000,0.240
BBB,1100,0.205
BBB,1200,0.229
BBB,1300,0.248
BBB,1400,0.254
BBB,1500,0.272
</pre>
</div>

<p>
% Local Variables:
% fill-column: 80
% End:
</p>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Alexander E. Zarebski</p>
<p class="date">Created: 2025-06-04 Wed 16:31</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
