<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2020-12-03 Thu 18:53 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>aez-notes</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Alex Zarebski" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="../css/stylesheet.css" />
<script type="text/javascript">
// @license magnet:?xt=urn:btih:e95b018ef3580986a04669f1b5879592219e2a7a&dn=public-domain.txt Public Domain
<!--/*--><![CDATA[/*><!--*/
     function CodeHighlightOn(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.add("code-highlighted");
         target.classList.add("code-highlighted");
       }
     }
     function CodeHighlightOff(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.remove("code-highlighted");
         target.classList.remove("code-highlighted");
       }
     }
    /*]]>*///-->
// @license-end
</script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
});
</script>
<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML"></script>
</head>
<body>
<div id="content">
<h1 class="title">aez-notes</h1>
<p>
<a href="../index.html">Home</a>
</p>

<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org0c019bd">Programming in R</a>
<ul>
<li><a href="#orgaa3c69a">Installing and updating R</a></li>
<li><a href="#org9ddd5cf">R for Haskellers</a></li>
<li><a href="#org4c05dc2">Error handling</a></li>
<li><a href="#orgcea412f">R Packages by Wickham and Bryan</a></li>
<li><a href="#org89f56c8">R6 and OOP</a></li>
<li><a href="#orge6f11d7">High performance computing</a></li>
<li><a href="#org4bf5179">Metaprogramming</a></li>
<li><a href="#org05cb89d">Packages I like</a></li>
<li><a href="#orga15b41c">TIDYDATA and the <code>tidyverse</code></a></li>
<li><a href="#orgf82d9a8">Command line arguments</a></li>
<li><a href="#org1c64269">Unit testing with <code>testthat</code></a></li>
<li><a href="#org0e87877">Dependency management with <code>packrat</code></a></li>
<li><a href="#orgd520b56">Package and project management with <code>usethis</code></a></li>
<li><a href="#orgbe59013">String handling with <code>stringr</code></a></li>
<li><a href="#org258225a">Documentation with <code>roxygen2</code></a></li>
<li><a href="#org21a9416">Dates and times</a></li>
<li><a href="#org5bb58d5"><code>Rmath.h</code></a></li>
<li><a href="#org123fce2">Nifty utility functions</a></li>
<li><a href="#org93d7e8c">Cheat sheets</a></li>
<li><a href="#org8b0968e">Data structures</a></li>
</ul>
</li>
<li><a href="#org8ba29d7">Statistics with R</a>
<ul>
<li><a href="#orgc0b6e53">Linear regression <code>lm</code></a></li>
<li><a href="#orgf3756a6"><span class="todo TODO">TODO</span> Mathematical optimisation</a></li>
<li><a href="#orgcd778e0">Computational geography and cartography</a></li>
<li><a href="#orge294d07">Differential equations with <code>deSolve</code></a></li>
<li><a href="#org72a497a">MCMC (without <code>Stan</code>)</a></li>
<li><a href="#org4e3e283">(Nonparametric) density estimation with <code>KernSmooth</code></a></li>
</ul>
</li>
</ul>
</div>
</div>


<div id="org349f9b0" class="figure">
<p><img src="../images/r-logo.png" alt="r-logo.png" />
</p>
</div>

<div id="outline-container-org0c019bd" class="outline-2">
<h2 id="org0c019bd">Programming in R</h2>
<div class="outline-text-2" id="text-org0c019bd">
</div>
<div id="outline-container-orgaa3c69a" class="outline-3">
<h3 id="orgaa3c69a">Installing and updating R</h3>
<div class="outline-text-3" id="text-orgaa3c69a">
<p>
<b>Last update was to 4.0.2</b>
</p>

<p>
R updates frequently and things break, so it is a good idea to keep your version
of R reasonably up to date. You can obtain the source code for every version of
R from <a href="https://cran.r-project.org/src/base/">CRAN</a>. The steps involved in getting a particular version of R are as
follows.
</p>

<ol class="org-ol">
<li>Ensure you have the nessessary dependencies with <code>sudo apt-get build-dep
   r-base</code>.</li>
<li>Download the relevant source, e.g. <code>R-4.0.2.tar.gz</code>, and unzip it: <code>tar -xvf
   R-X.Y.Z.tar.gz</code>.</li>
<li>Run <code>./configure</code> and then <code>make</code> and <code>make info</code> to compile R and the
documentation.</li>
<li>Check that the compilation has worked properly with <code>make check</code> and address
any issues that arise.</li>
<li>Install the executable with <code>sudo make install</code> and <code>sudo make install-info</code>.</li>
<li>Check it worked with <code>R -e "sessionInfo()"</code>.</li>
<li>Profit!</li>
</ol>

<p>
Note that step 3 takes the longest, but this still took less than 10 minutes on
my machine for <code>R-4.0.2</code>. After updating, you'll probably have lost all your
packages, the following command can help with this.
</p>

<div class="org-src-container">
<pre class="src src-R">my_pkgs <span style="color: #ba2f59; font-weight: bold;">&lt;-</span> c<span style="color: #3a81c3;">(</span><span style="color: #2d9574;">"dplyr"</span>, 
             <span style="color: #2d9574;">"purrr"</span>,
             <span style="color: #2d9574;">"magrittr"</span>,
             <span style="color: #2d9574;">"ggplot2"</span>,
             <span style="color: #2d9574;">"reshape2"</span>,
             <span style="color: #2d9574;">"stringr"</span><span style="color: #3a81c3;">)</span>
install.packages<span style="color: #3a81c3;">(</span>my_pkgs<span style="color: #3a81c3;">)</span>
</pre>
</div>

<p>
Last time when I updated the packages it said the default library was not
writable so I used a personal library instead. Although if you have old package
versions hanging around they can case you can find where they are with
<code>.libPaths()</code> and remove them before starting fresh.
</p>
</div>

<div id="outline-container-orgfcf31c2" class="outline-4">
<h4 id="orgfcf31c2">Notes</h4>
<div class="outline-text-4" id="text-orgfcf31c2">
<ul class="org-ul">
<li><code>R-4.0.2</code> needed me to install <code>libpcre2-dev</code> to get the configuration step to
work. I also had to use <code>sudo make install</code> to install the executable where as
previously it had not needed this level of permission. The <code>update.packages</code>
command didn't work as expected this time, which prompted the installation
list.</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org9ddd5cf" class="outline-3">
<h3 id="org9ddd5cf">R for Haskellers</h3>
<div class="outline-text-3" id="text-org9ddd5cf">
<div class="org-src-container">
<pre class="src src-R"><span style="color: #3a81c3;">library</span><span style="color: #3a81c3;">(</span>magrittr<span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3;">library</span><span style="color: #3a81c3;">(</span>purrr<span style="color: #3a81c3;">)</span>
</pre>
</div>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Haskell</th>
<th scope="col" class="org-left">R (<code>purrr</code>)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><code>scanl</code></td>
<td class="org-left"><code>accumulate</code></td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-org4c05dc2" class="outline-3">
<h3 id="org4c05dc2">Error handling</h3>
<div class="outline-text-3" id="text-org4c05dc2">
<p>
Hadley has a nice <a href="http://adv-r.had.co.nz/Exceptions-Debugging.html#condition-handling">description</a> of how to handle these things in more detail, but here is a small example (from him)
</p>

<div class="org-src-container">
<pre class="src src-R"><span style="color: #6c3163; font-weight: bold;">show_condition</span> <span style="color: #ba2f59; font-weight: bold;">&lt;-</span> <span style="color: #3a81c3; font-weight: bold;">function</span><span style="color: #3a81c3;">(</span>code<span style="color: #3a81c3;">)</span> <span style="color: #3a81c3;">{</span>
  <span style="color: #3a81c3; font-weight: bold;">tryCatch</span><span style="color: #6c3163;">(</span>code,
    error = <span style="color: #3a81c3; font-weight: bold;">function</span><span style="color: #2d9574;">(</span>c<span style="color: #2d9574;">)</span> <span style="color: #2d9574;">"error"</span>
  <span style="color: #6c3163;">)</span>
<span style="color: #3a81c3;">}</span>
show_condition<span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">stop</span><span style="color: #6c3163;">(</span><span style="color: #2d9574;">"!"</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span> <span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">evaluates to the string "error"</span>
show_condition<span style="color: #3a81c3;">(</span><span style="color: #4e3163;">10</span><span style="color: #3a81c3;">)</span> <span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">evalates to the numeric 10</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcea412f" class="outline-3">
<h3 id="orgcea412f">R Packages by Wickham and Bryan</h3>
<div class="outline-text-3" id="text-orgcea412f">
<p>
There is a new edition of the <a href="https://r-pkgs.org/">R packages book available online</a>.
Here are some notes about package creation based on reading through that book.
</p>
</div>

<div id="outline-container-orgf21d270" class="outline-4">
<h4 id="orgf21d270">Package development loop</h4>
<div class="outline-text-4" id="text-orgf21d270">
<ol class="org-ol">
<li><code>library(devtools)</code></li>
<li><code>create_package("~/path/to/my/package")</code></li>
<li><code>use_git()</code></li>
<li>Edit the <code>DESCRIPTION</code></li>
<li><code>use_mit_license("Alexander E. Zarebski")</code></li>
<li><code>use_testthat()</code></li>
<li>Include the function <code>foo</code> in <code>R/foo.R</code></li>
<li><code>load_all()</code> to bring the functions into the REPL</li>
<li><code>use_test("foo")</code> to template a test for the <code>foo</code> function</li>
<li><code>test()</code> to run the tests</li>
<li><code>check()</code> to check the package works</li>
<li><code>document()</code></li>
<li>Commit the good stuff to git</li>
<li><code>install()</code> to install on the current machine</li>
<li>Profit</li>
<li><code>uninstall("&lt;package&gt;")</code> to uninstall <code>&lt;package&gt;</code></li>
</ol>
</div>
</div>

<div id="outline-container-orga8463b0" class="outline-4">
<h4 id="orga8463b0">Package dependencies</h4>
<div class="outline-text-4" id="text-orga8463b0">
<p>
The <code>DESCRIPTION</code> file is the place to go!
<i>Hadley says:</i> use <del><code>use_package("foo", "bar")</code></del> to have <code>foo</code> and <code>bar</code> added to the dependencies of the package being developed.
The <code>devtools::use_packag</code> function has been deprecated in favour of <code>usethis::use_package</code>.
</p>

<div class="org-src-container">
<pre class="src src-R">usethis::use_package<span style="color: #3a81c3;">(</span><span style="color: #2d9574;">"foo"</span>, <span style="color: #2d9574;">"bar"</span><span style="color: #3a81c3;">)</span>
</pre>
</div>

<p>
The <code>DESCRIPTION</code> will now have the following entry added
</p>

<div class="org-src-container">
<pre class="src src-text">Imports: 
    foo,
    bar
</pre>
</div>

<p>
If the package depends on a specific version of the package this can be added too.
</p>

<div class="org-src-container">
<pre class="src src-text">Imports: 
    foo (&gt;= 0.2),
    bar (&gt;= 0.3.0.1)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfedd1f2" class="outline-4">
<h4 id="orgfedd1f2">Vignettes</h4>
<div class="outline-text-4" id="text-orgfedd1f2">
<p>
Create a template vignette with <code>usethis::use_vignette</code>.
There is an <a href="https://www.rstudio.com/wp-content/uploads/2015/02/rmarkdown-cheatsheet.pdf">R Markdown Cheat Sheet</a>
</p>
</div>
</div>
</div>

<div id="outline-container-org89f56c8" class="outline-3">
<h3 id="org89f56c8">R6 and OOP</h3>
<div class="outline-text-3" id="text-org89f56c8">
<ul class="org-ul">
<li>R6 classes are a popular way to bring traditional OOP to R, they have reference semantics.</li>
<li>R6 is available on CRAN</li>
<li>The <code>R6Class</code> function is used to declare classes, the (public) <code>initialize</code> function is used to create instances of this class with <code>$new</code>.</li>
<li><code>self</code> is available within the class to describe the current object.</li>
<li>Assignment of fields is done with <code>&lt;-</code> e.g., <code>self$foo &lt;- "bar"</code></li>
<li>Returning <code>self</code> invisibly (<code>invisible(self)</code>) makes methods <i>chainable</i>.</li>
<li>Active bindings are a way to carry out side effects when assigning values which has a syntax which looks like you are just assigning to a field.</li>
<li>Fields containing reference objects should be set in the <code>initialize</code> method unless you want the object to be shared across all instances of the class.</li>
<li>By default, objects get a <code>clone</code> method, which is shallow; deep cloning can be achieved by passing <code>deep=TRUE</code>.</li>
<li>There was a <a href="https://github.com/r-lib/R6/issues/82#issue-133982435">request for interfaces in R6</a>, however Hadley suggested that this departed from the very minimalist goals of R6 so it will not be implemented.</li>
</ul>
</div>
</div>

<div id="outline-container-orge6f11d7" class="outline-3">
<h3 id="orge6f11d7">High performance computing</h3>
<div class="outline-text-3" id="text-orge6f11d7">
<p>
<a href="https://cran.r-project.org/view=HighPerformanceComputing">CRAN Task View for High Performance Computing</a>
</p>

<p>
The package <a href="https://cran.r-project.org/web/packages/furrr/furrr.pdf"><code>furrr</code></a> provides <code>purrr</code> style functions which run in parallel. See
the following snippet for an example
</p>

<div class="org-src-container">
<pre class="src src-R"><span style="color: #3a81c3;">library</span><span style="color: #3a81c3;">(</span>future<span style="color: #3a81c3;">)</span>
plan<span style="color: #3a81c3;">(</span>multiprocess<span style="color: #3a81c3;">)</span>

y <span style="color: #ba2f59; font-weight: bold;">&lt;-</span> furrr::future_map<span style="color: #3a81c3;">(</span>x, ~ f<span style="color: #6c3163;">(</span>.x<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org4bf5179" class="outline-3">
<h3 id="org4bf5179">Metaprogramming</h3>
<div class="outline-text-3" id="text-org4bf5179">
<p>
The following snippet demonstrates how to get the value of a variable given a string containing its symbol.
There is a synonym <code>as.name</code> which derives from S terminology while "symbol" is LISP lingo.
</p>

<div class="org-src-container">
<pre class="src src-R">a <span style="color: #ba2f59; font-weight: bold;">&lt;-</span> <span style="color: #4e3163;">1</span>
eval<span style="color: #3a81c3;">(</span>as.symbol<span style="color: #6c3163;">(</span><span style="color: #2d9574;">"a"</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
</pre>
</div>

<p>
This doesn't seem to work unless you have string literals.
Instead we can do the following
</p>

<div class="org-src-container">
<pre class="src src-R"><span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">this has a syntax error</span>
data.frame<span style="color: #3a81c3;">(</span>letters<span style="color: #6c3163;">[</span><span style="color: #4e3163;">1</span><span style="color: #6c3163;">]</span> = <span style="color: #4e3163;">2</span><span style="color: #3a81c3;">)</span>

<span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">this works!</span>
eval<span style="color: #3a81c3;">(</span>parse<span style="color: #6c3163;">(</span>text = sprintf<span style="color: #2d9574;">(</span><span style="color: #2d9574;">"data.frame(%s = 2)"</span>, letters<span style="color: #67b11d;">[</span><span style="color: #4e3163;">1</span><span style="color: #67b11d;">]</span><span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org05cb89d" class="outline-3">
<h3 id="org05cb89d">Packages I like</h3>
<div class="outline-text-3" id="text-org05cb89d">
</div>
<div id="outline-container-orgbc3c2c6" class="outline-4">
<h4 id="orgbc3c2c6"><a href="https://cran.r-project.org/web/packages/ape/ape.pdf">ape</a> Analyses of Phylogenetics and Evolution</h4>
</div>
<div id="outline-container-org388737f" class="outline-4">
<h4 id="org388737f"><a href="https://cran.r-project.org/web/packages/deSolve/index.html">deSolve</a> Solvers for Initial Value Problems of Differential Equations</h4>
</div>
<div id="outline-container-org7c53019" class="outline-4">
<h4 id="org7c53019"><a href="https://cran.r-project.org/web/packages/lhs/vignettes/lhs_basics.html">lhs</a> Latin Hypercube Samples</h4>
<div class="outline-text-4" id="text-org7c53019">
<ul class="org-ul">
<li><code>randomLHS(n,k)</code> generates \(n\) samples from \([0,1]^{k}\).</li>
</ul>
</div>
</div>
<div id="outline-container-org315af5c" class="outline-4">
<h4 id="org315af5c"><a href="https://cran.r-project.org/web/packages/magrittr/magrittr.pdf">magrittr</a> a forward pipe operator for R</h4>
<div class="outline-text-4" id="text-org315af5c">
<p>
There are many useful aliases exported by <code>magrittr</code>, the table below has some examples.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Alias</th>
<th scope="col" class="org-left">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><code>extract</code></td>
<td class="org-left"><code>`[`</code></td>
</tr>

<tr>
<td class="org-left"><code>extract2</code></td>
<td class="org-left"><code>`[[`</code></td>
</tr>

<tr>
<td class="org-left"><code>use_series</code></td>
<td class="org-left"><code>`$`</code></td>
</tr>

<tr>
<td class="org-left"><code>is_in</code></td>
<td class="org-left"><code>`%in%`</code></td>
</tr>

<tr>
<td class="org-left"><code>is_greater_than</code></td>
<td class="org-left"><code>`&gt;`</code></td>
</tr>

<tr>
<td class="org-left"><code>set_colnames</code></td>
<td class="org-left"><code>`colnames&lt;-`</code></td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-org6da1a9d" class="outline-4">
<h4 id="org6da1a9d"><a href="https://cran.r-project.org/web/packages/stringr/stringr.pdf">stringr</a> Simple, Consistent Wrappers for Common String Operations</h4>
</div>
<div id="outline-container-org9827f4f" class="outline-4">
<h4 id="org9827f4f"><a href="https://cran.r-project.org/web/packages/styler/styler.pdf">styler</a> Non-Invasive Pretty Printing of R Code</h4>
</div>
<div id="outline-container-org914bb85" class="outline-4">
<h4 id="org914bb85"><a href="https://cran.r-project.org/web/packages/testthat/testthat.pdf">testthat</a> Unit Testing for R</h4>
</div>
<div id="outline-container-orgafdca9f" class="outline-4">
<h4 id="orgafdca9f"><a href="https://cran.r-project.org/web/packages/truncnorm/truncnorm.pdf">truncnorm</a> Truncated Normal Distribution</h4>
</div>
</div>

<div id="outline-container-orga15b41c" class="outline-3">
<h3 id="orga15b41c">TIDYDATA and the <code>tidyverse</code></h3>
<div class="outline-text-3" id="text-orga15b41c">
<p>
There are several ways to join data frames using <code>dplyr</code>, the folling snippet
demonstrates a full join which duplicates records where necessary and will fill
in missing values. Although the data in the joined data frame does not depend on
the order of the arguments, the ordering of the rows does.
</p>

<div class="org-src-container">
<pre class="src src-R">foo <span style="color: #ba2f59; font-weight: bold;">&lt;-</span> data.frame<span style="color: #3a81c3;">(</span>x = <span style="color: #4e3163;">1</span>:<span style="color: #4e3163;">3</span>, y = letters<span style="color: #6c3163;">[</span><span style="color: #4e3163;">1</span>:<span style="color: #4e3163;">3</span><span style="color: #6c3163;">]</span><span style="color: #3a81c3;">)</span>
bar <span style="color: #ba2f59; font-weight: bold;">&lt;-</span> data.frame<span style="color: #3a81c3;">(</span>x = c<span style="color: #6c3163;">(</span><span style="color: #4e3163;">2</span>:<span style="color: #4e3163;">4</span>,<span style="color: #4e3163;">2</span>:<span style="color: #4e3163;">4</span><span style="color: #6c3163;">)</span>, z = LETTERS<span style="color: #6c3163;">[</span><span style="color: #4e3163;">1</span>:<span style="color: #4e3163;">6</span><span style="color: #6c3163;">]</span><span style="color: #3a81c3;">)</span>
dplyr::full_join<span style="color: #3a81c3;">(</span>foo,bar<span style="color: #3a81c3;">)</span>
</pre>
</div>

<pre class="example">
Joining, by = "x"
  x    y    z
1 1    a &lt;NA&gt;
2 2    b    A
3 2    b    D
4 3    c    B
5 3    c    E
6 4 &lt;NA&gt;    C
7 4 &lt;NA&gt;    F
</pre>
</div>
</div>

<div id="outline-container-orgf82d9a8" class="outline-3">
<h3 id="orgf82d9a8">Command line arguments</h3>
<div class="outline-text-3" id="text-orgf82d9a8">
<p>
The simplest example is probably what you'll need most of the time
</p>

<div class="org-src-container">
<pre class="src src-R"><span style="color: #2aa1ae; background-color: #ecf3ec;">## </span><span style="color: #2aa1ae; background-color: #ecf3ec;">demo.R</span>
args <span style="color: #ba2f59; font-weight: bold;">&lt;-</span> commandArgs<span style="color: #3a81c3;">(</span>trailingOnly = <span style="color: #4e3163;">TRUE</span><span style="color: #3a81c3;">)</span>
print<span style="color: #3a81c3;">(</span>args<span style="color: #3a81c3;">)</span>
</pre>
</div>

<p>
As an example consider the following command and output
</p>

<pre class="example">
$ Rscript demo.R 3 foo.csv
[1] "3"       "foo.csv"
</pre>

<p>
Be careful when passing in numbers because they are read in as strings.
</p>
</div>
</div>

<div id="outline-container-org1c64269" class="outline-3">
<h3 id="org1c64269">Unit testing with <code>testthat</code></h3>
<div class="outline-text-3" id="text-org1c64269">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">Function</td>
<td class="org-left">Example</td>
</tr>

<tr>
<td class="org-left"><code>expect_true</code></td>
<td class="org-left"><code>expect_true(TRUE)</code></td>
</tr>

<tr>
<td class="org-left"><code>expect_equal</code></td>
<td class="org-left"><code>expect_equal(10.01, 10, tolerance = 0.02)</code></td>
</tr>

<tr>
<td class="org-left"><code>expect_error</code></td>
<td class="org-left"><code>expect_error(stop("Boo!"))</code></td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-org0e87877" class="outline-3">
<h3 id="org0e87877">Dependency management with <code>packrat</code></h3>
<div class="outline-text-3" id="text-org0e87877">
<p>
Packrat is developed by the team at RStudio. It relies on the notion of a
<i>project</i>, which we might think of as a single analysis or collection of related
analyses. A project should live in a single directory.
</p>
</div>

<div id="outline-container-org382e168" class="outline-4">
<h4 id="org382e168">Usage</h4>
<div class="outline-text-4" id="text-org382e168">
<p>
To start a packrat project use
</p>

<div class="org-src-container">
<pre class="src src-R">packrat::init<span style="color: #3a81c3;">()</span>
</pre>
</div>

<p>
This creates a directory <code>packrat</code> and a <code>.Rprofile</code> file. The profile file is
how R knows to use the private library rather than the shared one. There is a
file <code>packrat/packrat.lock</code> which contains the package details.
</p>

<p>
Packages are installed as usual with <code>install.packages</code>, but now they will be
stored in the private packrat library. Packages are not added to the
<code>packrat.lock</code> file until a <i>snapshot</i> of the current packages is made
</p>

<div class="org-src-container">
<pre class="src src-R">packrat::snapshot<span style="color: #3a81c3;">()</span>
</pre>
</div>

<p>
If you want a status report from packrat about how the packages there is
<code>packrat::status</code>. To install local packages, packrat needs to be told where
they live
</p>

<div class="org-src-container">
<pre class="src src-R">packrat::set_opts<span style="color: #3a81c3;">(</span>local.repos = <span style="color: #2d9574;">"&lt;path/to/package&gt;"</span><span style="color: #3a81c3;">)</span>
</pre>
</div>

<p>
When moving a project between machines the installed packages will probably
break. However, the <code>packrat</code> directory stores copies of the source for each of
the packages so they can be <i>restored</i>.
</p>

<div class="org-src-container">
<pre class="src src-R">packrat::restore<span style="color: #3a81c3;">()</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org9f5911f" class="outline-4">
<h4 id="org9f5911f">Version control</h4>
<div class="outline-text-4" id="text-org9f5911f">
<p>
The following files should be included into version control:
</p>

<ul class="org-ul">
<li><code>.gitignore</code> can contain <code>packrat/lib</code> and <code>packrat/src</code>.</li>
<li><code>.Rprofile</code></li>
<li><code>packrat/packrat.opts</code></li>
<li><code>packrat/packrat.lock</code></li>
</ul>

<p>
The following explaination of the directory structure is given in the
<a href="https://rstudio.github.io/packrat/walkthrough.html">walkthrough</a>
</p>

<blockquote>
<p>
A packrat project contains a few extra files and directories. The <code>init()</code>
function creates these files for you, if they donâ€™t already exist.
</p>

<ul class="org-ul">
<li><code>packrat/packrat.lock</code>: Lists the precise package versions that were used to
satisfy dependencies, including dependencies of dependencies. (This file
should never be edited by hand!)</li>
<li><code>packrat/packrat.opts</code>: Project-specific packrat options. These can be queried
and set with <code>get_opts</code> and <code>set_opts</code>; see <code>?"packrat-options"</code> for more
information.</li>
<li><code>packrat/lib/</code>: Private package library for this project.</li>
<li><code>packrat/src/</code>: Source packages of all the dependencies that packrat has been
made aware of.</li>
<li><code>.Rprofile</code>: Directs R to use the private package library (when it is started
from the project directory).</li>
</ul>
</blockquote>
</div>
</div>
</div>

<div id="outline-container-orgd520b56" class="outline-3">
<h3 id="orgd520b56">Package and project management with <code>usethis</code></h3>
<div class="outline-text-3" id="text-orgd520b56">
<ul class="org-ul">
<li>Add dependencies to packages with <code>usethis::use_package</code> instead of
<code>devtools::use_package</code> which is now deprecated. It is the same deal with
<code>use_vignette</code>.</li>
</ul>
</div>
</div>

<div id="outline-container-orgbe59013" class="outline-3">
<h3 id="orgbe59013">String handling with <code>stringr</code></h3>
<div class="outline-text-3" id="text-orgbe59013">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">function</th>
<th scope="col" class="org-left">use</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><code>str_detect</code></td>
<td class="org-left"><b>match</b> like <code>grepl</code></td>
</tr>

<tr>
<td class="org-left"><code>str_flatten</code></td>
<td class="org-left"><b>flatten</b> like <code>paste</code></td>
</tr>

<tr>
<td class="org-left"><code>str_interp</code></td>
<td class="org-left">string <b>interpolation</b> like <code>sprintf</code></td>
</tr>

<tr>
<td class="org-left"><code>str_replace</code></td>
<td class="org-left"><b>substitution</b> like <code>gsub</code></td>
</tr>

<tr>
<td class="org-left"><code>str_split</code></td>
<td class="org-left"><b>split</b> like <code>strsplit</code></td>
</tr>

<tr>
<td class="org-left"><code>str_subset</code></td>
<td class="org-left"><b>filters</b> strings like <code>grep</code></td>
</tr>

<tr>
<td class="org-left"><code>str_to_lower</code></td>
<td class="org-left">converts to lower case</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-org258225a" class="outline-3">
<h3 id="org258225a">Documentation with <code>roxygen2</code></h3>
<div class="outline-text-3" id="text-org258225a">
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">style</th>
<th scope="col" class="org-left">markup</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left">italics</td>
<td class="org-left"><code>\emph{}</code></td>
</tr>

<tr>
<td class="org-left">bold</td>
<td class="org-left"><code>\strong{}</code></td>
</tr>

<tr>
<td class="org-left">mono-spaced</td>
<td class="org-left"><code>\code{}</code></td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-org21a9416" class="outline-3">
<h3 id="org21a9416">Dates and times</h3>
<div class="outline-text-3" id="text-org21a9416">
<p>
<code>as.Date</code> is your friend.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Code</th>
<th scope="col" class="org-left">Value</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><code>%d</code></td>
<td class="org-left">Day (integer)</td>
</tr>

<tr>
<td class="org-left"><code>%m</code></td>
<td class="org-left">Month (integer)</td>
</tr>

<tr>
<td class="org-left"><code>%b</code></td>
<td class="org-left">Abbreviated month (string)</td>
</tr>

<tr>
<td class="org-left"><code>%B</code></td>
<td class="org-left">Month (string)</td>
</tr>

<tr>
<td class="org-left"><code>%y</code></td>
<td class="org-left">Year (2 digits)</td>
</tr>

<tr>
<td class="org-left"><code>%Y</code></td>
<td class="org-left">Year (4 digits)</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-org5bb58d5" class="outline-3">
<h3 id="org5bb58d5"><code>Rmath.h</code></h3>
<div class="outline-text-3" id="text-org5bb58d5">
<div class="org-src-container">
<pre class="src src-C"><span style="color: #2aa1ae; background-color: #ecf3ec;">/*</span>

<span style="color: #2aa1ae; background-color: #ecf3ec;">  To compile and run this I used the following...</span>


<span style="color: #2aa1ae; background-color: #ecf3ec;">  $ sudo apt update</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">  $ sudo apt install r-mathlib</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">  $ sudo apt install r-base-dev</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">  $ gcc -o mathlibtest demo.c -lRmath -lm</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">  $ ./mathlibtest</span>

<span style="color: #2aa1ae; background-color: #ecf3ec;"> */</span>

<span style="color: #6c3163;">#include</span> <span style="color: #3a81c3;">&lt;</span><span style="color: #2d9574;">stdio.h</span><span style="color: #3a81c3;">&gt;</span>

<span style="color: #6c3163;">#define</span> <span style="color: #715ab1;">MATHLIB_STANDALONE</span> <span style="color: #4e3163;">1</span>
<span style="color: #6c3163;">#include</span> <span style="color: #2d9574;">"Rmath.h"</span>


<span style="color: #ba2f59; font-weight: bold;">int</span> <span style="color: #6c3163; font-weight: bold;">fib</span><span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">int</span> <span style="color: #715ab1;">n</span><span style="color: #3a81c3;">)</span> <span style="color: #3a81c3;">{</span>
  <span style="color: #3a81c3; font-weight: bold;">if</span> <span style="color: #6c3163;">(</span>n &lt; <span style="color: #4e3163;">2</span><span style="color: #6c3163;">)</span> <span style="color: #6c3163;">{</span>
    <span style="color: #3a81c3; font-weight: bold;">return</span><span style="color: #2d9574;">(</span><span style="color: #4e3163;">1</span><span style="color: #2d9574;">)</span>;
  <span style="color: #6c3163;">}</span> <span style="color: #3a81c3; font-weight: bold;">else</span> <span style="color: #6c3163;">{</span>
    <span style="color: #3a81c3; font-weight: bold;">return</span><span style="color: #2d9574;">(</span>fib<span style="color: #67b11d;">(</span>n-<span style="color: #4e3163;">1</span><span style="color: #67b11d;">)</span> + fib<span style="color: #67b11d;">(</span>n-<span style="color: #4e3163;">2</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>;
  <span style="color: #6c3163;">}</span>
<span style="color: #3a81c3;">}</span>

<span style="color: #ba2f59; font-weight: bold;">int</span> <span style="color: #6c3163; font-weight: bold;">main</span><span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">int</span> <span style="color: #715ab1;">ac</span>, <span style="color: #ba2f59; font-weight: bold;">char</span>** <span style="color: #715ab1;">av</span><span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3;">{</span>
  <span style="color: #ba2f59; font-weight: bold;">int</span> <span style="color: #715ab1;">n</span>;
  <span style="color: #ba2f59; font-weight: bold;">double</span> <span style="color: #715ab1;">foo</span>;

  <span style="color: #3a81c3; font-weight: bold;">for</span> <span style="color: #6c3163;">(</span> n = <span style="color: #4e3163;">0</span>; n &lt; <span style="color: #4e3163;">10</span>; n = n + <span style="color: #4e3163;">1</span> <span style="color: #6c3163;">)</span> <span style="color: #6c3163;">{</span>
    printf<span style="color: #2d9574;">(</span><span style="color: #2d9574;">"%d\n"</span>, fib<span style="color: #67b11d;">(</span>n<span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>;
    foo = dnorm<span style="color: #2d9574;">(</span><span style="color: #4e3163;">1.0</span>, <span style="color: #4e3163;">0.0</span>, <span style="color: #4e3163;">1.0</span>, <span style="color: #4e3163;">0</span><span style="color: #2d9574;">)</span>;
    printf<span style="color: #2d9574;">(</span><span style="color: #2d9574;">"%f\n"</span>, foo<span style="color: #2d9574;">)</span>;
  <span style="color: #6c3163;">}</span>

  printf<span style="color: #6c3163;">(</span><span style="color: #2d9574;">"hello, %s\n"</span>, <span style="color: #2d9574;">"world"</span><span style="color: #6c3163;">)</span>;
  <span style="color: #3a81c3; font-weight: bold;">return</span> <span style="color: #4e3163;">0</span>;
<span style="color: #3a81c3;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org123fce2" class="outline-3">
<h3 id="org123fce2">Nifty utility functions</h3>
<div class="outline-text-3" id="text-org123fce2">
<p>
The <code>num_lines_in_file</code> function returns the number of lines in a file which is
useful to help guard against attempting to parse an empty file with <code>read.csv</code>.
</p>

<div class="org-src-container">
<pre class="src src-R"><span style="color: #6c3163; font-weight: bold;">num_lines_in_file</span> <span style="color: #ba2f59; font-weight: bold;">&lt;-</span> <span style="color: #3a81c3; font-weight: bold;">function</span><span style="color: #3a81c3;">(</span>fp<span style="color: #3a81c3;">)</span> <span style="color: #3a81c3;">{</span>
  wc_stdout <span style="color: #ba2f59; font-weight: bold;">&lt;-</span> system2<span style="color: #6c3163;">(</span>command = <span style="color: #2d9574;">"wc"</span>, args = c<span style="color: #2d9574;">(</span><span style="color: #2d9574;">"-l"</span>, fp<span style="color: #2d9574;">)</span>, stdout = <span style="color: #4e3163;">TRUE</span><span style="color: #6c3163;">)</span>
  as.numeric<span style="color: #6c3163;">(</span>head<span style="color: #2d9574;">(</span>unlist<span style="color: #67b11d;">(</span>strsplit<span style="color: #b1951d;">(</span>x = wc_stdout, split = <span style="color: #2d9574;">" "</span><span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span>,<span style="color: #4e3163;">1</span><span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span>
<span style="color: #3a81c3;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org93d7e8c" class="outline-3">
<h3 id="org93d7e8c">Cheat sheets</h3>
<div class="outline-text-3" id="text-org93d7e8c">
<ul class="org-ul">
<li><a href="https://stuff.mit.edu/afs/athena/software/r/current/RStudio/resources/roxygen_help.html">roxygen(2)</a></li>
<li><a href="https://www.rstudio.com/wp-content/uploads/2015/02/rmarkdown-cheatsheet.pdf">rmarkdown</a></li>
<li><a href="https://evoldyn.gitlab.io/evomics-2018/ref-sheets/R_purrr.pdf">purrr</a></li>
<li><a href="../resources/ess-cheat-sheet.pdf">ESS</a></li>
</ul>
</div>
</div>

<div id="outline-container-org8b0968e" class="outline-3">
<h3 id="org8b0968e">Data structures</h3>
<div class="outline-text-3" id="text-org8b0968e">
</div>
<div id="outline-container-org09f3797" class="outline-4">
<h4 id="org09f3797">Hashmap</h4>
<div class="outline-text-4" id="text-org09f3797">
<p>
The environment builtin data structure can be used as a hashmap (since it hashes
by default), a.k.a. map, dictionary, loopkup&#x2026;
</p>

<div class="org-src-container">
<pre class="src src-R">my_dict <span style="color: #ba2f59; font-weight: bold;">&lt;-</span> new.env<span style="color: #3a81c3;">(</span>hash = <span style="color: #4e3163;">TRUE</span><span style="color: #3a81c3;">)</span>
my_dict<span style="color: #3a81c3;">[</span><span style="color: #6c3163;">[</span><span style="color: #2d9574;">"key"</span><span style="color: #6c3163;">]</span><span style="color: #3a81c3;">]</span> <span style="color: #ba2f59; font-weight: bold;">&lt;-</span> <span style="color: #4e3163;">2</span>
my_dict<span style="color: #3a81c3;">[</span><span style="color: #6c3163;">[</span><span style="color: #2d9574;">"key"</span><span style="color: #6c3163;">]</span><span style="color: #3a81c3;">]</span> <span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">will return 2.</span>
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-org8ba29d7" class="outline-2">
<h2 id="org8ba29d7">Statistics with R</h2>
<div class="outline-text-2" id="text-org8ba29d7">
</div>
<div id="outline-container-orgc0b6e53" class="outline-3">
<h3 id="orgc0b6e53">Linear regression <code>lm</code></h3>
<div class="outline-text-3" id="text-orgc0b6e53">
<p>
<a href="./statistics-notes.html">NOTES</a>
</p>
</div>
</div>

<div id="outline-container-orgf3756a6" class="outline-3">
<h3 id="orgf3756a6"><span class="todo TODO">TODO</span> Mathematical optimisation</h3>
<div class="outline-text-3" id="text-orgf3756a6">
<p>
<a href="https://stat.ethz.ch/R-manual/R-devel/library/stats/html/nlm.html"><code>nlm</code></a>   
</p>
</div>
</div>

<div id="outline-container-orgcd778e0" class="outline-3">
<h3 id="orgcd778e0">Computational geography and cartography</h3>
<div class="outline-text-3" id="text-orgcd778e0">
<p>
See <a href="./computational-geography-notes.html">my other notes on this</a>.
</p>
</div>
</div>

<div id="outline-container-orge294d07" class="outline-3">
<h3 id="orge294d07">Differential equations with <code>deSolve</code></h3>
<div class="outline-text-3" id="text-orge294d07">
</div>
<div id="outline-container-org9ac098c" class="outline-4">
<h4 id="org9ac098c">Basic SIR example</h4>
<div class="outline-text-4" id="text-org9ac098c">
<p>
Simple SIR model 
</p>

<p>
\[
\frac{ds}{dt} = -\beta s i \quad\text{and}\quad \frac{di}{dt} = \beta s i - \gamma i.
\]
</p>

<p>
The following demonstrates how to solve this system with <code>deSolve</code>.
</p>

<div class="org-src-container">
<pre class="src src-R"><span style="color: #3a81c3;">library</span><span style="color: #3a81c3;">(</span>deSolve<span style="color: #3a81c3;">)</span>

<span style="color: #6c3163; font-weight: bold;">sir_diff</span> <span style="color: #ba2f59; font-weight: bold;">&lt;-</span> <span style="color: #3a81c3; font-weight: bold;">function</span><span style="color: #3a81c3;">(</span>time, state, params<span style="color: #3a81c3;">)</span> <span style="color: #3a81c3;">{</span>
    with<span style="color: #6c3163;">(</span>as.list<span style="color: #2d9574;">(</span>c<span style="color: #67b11d;">(</span>params, state<span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>, <span style="color: #2d9574;">{</span>
        ds <span style="color: #ba2f59; font-weight: bold;">&lt;-</span> - beta * susceptible * infectious
        di <span style="color: #ba2f59; font-weight: bold;">&lt;-</span> beta * susceptible * infectious - gamma * infectious
        list<span style="color: #67b11d;">(</span>c<span style="color: #b1951d;">(</span>ds, di<span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span>
    <span style="color: #2d9574;">}</span><span style="color: #6c3163;">)</span>
<span style="color: #3a81c3;">}</span>

params <span style="color: #ba2f59; font-weight: bold;">&lt;-</span> c<span style="color: #3a81c3;">(</span>beta = <span style="color: #4e3163;">1.2</span>, gamma = <span style="color: #4e3163;">1</span><span style="color: #3a81c3;">)</span>
state <span style="color: #ba2f59; font-weight: bold;">&lt;-</span> c<span style="color: #3a81c3;">(</span>susceptible = <span style="color: #4e3163;">0.99</span>, infectious = <span style="color: #4e3163;">0.01</span><span style="color: #3a81c3;">)</span>
times <span style="color: #ba2f59; font-weight: bold;">&lt;-</span> seq<span style="color: #3a81c3;">(</span>from = <span style="color: #4e3163;">0</span>, to = <span style="color: #4e3163;">20</span>, length = <span style="color: #4e3163;">100</span><span style="color: #3a81c3;">)</span>
pd <span style="color: #ba2f59; font-weight: bold;">&lt;-</span> matrix<span style="color: #3a81c3;">(</span>nrow = <span style="color: #4e3163;">2</span>, ncol = <span style="color: #4e3163;">2</span>, data = <span style="color: #4e3163;">0</span><span style="color: #3a81c3;">)</span>
out1 <span style="color: #ba2f59; font-weight: bold;">&lt;-</span> deSolve::ode<span style="color: #3a81c3;">(</span>state, times, sir_diff, parms = params<span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org065670b" class="outline-4">
<h4 id="org065670b">SIR example with C implementation</h4>
<div class="outline-text-4" id="text-org065670b">
<p>
Then we can implement the differential in C as 
</p>

<div class="org-src-container">
<pre class="src src-C"><span style="color: #2aa1ae; background-color: #ecf3ec;">/* </span><span style="color: #2aa1ae; background-color: #ecf3ec;">file sirmod.c</span><span style="color: #2aa1ae; background-color: #ecf3ec;"> */</span>
<span style="color: #6c3163;">#include</span> <span style="color: #3a81c3;">&lt;</span><span style="color: #2d9574;">R.h</span><span style="color: #3a81c3;">&gt;</span>

<span style="color: #3a81c3; font-weight: bold;">static</span> <span style="color: #ba2f59; font-weight: bold;">double</span> <span style="color: #715ab1;">params</span><span style="color: #3a81c3;">[</span><span style="color: #4e3163;">2</span><span style="color: #3a81c3;">]</span>;
<span style="color: #6c3163;">#define</span> <span style="color: #715ab1;">beta</span> params<span style="color: #3a81c3;">[</span><span style="color: #4e3163;">0</span><span style="color: #3a81c3;">]</span>
<span style="color: #6c3163;">#define</span> <span style="color: #715ab1;">gamma</span> params<span style="color: #3a81c3;">[</span><span style="color: #4e3163;">1</span><span style="color: #3a81c3;">]</span>

<span style="color: #2aa1ae; background-color: #ecf3ec;">/* </span><span style="color: #2aa1ae; background-color: #ecf3ec;">initializer</span><span style="color: #2aa1ae; background-color: #ecf3ec;"> */</span>
<span style="color: #ba2f59; font-weight: bold;">void</span> <span style="color: #6c3163; font-weight: bold;">initmod</span><span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">void</span> <span style="color: #6c3163;">(</span>* <span style="color: #6c3163; font-weight: bold;">odeparams</span><span style="color: #6c3163;">)(</span><span style="color: #ba2f59; font-weight: bold;">int</span> *, <span style="color: #ba2f59; font-weight: bold;">double</span> *<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3;">{</span>
  <span style="color: #ba2f59; font-weight: bold;">int</span> <span style="color: #715ab1;">N</span>=<span style="color: #4e3163;">2</span>;
  odeparams<span style="color: #6c3163;">(</span>&amp;N, params<span style="color: #6c3163;">)</span>;
<span style="color: #3a81c3;">}</span>

<span style="color: #2aa1ae; background-color: #ecf3ec;">/* </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Derivatives and 1 output variable</span><span style="color: #2aa1ae; background-color: #ecf3ec;"> */</span>
<span style="color: #ba2f59; font-weight: bold;">void</span> <span style="color: #6c3163; font-weight: bold;">derivs</span> <span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">int</span> *<span style="color: #715ab1;">neq</span>, <span style="color: #ba2f59; font-weight: bold;">double</span> *<span style="color: #715ab1;">t</span>, <span style="color: #ba2f59; font-weight: bold;">double</span> *<span style="color: #715ab1;">y</span>, <span style="color: #ba2f59; font-weight: bold;">double</span> *<span style="color: #715ab1;">ydot</span>,
             <span style="color: #ba2f59; font-weight: bold;">double</span> *<span style="color: #715ab1;">yout</span>, <span style="color: #ba2f59; font-weight: bold;">int</span> *<span style="color: #715ab1;">ip</span><span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3;">{</span>
  <span style="color: #3a81c3; font-weight: bold;">if</span> <span style="color: #6c3163;">(</span>ip<span style="color: #2d9574;">[</span><span style="color: #4e3163;">0</span><span style="color: #2d9574;">]</span> &lt;<span style="color: #4e3163;">1</span><span style="color: #6c3163;">)</span> error<span style="color: #6c3163;">(</span><span style="color: #2d9574;">"nout should be at least 1"</span><span style="color: #6c3163;">)</span>;
  ydot<span style="color: #6c3163;">[</span><span style="color: #4e3163;">0</span><span style="color: #6c3163;">]</span> = -beta*y<span style="color: #6c3163;">[</span><span style="color: #4e3163;">0</span><span style="color: #6c3163;">]</span>*y<span style="color: #6c3163;">[</span><span style="color: #4e3163;">1</span><span style="color: #6c3163;">]</span>;
  ydot<span style="color: #6c3163;">[</span><span style="color: #4e3163;">1</span><span style="color: #6c3163;">]</span> = beta*y<span style="color: #6c3163;">[</span><span style="color: #4e3163;">0</span><span style="color: #6c3163;">]</span>*y<span style="color: #6c3163;">[</span><span style="color: #4e3163;">1</span><span style="color: #6c3163;">]</span> - gamma*y<span style="color: #6c3163;">[</span><span style="color: #4e3163;">1</span><span style="color: #6c3163;">]</span>;
  yout<span style="color: #6c3163;">[</span><span style="color: #4e3163;">0</span><span style="color: #6c3163;">]</span> = <span style="color: #4e3163;">1.0</span>-y<span style="color: #6c3163;">[</span><span style="color: #4e3163;">0</span><span style="color: #6c3163;">]</span>+y<span style="color: #6c3163;">[</span><span style="color: #4e3163;">1</span><span style="color: #6c3163;">]</span>;
<span style="color: #3a81c3;">}</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">/* </span><span style="color: #2aa1ae; background-color: #ecf3ec;">END file sirmod.c</span><span style="color: #2aa1ae; background-color: #ecf3ec;"> */</span>
</pre>
</div>

<p>
Then we need to compile this and load the object for use of <code>deSovle</code>
</p>

<div class="org-src-container">
<pre class="src src-R">system<span style="color: #3a81c3;">(</span><span style="color: #2d9574;">"R CMD SHLIB sirmod.c"</span><span style="color: #3a81c3;">)</span>
dyn.load<span style="color: #3a81c3;">(</span><span style="color: #2d9574;">"sirmod.so"</span><span style="color: #3a81c3;">)</span>
out2 <span style="color: #ba2f59; font-weight: bold;">&lt;-</span> deSolve::ode<span style="color: #3a81c3;">(</span>state, times, func = <span style="color: #2d9574;">"derivs"</span>, parms = params,
                     dllname = <span style="color: #2d9574;">"sirmod"</span>, initfunc = <span style="color: #2d9574;">"initmod"</span>, nout = <span style="color: #4e3163;">1</span>,
                     outnames = <span style="color: #2d9574;">"recovered"</span><span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org72a497a" class="outline-3">
<h3 id="org72a497a">MCMC (without <code>Stan</code>)</h3>
<div class="outline-text-3" id="text-org72a497a">
<p>
There is the package <code>mcmc</code> which looks like it does a solid job of the basics, although it takes an opinionated stance on how this should be done. 
Be careful with how you interpret the <code>batch</code> arguments.
The interface is designed for testing out tuning parameters to find something that works; make the most of this design.
</p>

<p>
<code>coda</code> is probably what you want to use to check the output beyond basic diagnostic plots.
</p>
</div>
</div>

<div id="outline-container-org4e3e283" class="outline-3">
<h3 id="org4e3e283">(Nonparametric) density estimation with <code>KernSmooth</code></h3>
<div class="outline-text-3" id="text-org4e3e283">
<p>
Here is an example looking at how to use <code>KernSmooth</code>.
</p>

<div class="org-src-container">
<pre class="src src-R"><span style="color: #3a81c3;">library</span><span style="color: #3a81c3;">(</span>KernSmooth<span style="color: #3a81c3;">)</span>

set.seed<span style="color: #3a81c3;">(</span><span style="color: #4e3163;">1</span><span style="color: #3a81c3;">)</span>

x <span style="color: #ba2f59; font-weight: bold;">&lt;-</span> c<span style="color: #3a81c3;">(</span>rpois<span style="color: #6c3163;">(</span>n = <span style="color: #4e3163;">500</span>, lambda=<span style="color: #4e3163;">10</span><span style="color: #6c3163;">)</span>,
       rpois<span style="color: #6c3163;">(</span>n = <span style="color: #4e3163;">500</span>, lambda = <span style="color: #4e3163;">30</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>

<span style="color: #6c3163; font-weight: bold;">f_x</span> <span style="color: #ba2f59; font-weight: bold;">&lt;-</span> <span style="color: #3a81c3; font-weight: bold;">function</span><span style="color: #3a81c3;">(</span>x, ...<span style="color: #3a81c3;">)</span> <span style="color: #3a81c3;">{</span>
  <span style="color: #4e3163;">0.5</span> * <span style="color: #6c3163;">(</span>dpois<span style="color: #2d9574;">(</span>x = x, lambda = <span style="color: #4e3163;">10</span>, ...<span style="color: #2d9574;">)</span> +
         dpois<span style="color: #2d9574;">(</span>x = x, lambda = <span style="color: #4e3163;">30</span>, ...<span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span>
<span style="color: #3a81c3;">}</span>

x_mesh <span style="color: #ba2f59; font-weight: bold;">&lt;-</span> <span style="color: #4e3163;">0</span>:<span style="color: #4e3163;">100</span>
y_mesh <span style="color: #ba2f59; font-weight: bold;">&lt;-</span> f_x<span style="color: #3a81c3;">(</span>x_mesh<span style="color: #3a81c3;">)</span>


kde_obj <span style="color: #ba2f59; font-weight: bold;">&lt;-</span> bkde<span style="color: #3a81c3;">(</span>x, bandwidth = <span style="color: #4e3163;">3</span>, range.x = c<span style="color: #6c3163;">(</span><span style="color: #4e3163;">0</span>,<span style="color: #4e3163;">100</span><span style="color: #6c3163;">)</span>, gridsize = <span style="color: #4e3163;">101</span><span style="color: #3a81c3;">)</span>

r_kde_samples <span style="color: #ba2f59; font-weight: bold;">&lt;-</span> sample<span style="color: #3a81c3;">(</span>x = kde_obj$x,
                       size = length<span style="color: #6c3163;">(</span>x<span style="color: #6c3163;">)</span>,
                       replace = <span style="color: #4e3163;">TRUE</span>,
                       prob = pmax<span style="color: #6c3163;">(</span><span style="color: #4e3163;">0</span>, kde_obj$y<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>

type_char <span style="color: #ba2f59; font-weight: bold;">&lt;-</span> c<span style="color: #3a81c3;">(</span><span style="color: #2d9574;">"true"</span>, <span style="color: #2d9574;">"estimate"</span><span style="color: #3a81c3;">)</span>

density_df <span style="color: #ba2f59; font-weight: bold;">&lt;-</span> data.frame<span style="color: #3a81c3;">(</span>x = c<span style="color: #6c3163;">(</span>x_mesh, x_mesh<span style="color: #6c3163;">)</span>,
                         y = c<span style="color: #6c3163;">(</span>y_mesh, pmax<span style="color: #2d9574;">(</span><span style="color: #4e3163;">0</span>, kde_obj$y<span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span>,
                         type = rep<span style="color: #6c3163;">(</span>type_char, each = <span style="color: #4e3163;">101</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>

sample_df <span style="color: #ba2f59; font-weight: bold;">&lt;-</span> data.frame<span style="color: #3a81c3;">(</span>x = c<span style="color: #6c3163;">(</span>x, r_kde_samples<span style="color: #6c3163;">)</span>,
                        type = rep<span style="color: #6c3163;">(</span>type_char,
                                   each = length<span style="color: #2d9574;">(</span>x<span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>

ggplot<span style="color: #3a81c3;">()</span> +
  geom_histogram<span style="color: #3a81c3;">(</span>data = sample_df,
                 mapping = aes<span style="color: #6c3163;">(</span>x = x, y = ..density.., fill = type<span style="color: #6c3163;">)</span>,
                 bins = <span style="color: #4e3163;">25</span>,
                 size = <span style="color: #4e3163;">3</span>,
                 position = <span style="color: #2d9574;">"dodge"</span><span style="color: #3a81c3;">)</span> +
  geom_line<span style="color: #3a81c3;">(</span>data = density_df,
            mapping = aes<span style="color: #6c3163;">(</span>x = x, y = y, colour = type<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Alex Zarebski</p>
<p class="date">Created: 2020-12-03 Thu 18:53</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
