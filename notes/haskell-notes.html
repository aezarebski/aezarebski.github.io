<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2021-10-01 Fri 15:46 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>aez-notes</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Alex Zarebski" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link id="stylesheet" rel="stylesheet" type="text/css" href="../css/stylesheet-dark.css" />
<script type="text/javascript">
// @license magnet:?xt=urn:btih:e95b018ef3580986a04669f1b5879592219e2a7a&dn=public-domain.txt Public Domain
<!--/*--><![CDATA[/*><!--*/
     function CodeHighlightOn(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.add("code-highlighted");
         target.classList.add("code-highlighted");
       }
     }
     function CodeHighlightOff(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.remove("code-highlighted");
         target.classList.remove("code-highlighted");
       }
     }
    /*]]>*///-->
// @license-end
</script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
});
</script>
<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML"></script>
</head>
<body>
<div id="content">
<h1 class="title">aez-notes</h1>
<p>
<a href="../index.html">Home</a>
</p>

<button type="button" onclick="toggleStyle()">Light/Dark</button>
<script src="./main.js"></script>

<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org59b37f2">Learning</a>
<ul>
<li><a href="#org6c363d2">Further reading</a></li>
</ul>
</li>
<li><a href="#orgdff5eb3">Tooling</a>
<ul>
<li><a href="#org0f2566b">Debugging</a></li>
<li><a href="#orga39ad0e"><code>.cabal</code> and Cabal</a></li>
<li><a href="#org56fd108"><code>stack</code> and friends</a></li>
<li><a href="#org26727d8">GHCUP</a></li>
<li><a href="#org366d66f">Profiling programs with stack</a></li>
<li><a href="#org1ef29df">Benchmarking with <code>criterion</code></a></li>
<li><a href="#orga08824c">Documentation with <code>haddock</code></a></li>
<li><a href="#orgb74f1e3">Linting <code>hindent</code></a></li>
<li><a href="#orgc4f2233">Haskell layer in Spacemacs</a></li>
</ul>
</li>
<li><a href="#orga95603c">Programming</a>
<ul>
<li><a href="#org6b35846">CLI</a></li>
<li><a href="#org36f0388">Testing <code>hspec</code></a></li>
<li><a href="#org98ed121">Testing <code>hspec</code> and <code>QuickCheck</code></a></li>
<li><a href="#org4bb76b0">Handy IO</a></li>
<li><a href="#org0eb3e68">Boring haskell and <code>rio</code></a></li>
<li><a href="#orgacc4347">Syntax</a></li>
<li><a href="#org4ef6cfc">Monad transformers with <code>mtl</code></a></li>
<li><a href="#orgcbc161f">Data structures and types</a></li>
<li><a href="#orga529127"><code>ST</code> monad</a></li>
<li><a href="#orgd5a4edc"><code>Either</code> monad</a></li>
<li><a href="#orgb2faa4e">JSON with Aeson</a></li>
<li><a href="#orgefe787c">GHC extensions</a></li>
<li><a href="#org480344f">GHC extensions: <code>DeriveX</code></a></li>
<li><a href="#orgdb77f73">Packages I like</a></li>
<li><a href="#org7ad9e95">Scary and terrifying functions!!!</a></li>
<li><a href="#org795228b">Parallel execution</a></li>
</ul>
</li>
<li><a href="#org1b41c64">Hackage</a>
<ul>
<li><a href="#org9c0246b">Development shell</a></li>
<li><a href="#org01e0d74">Notes about uploading a package to hackage</a></li>
<li><a href="#orga722cf0">Extracting example code</a></li>
</ul>
</li>
<li><a href="#org4942902">Type theory and functional programming</a></li>
<li><a href="#orgaccd5fd">Haskell for science</a>
<ul>
<li><a href="#org5e15a33">Optimisation</a></li>
<li><a href="#orge95a44b">Root finding</a></li>
<li><a href="#orgff6a7fd">Differential equations</a></li>
<li><a href="#org048a8bc">Random number simulation</a></li>
<li><a href="#orgf8faf18">Numbers</a></li>
<li><a href="#orgf8327eb">Special functions</a></li>
<li><a href="#org5acc9d4">Visualisation</a></li>
<li><a href="#org6fd4326">Mutable arrays</a></li>
</ul>
</li>
</ul>
</div>
</div>


<div id="org60af829" class="figure">
<p><img src="../images/haskell-logo.png" alt="haskell-logo.png" /> 
</p>
</div>

<div id="outline-container-org59b37f2" class="outline-2">
<h2 id="org59b37f2">Learning</h2>
<div class="outline-text-2" id="text-org59b37f2">
</div>
<div id="outline-container-org6c363d2" class="outline-3">
<h3 id="org6c363d2">Further reading</h3>
<div class="outline-text-3" id="text-org6c363d2">
<p>
<a href="../resources/haskell-cheat-sheet.pdf">HASKELL CHEAT SHEET</a>
</p>
</div>

<div id="outline-container-org982ede6" class="outline-4">
<h4 id="org982ede6">Blog posts</h4>
<div class="outline-text-4" id="text-org982ede6">
<ol class="org-ol">
<li><a href="https://lexi-lambda.github.io/blog/2018/02/10/an-opinionated-guide-to-haskell-in-2018/">An opinionated guide to Haskell in 2018</a></li>
<li><a href="https://laurentrdc.xyz/posts/existential.html">Can you make heterogeneous lists in Haskell? Sure — as long your intent is clear</a> and on the <a href="https://web.archive.org/web/20211001100607/https://laurentrdc.xyz/posts/existential.html">waybackmachine</a>.</li>
<li>Two interesting posts on type safety by <a href="https://www.parsonsmatt.org/about/">Matt Parsons</a>
<ul class="org-ul">
<li><a href="https://www.parsonsmatt.org/2018/10/02/small_types.html">Keep your types small&#x2026;</a></li>
<li><a href="https://www.parsonsmatt.org/2017/10/11/type_safety_back_and_forth.html">Type Safety Back and Forth</a></li>
</ul></li>
<li><a href="https://kowainik.github.io/posts/naming-conventions">Foo to Bar: Naming Conventions in Haskell</a></li>
<li><a href="https://mmhaskell.com/blog/2017/5/22/numbers-of-every-shape-and-size">Numbers of Every Shape and Size</a></li>
<li><a href="https://www.haskellforall.com/2021/05/the-trick-to-avoid-deeply-nested-error.html">The trick to avoid deeply-nested error-handling code</a></li>
<li><a href="https://kowainik.github.io/posts/haskell-mini-patterns">Haskell mini-patterns handbook</a></li>
<li><a href="https://vrom911.github.io/blog/common-stanzas">common stanzas</a> to keep cabal files DRY</li>
<li><a href="https://kowainik.github.io/posts/totality">Discussion of totality of functions</a></li>
<li><a href="https://jelv.is/blog/Structure-your-Errors/">Structure your Errors</a></li>
</ol>
</div>
</div>

<div id="outline-container-orgc90f530" class="outline-4">
<h4 id="orgc90f530">Unread blog posts</h4>
<div class="outline-text-4" id="text-orgc90f530">
<ul class="org-ul">
<li>unread <a href="https://kowainik.github.io/posts/fixity">Fix(ity) me</a></li>
<li>unread <a href="https://blog.jle.im/entry/introduction-to-singletons-1.html">Introduction to <code>singletons</code> 1</a> (dependent types)</li>
<li>unread <a href="https://markkarpov.com/post/existential-quantification.html">Existential quantification</a></li>
<li>unread <a href="https://www.schoolofhaskell.com/school/to-infinity-and-beyond/pick-of-the-week/guide-to-ghc-extensions/basic-syntax-extensions">basic syntax extensions</a> from the School of Haskell (reference material)</li>
</ul>
</div>
</div>

<div id="outline-container-org539cb85" class="outline-4">
<h4 id="org539cb85">Documentation</h4>
<div class="outline-text-4" id="text-org539cb85">
<ul class="org-ul">
<li><a href="https://www.haskell.org/definition/haskell2010.pdf">Haskell 2010 Language Report</a></li>
</ul>
</div>
</div>

<div id="outline-container-org72d097e" class="outline-4">
<h4 id="org72d097e">Books</h4>
<div class="outline-text-4" id="text-org72d097e">
<ul class="org-ul">
<li><a href="http://learnyouahaskell.com/chapters">Learn You a Haskell for Great Good!</a></li>
</ul>
</div>
</div>
</div>
</div>

<div id="outline-container-orgdff5eb3" class="outline-2">
<h2 id="orgdff5eb3">Tooling</h2>
<div class="outline-text-2" id="text-orgdff5eb3">
</div>
<div id="outline-container-org0f2566b" class="outline-3">
<h3 id="org0f2566b">Debugging</h3>
<div class="outline-text-3" id="text-org0f2566b">
<ol class="org-ol">
<li>Load the relevant module: <code>λ&gt; :load &lt;module.hs&gt;</code></li>
<li>Set a break point: <code>λ&gt; :break &lt;identifier&gt;</code> where identifier can be a
function name or line number</li>
<li>Evaluate relevant expression and inspect it with <code>:λ&gt; :print &lt;identifier&gt;</code></li>
</ol>

<p>
In the output <code>_result</code> is the name of the value of the current expression. When
working with <code>let</code> expressions the break point will be upon the body of the
expression rather than any of the values bound. The <code>break</code> command can also be
used to set breakpoints in other modules with <code>:break &lt;module&gt; &lt;n&gt;</code>, although
you have to be a little bit careful in this situation, since some functions may
go out of scope as you move between modules.
</p>

<p>
You can always use <code>:help</code> to get a listing, but here are some useful functions
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Command</th>
<th scope="col" class="org-left">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><code>:list</code></td>
<td class="org-left">See current line</td>
</tr>

<tr>
<td class="org-left"><code>:print</code></td>
<td class="org-left">Print variable</td>
</tr>

<tr>
<td class="org-left"><code>:step</code></td>
<td class="org-left">Step to next expression</td>
</tr>

<tr>
<td class="org-left"><code>:continue</code></td>
<td class="org-left">Run to next break</td>
</tr>

<tr>
<td class="org-left"><code>:show breaks</code></td>
<td class="org-left">Show break points</td>
</tr>

<tr>
<td class="org-left"><code>:delete &lt;n&gt;</code></td>
<td class="org-left">Delete break <code>n</code></td>
</tr>
</tbody>
</table>

<p>
Note that because the expressions are only lazily evaluated you may need to use
the <code>seq</code> function to force their evaluation in order to see what they are. You
can <code>fmap (flip seq ())</code> onto a functor to force the evaulation of its contents.
</p>
</div>

<div id="outline-container-org5e14962" class="outline-4">
<h4 id="org5e14962">Less recommended way of debugging</h4>
<div class="outline-text-4" id="text-org5e14962">
<p>
The <code>trace</code> function provided by <code>Debug.Trace</code> from the standard library is a
good way to inspect the values of variables from pure code while debugging. The
following function is nifty way to get a print out of particular values through
the computation.
</p>

<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #3a81c3; font-weight: bold;">import</span> <span style="color: #ba2f59; font-weight: bold;">Debug.Trace</span> <span style="color: #3a81c3;">(</span>trace, traceShow<span style="color: #3a81c3;">)</span>

<span style="color: #da8b55;">-- | Helper function while debugging.</span>
<span style="color: #da8b55;">--</span>
<span style="color: #da8b55;">-- &gt;&gt;&gt; showAndTell "foo: " 1</span>
<span style="color: #da8b55;">-- foo: 1</span>
<span style="color: #da8b55;">-- 1</span>
<span style="color: #da8b55;">--</span>
<span style="color: #6c3163; font-weight: bold;">showAndTell</span> <span style="color: #715ab1;">::</span> <span style="color: #ba2f59; font-weight: bold;">Show</span> a <span style="color: #715ab1;">=&gt;</span> <span style="color: #ba2f59; font-weight: bold;">String</span> <span style="color: #715ab1;">-&gt;</span> a <span style="color: #715ab1;">-&gt;</span> a
<span style="color: #6c3163; font-weight: bold;">showAndTell</span> msg x <span style="color: #715ab1;">=</span> trace <span style="color: #3a81c3;">(</span>msg <span style="color: #715ab1;">++</span> show x<span style="color: #3a81c3;">)</span> x
</pre>
</div>

<p>
The GHC user guide has a section on <a href="https://downloads.haskell.org/~ghc/7.4.1/docs/html/users_guide/ghci-debugger.html">the GHCI debugger</a>.
</p>
</div>
</div>
</div>

<div id="outline-container-orga39ad0e" class="outline-3">
<h3 id="orga39ad0e"><code>.cabal</code> and Cabal</h3>
<div class="outline-text-3" id="text-orga39ad0e">
<p>
The first part of a cabal file is called the <i>package properties</i> and then
definitions that come after that are called <i>stanzas</i>. You can use <a href="https://vrom911.github.io/blog/common-stanzas">common
stanzas</a> to keep cabal files DRY. There is also <code>dhall-to-cabal</code> if you want a
more powerful way to write cabal files.
</p>
</div>
</div>

<div id="outline-container-org56fd108" class="outline-3">
<h3 id="org56fd108"><code>stack</code> and friends</h3>
<div class="outline-text-3" id="text-org56fd108">
<p>
stack and cabal are the main build tools for haskell. stack was created as a
more user friendly version of cabal. 
</p>
</div>

<div id="outline-container-orgd5cd535" class="outline-4">
<h4 id="orgd5cd535">Installation, upgrading and uninstalling</h4>
<div class="outline-text-4" id="text-orgd5cd535">
<p>
There is a script from <code>commercialhaskell</code> which installs <code>stack</code>
</p>

<div class="org-src-container">
<pre class="src src-sh">curl -sSL https://get.haskellstack.org/ | sh
</pre>
</div>

<p>
The executable is in <code>/usr/local/bin</code> by default. To upgrade <code>stack</code> there is
the <code>stack upgrade</code> command. To uninstall, remove the stack executable and
<code>~/.stack</code> and the <code>.stack-work</code> from any projects using <code>stack</code>.
</p>

<p>
<code>stack</code> installs to <code>/home/&lt;username&gt;/.local/bin</code> by default, so you should add
this to your path
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #3a81c3;">export</span> <span style="color: #715ab1;">PATH</span>=/home/&lt;username&gt;/.local/bin:$<span style="color: #715ab1;">PATH</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org3a7e322" class="outline-4">
<h4 id="org3a7e322">Starting a new project</h4>
<div class="outline-text-4" id="text-org3a7e322">
<div class="org-src-container">
<pre class="src src-sh">stack new &lt;project-name&gt; &lt;template-name&gt;
<span style="color: #3a81c3;">cd</span> my-project
stack setup
stack build
stack exec my-project-exe
</pre>
</div>

<p>
Here <code>&lt;project-name&gt;</code> is the name of the directory that will be created to house
the project and <code>&lt;template-name&gt;</code> is the template to use; I like the <code>simple</code>
template because it uses cabal directly and is free from clutter. If there is
only library code and no executables, then the <code>simple-library</code> might be a
cleaner choice. Packages get added to <code>package.yaml</code> under <code>dependencies:</code> and
you start the REPL with <code>stack ghci</code>. Projects are configured by the <code>.cabal</code>
file, for <code>simple</code> and <code>simple-library</code>. <code>stack</code> can use <code>hpack</code> to convert a
<code>package.yaml</code> file to a <code>.cabal</code> file.
</p>
</div>
</div>

<div id="outline-container-org7ec14c0" class="outline-4">
<h4 id="org7ec14c0">Starting a new project (with white chocolate macadamia)</h4>
<div class="outline-text-4" id="text-org7ec14c0">
<p>
I wrote <code>white-chocolate-macadamia</code> which defines a minimalist project template.
It is hosted <a href="https://github.com/aezarebski/white-chocolate-macadamia">here</a>. To start a new project with it use the following command
</p>

<div class="org-src-container">
<pre class="src src-sh">stack new my-project https://raw.githubusercontent.com/aezarebski/white-chocolate-macadamia/main/macadamia.hsfiles
</pre>
</div>
</div>
</div>

<div id="outline-container-org78d733d" class="outline-4">
<h4 id="org78d733d">Commands</h4>
<div class="outline-text-4" id="text-org78d733d">
<p>
If you are ever unsure about some aspect of <code>stack</code>, appending <code>--help</code> is
usually pretty enlightening. There are few ways to initialise a project using
some standard templates.
</p>

<div class="org-src-container">
<pre class="src src-sh">stack new &lt;package-name&gt;
stack new &lt;package-name&gt; &lt;template-name&gt;        <span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Use a particular template</span>
stack new &lt;package-name&gt; --bare &lt;template-name&gt; <span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Without subdirectory</span>
</pre>
</div>

<p>
To build the targets described in the <code>.cabal</code> file there is <code>stack build</code>, but
unless you need GHC to optimise the executable, adding the <code>--fast</code> flag will
make it run faster. There is also the <code>--file-watch</code> flag which will cause it to
recompile each time that files are edited. There are many commands within
<code>stack</code> which are listed in the documentation. Run the executable with
</p>

<div class="org-src-container">
<pre class="src src-sh">stack exec -- &lt;target&gt; <span style="color: #3a81c3;">[</span>arguments<span style="color: #3a81c3;">]</span>
</pre>
</div>

<p>
To run the tests there is <code>stack test</code>. To build the documentation there is
<code>stack haddock</code> which if you only need the documentation of your dependencies,
you can speed up with <code>--haddock-deps</code>. Once you have the documentation build,
you can open the documentation for a particular package in the browser.
</p>

<div class="org-src-container">
<pre class="src src-sh">stack build --haddock-deps
stack haddock --open &lt;package&gt;
</pre>
</div>

<p>
To make the documentation searchable like the online version (though noticibly
more responsive) you can run a hoogle server. But first you must index the
documentation, and this will need to be done every time your dependencies
change.
</p>

<div class="org-src-container">
<pre class="src src-sh">stack hoogle -- generate --local 
stack hoogle -- server --local --port=<span style="color: #4e3163;">8080</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org25e60ae" class="outline-4">
<h4 id="org25e60ae">Building with nix</h4>
<div class="outline-text-4" id="text-org25e60ae">
<p>
When using stack and nix, the haskell dependencies are managed by stack and only
the non-haskell dependencies are managed by nix. You need nix installed on your
system for this to work, it will not be installed by stack. Adding the following
to your <code>stack.yaml</code> file will tell stack that you want to build your package in
a nix shell with these packages available.
</p>

<div class="org-src-container">
<pre class="src src-yaml"><span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">stack.yaml</span>
<span style="color: #715ab1;">nix</span>:
  <span style="color: #715ab1;">enable</span>: <span style="color: #4e3163;">true</span>
  <span style="color: #715ab1;">packages</span>: [glpk, pcre]
</pre>
</div>

<p>
You will need to double check that the resolver you have specified corresponds
to one of the GHC versions that are available in your nix channel. To find out
which versions of GHC are available to you, drop into a nix REPL with <code>nix repl</code>
and then load the available packages with <code>:l &lt;nixpkgs&gt;</code> then ask for a list of
the available compiler versions with <code>lib.attrNames haskell.compiler</code>.
</p>
</div>

<div id="outline-container-org6878588" class="outline-5">
<h5 id="org6878588">Further notes</h5>
<div class="outline-text-5" id="text-org6878588">
<ul class="org-ul">
<li>use <code>cabal2nix</code> to convert a project's cabal file into a nix derivation. As a
result, every time the cabal file changes the nix derivation will need to be
regenerated.</li>
<li>The <code>nix-build</code> command is used to build a package and the <code>nix-shell</code> command
is used to enter a shell configured for development of the package. You'll one
nix file for your overall package which imports the one that was generated by
<code>cabal2nix</code>.</li>
<li>Despite being able to use nix to build your haskell project, Gabriel
recommends sticking with cabal and just using nix to provision the development
environment.</li>
</ul>
</div>
</div>
</div>
</div>

<div id="outline-container-org26727d8" class="outline-3">
<h3 id="org26727d8">GHCUP</h3>
<div class="outline-text-3" id="text-org26727d8">
<p>
GHCUP is a tool to simplify the process of managing the Haskell toolchain. The
following is a very nifty command to install a particular version of GHC and the
associated language server for your IDE.
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">set the currently "active" GHC version</span>
ghcup set ghc <span style="color: #4e3163;">8.4.4</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org366d66f" class="outline-3">
<h3 id="org366d66f">Profiling programs with stack</h3>
<div class="outline-text-3" id="text-org366d66f">
<p>
Stack provides some features to help make use of GHC's profiling features. This
is useful if you are trying to find bottleneck's in your program. If you want to
benchmark different methods you probably want to look at <a href="#org1ef29df"><code>criterion</code></a>.
</p>

<ol class="org-ol">
<li>Recompile your project with <code>--profile</code></li>
</ol>

<div class="org-src-container">
<pre class="src src-sh">stack build --profile
</pre>
</div>

<ol class="org-ol">
<li>Run the program passing the correct flags to the run time</li>
</ol>

<div class="org-src-container">
<pre class="src src-sh">stack --profile exec -- my-program +RTS -p
</pre>
</div>

<ol class="org-ol">
<li>Inspect the resulting <code>.prof</code> file.</li>
</ol>

<p>
One way to inspect the <code>.prof</code> file is to use the <code>profiteur</code> tool to generate a
tree map of both the time and allocation required to run the program. This
program can be downloaded via nix.
</p>

<div class="org-src-container">
<pre class="src src-sh">nix-shell -p haskellPackages.profiteur
profiteur my-program.prof
firefox my-program.prof.html
</pre>
</div>
</div>
</div>

<div id="outline-container-org1ef29df" class="outline-3">
<h3 id="org1ef29df">Benchmarking with <code>criterion</code></h3>
<div class="outline-text-3" id="text-org1ef29df">
<p>
Criterion is <i>the</i> tools for benchmarking code. This is useful if you have a
couple of candidate implementations of a computation and you want to compare
them. If you want to find bottle nexts in you program, you probably want to look
at <a href="#org366d66f">stack's profiling features</a>
</p>

<p>
You build an application with <code>defaultMain</code> which sets up the benchmarks with a
CLI. The <code>defaultMain</code> expects a <code>[Benchmark]</code>, you group multiple benchmarks
with <code>bgroup</code>, you create <code>Benchmark</code> objects with <code>bench</code>.
</p>

<p>
If you want to use some pre-computed environment variables in a benchmark, you
need the <code>env</code> function to manage this. The following snippet demonstrates how
to do this, generating some random variables once, and then passing them into a
function.
</p>

<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #3a81c3; font-weight: bold;">module</span> <span style="color: #ba2f59; font-weight: bold;">Main</span> <span style="color: #3a81c3; font-weight: bold;">where</span>

<span style="color: #3a81c3; font-weight: bold;">import</span> <span style="color: #ba2f59; font-weight: bold;">Control.Monad</span>
<span style="color: #3a81c3; font-weight: bold;">import</span> <span style="color: #ba2f59; font-weight: bold;">Criterion.Main</span>
<span style="color: #3a81c3; font-weight: bold;">import</span> <span style="color: #3a81c3; font-weight: bold;">qualified</span> <span style="color: #ba2f59; font-weight: bold;">Data.Vector</span> <span style="color: #3a81c3; font-weight: bold;">as</span> <span style="color: #ba2f59; font-weight: bold;">V</span>
<span style="color: #3a81c3; font-weight: bold;">import</span> <span style="color: #ba2f59; font-weight: bold;">Statistics.Sample</span>
<span style="color: #3a81c3; font-weight: bold;">import</span> <span style="color: #3a81c3; font-weight: bold;">qualified</span> <span style="color: #ba2f59; font-weight: bold;">System.Random.MWC</span> <span style="color: #3a81c3; font-weight: bold;">as</span> <span style="color: #ba2f59; font-weight: bold;">MWC</span>

<span style="color: #6c3163; font-weight: bold;">sampleMeanBench</span> <span style="color: #715ab1;">::</span> <span style="color: #ba2f59; font-weight: bold;">String</span> <span style="color: #715ab1;">-&gt;</span> <span style="color: #3a81c3;">[</span><span style="color: #ba2f59; font-weight: bold;">Double</span><span style="color: #3a81c3;">]</span> <span style="color: #715ab1;">-&gt;</span> <span style="color: #ba2f59; font-weight: bold;">Benchmark</span>
<span style="color: #6c3163; font-weight: bold;">sampleMeanBench</span> name xs <span style="color: #715ab1;">=</span> bench name <span style="color: #715ab1;">$</span> nf <span style="color: #3a81c3;">(</span>mean <span style="color: #715ab1;">.</span> V.fromList<span style="color: #3a81c3;">)</span> xs

<span style="color: #6c3163; font-weight: bold;">getRandomList</span> <span style="color: #715ab1;">::</span> <span style="color: #ba2f59; font-weight: bold;">Int</span> <span style="color: #715ab1;">-&gt;</span> <span style="color: #ba2f59; font-weight: bold;">IO</span> <span style="color: #3a81c3;">[</span><span style="color: #ba2f59; font-weight: bold;">Double</span><span style="color: #3a81c3;">]</span>
<span style="color: #6c3163; font-weight: bold;">getRandomList</span> n <span style="color: #715ab1;">=</span> <span style="color: #3a81c3; font-weight: bold;">do</span>
  gen <span style="color: #715ab1;">&lt;-</span> MWC.create
  foo <span style="color: #715ab1;">&lt;-</span> replicateM n <span style="color: #3a81c3;">(</span>MWC.uniform gen<span style="color: #3a81c3;">)</span>
  return foo

<span style="color: #2aa1ae; background-color: #ecf3ec;">-- </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Our benchmark harness.</span>
<span style="color: #6c3163; font-weight: bold;">main</span> <span style="color: #715ab1;">=</span>
  defaultMain
    <span style="color: #3a81c3;">[</span> bgroup
        <span style="color: #2d9574;">"meanPure"</span>
        <span style="color: #6c3163;">[</span> sampleMeanBench <span style="color: #2d9574;">"small"</span> <span style="color: #2d9574;">[</span><span style="color: #4e3163;">1</span> <span style="color: #715ab1;">..</span> <span style="color: #4e3163;">10</span><span style="color: #2d9574;">]</span>
        , sampleMeanBench <span style="color: #2d9574;">"medium"</span> <span style="color: #2d9574;">[</span><span style="color: #4e3163;">1</span> <span style="color: #715ab1;">..</span> <span style="color: #4e3163;">100</span><span style="color: #2d9574;">]</span>
        , sampleMeanBench <span style="color: #2d9574;">"large"</span> <span style="color: #2d9574;">[</span><span style="color: #4e3163;">1</span> <span style="color: #715ab1;">..</span> <span style="color: #4e3163;">1000</span><span style="color: #2d9574;">]</span>
        <span style="color: #6c3163;">]</span>
    , bgroup
        <span style="color: #2d9574;">"meanEnv"</span>
        <span style="color: #6c3163;">[</span> env <span style="color: #2d9574;">(</span>getRandomList <span style="color: #4e3163;">10</span><span style="color: #2d9574;">)</span> <span style="color: #2d9574;">(</span><span style="color: #715ab1;">\</span>xs <span style="color: #715ab1;">-&gt;</span> sampleMeanBench <span style="color: #2d9574;">"small"</span> xs<span style="color: #2d9574;">)</span>
        , env <span style="color: #2d9574;">(</span>getRandomList <span style="color: #4e3163;">100</span><span style="color: #2d9574;">)</span> <span style="color: #2d9574;">(</span><span style="color: #715ab1;">\</span>xs <span style="color: #715ab1;">-&gt;</span> sampleMeanBench <span style="color: #2d9574;">"medium"</span> xs<span style="color: #2d9574;">)</span>
        , env <span style="color: #2d9574;">(</span>getRandomList <span style="color: #4e3163;">1000</span><span style="color: #2d9574;">)</span> <span style="color: #2d9574;">(</span><span style="color: #715ab1;">\</span>xs <span style="color: #715ab1;">-&gt;</span> sampleMeanBench <span style="color: #2d9574;">"large"</span> xs<span style="color: #2d9574;">)</span>
        <span style="color: #6c3163;">]</span>
    <span style="color: #3a81c3;">]</span>
</pre>
</div>

<p>
This could be run with the following to get a HTML report as output.
</p>

<pre class="example">
$ stack exec -- criterion-demo --output report.html
</pre>

<p>
Note that in the linear regression results reported, this considers the
relationship between the number of evaluations and the time that required.
</p>
</div>
</div>

<div id="outline-container-orga08824c" class="outline-3">
<h3 id="orga08824c">Documentation with <code>haddock</code></h3>
<div class="outline-text-3" id="text-orga08824c">
</div>
<div id="outline-container-org750e294" class="outline-4">
<h4 id="org750e294">Markup</h4>
<div class="outline-text-4" id="text-org750e294">
<p>
<a href="https://haskell-haddock.readthedocs.io/en/latest/markup.html#markup">Markup documentation</a>
</p>

<ul class="org-ul">
<li><code>/italics/</code></li>
<li><code>__bold__</code></li>
<li><code>'hyperlink'</code></li>
<li><code>@monospace@</code></li>
<li><code>![image description](pathtoimage.png)</code></li>
<li><code>[some link](http://example.com)</code></li>
</ul>

<blockquote>
<p>
Haddock supports LaTeX syntax for rendering mathematical notation. The
delimiters are \[...\] for displayed mathematics and \(...\) for in-line
mathematics.
</p>
</blockquote>

<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #da8b55;">-- | This is an enumerated list:</span>
<span style="color: #da8b55;">--</span>
<span style="color: #da8b55;">--     (1) first item</span>
<span style="color: #da8b55;">--     2. second item</span>
<span style="color: #da8b55;">--</span>
<span style="color: #da8b55;">-- This is a bulleted list:</span>
<span style="color: #da8b55;">--</span>
<span style="color: #da8b55;">--     * first item</span>
<span style="color: #da8b55;">--     * second item</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdceeffa" class="outline-4">
<h4 id="orgdceeffa">Functions</h4>
<div class="outline-text-4" id="text-orgdceeffa">
<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #da8b55;">-- | Two examples are given below:</span>
<span style="color: #da8b55;">--</span>
<span style="color: #da8b55;">-- &gt;&gt;&gt; fib 10</span>
<span style="color: #da8b55;">-- 55</span>
<span style="color: #da8b55;">--</span>
<span style="color: #da8b55;">-- &gt;&gt;&gt; putStrLn "foo\nbar"</span>
<span style="color: #da8b55;">-- foo</span>
<span style="color: #da8b55;">-- bar</span>
<span style="color: #6c3163; font-weight: bold;">f</span>  <span style="color: #715ab1;">::</span> <span style="color: #ba2f59; font-weight: bold;">Int</span>      <span style="color: #da8b55;">-- ^ The 'Int' argument</span>
   <span style="color: #715ab1;">-&gt;</span> <span style="color: #ba2f59; font-weight: bold;">Float</span>    <span style="color: #da8b55;">-- ^ The 'Float' argument</span>
   <span style="color: #715ab1;">-&gt;</span> <span style="color: #ba2f59; font-weight: bold;">IO</span> <span style="color: #3a81c3; font-weight: bold;">()</span>    <span style="color: #da8b55;">-- ^ The return value</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org1a2f6d8" class="outline-4">
<h4 id="org1a2f6d8">Data</h4>
<div class="outline-text-4" id="text-org1a2f6d8">
<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #3a81c3; font-weight: bold;">data</span> <span style="color: #ba2f59; font-weight: bold;">T</span> a b
  <span style="color: #da8b55;">-- | This is the documentation for the 'C1' constructor</span>
  <span style="color: #715ab1;">=</span> <span style="color: #ba2f59; font-weight: bold;">C1</span> a b
  <span style="color: #da8b55;">-- | This is the documentation for the 'C2' constructor</span>
  <span style="color: #715ab1;">|</span> <span style="color: #ba2f59; font-weight: bold;">C2</span> a b
</pre>
</div>
</div>
</div>

<div id="outline-container-org2f2757d" class="outline-4">
<h4 id="org2f2757d">Records</h4>
<div class="outline-text-4" id="text-org2f2757d">
<p>
Sometimes <code>hindent</code> will reformat record definitions in a way that does not
appear to be compatible with <code>haddock</code>.
</p>

<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #3a81c3; font-weight: bold;">data</span> <span style="color: #ba2f59; font-weight: bold;">R</span> a b <span style="color: #715ab1;">=</span>
  <span style="color: #ba2f59; font-weight: bold;">C</span> <span style="color: #3a81c3;">{</span> <span style="color: #da8b55;">-- | This is the documentation for the 'a' field</span>
      a <span style="color: #715ab1;">::</span> a,
      <span style="color: #da8b55;">-- | This is the documentation for the 'b' field</span>
      b <span style="color: #715ab1;">::</span> b
    <span style="color: #3a81c3;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc89b15e" class="outline-4">
<h4 id="orgc89b15e">Usage</h4>
<div class="outline-text-4" id="text-orgc89b15e">
<p>
Build and open the documentation in the browser. This does not seem to work well
from <code>eshell</code> but works fine from a bash shell.
</p>

<div class="org-src-container">
<pre class="src src-sh">stack haddock
stack haddock --open
</pre>
</div>

<p>
But a much quicker way to is to not build the documentation for the dependencies
by using the following command instead.
</p>

<div class="org-src-container">
<pre class="src src-sh">stack haddock --no-haddock-deps --open
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgb74f1e3" class="outline-3">
<h3 id="orgb74f1e3">Linting <code>hindent</code></h3>
<div class="outline-text-3" id="text-orgb74f1e3">
<p>
<code>hindent</code> is a pretty printer which can be used to lint Haskell code.
Install it with <code>stack install hindent</code> and pay attention to where it installs because you need that on your path.
There is an Emacs minor mode, <code>hindent-mode</code>, which exposes the functionality of this program: <code>hindent-reformat-*</code>.
</p>

<p>
I have the following shortcuts:
</p>

<ul class="org-ul">
<li><code>SPC o h h r</code> owner haskell hindent region</li>
<li><code>SPC o h h b</code> owner haskell hindent buffer</li>
</ul>
</div>
</div>

<div id="outline-container-orgc4f2233" class="outline-3">
<h3 id="orgc4f2233">Haskell layer in Spacemacs</h3>
<div class="outline-text-3" id="text-orgc4f2233">
<p>
To enable the <a href="https://github.com/syl20bnr/spacemacs/tree/master/layers/%2Blang/haskell">Haskell layer</a> add the following to <code>dotspacemacs-configuration-layers</code>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #3a81c3;">(</span>haskell <span style="color: #3a81c3;">:variables</span>
         haskell-enable-hindent-style <span style="color: #2d9574;">"johan-tibell"</span>
         haskell-process-type 'stack-ghci<span style="color: #3a81c3;">)</span>
</pre>
</div>

<p>
If you want to make use of <code>hindent</code>, you'll need to make sure that the
executable is on the path Emacs uses: <code>exec-path</code> or <code>eshell-path-env</code>.
</p>
</div>
</div>
</div>

<div id="outline-container-orga95603c" class="outline-2">
<h2 id="orga95603c">Programming</h2>
<div class="outline-text-2" id="text-orga95603c">
</div>
<div id="outline-container-org6b35846" class="outline-3">
<h3 id="org6b35846">CLI</h3>
<div class="outline-text-3" id="text-org6b35846">
<p>
The function <code>getArgs</code> from <code>System.Environment</code> in <code>base</code> is how you get
command line arguments. 
</p>

<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #3a81c3; font-weight: bold;">import</span> <span style="color: #ba2f59; font-weight: bold;">System.Environment</span>

<span style="color: #6c3163; font-weight: bold;">main</span> <span style="color: #715ab1;">=</span> <span style="color: #3a81c3; font-weight: bold;">do</span>
  a <span style="color: #715ab1;">&lt;-</span> getArgs
  print a
  return <span style="color: #3a81c3; font-weight: bold;">()</span>
</pre>
</div>

<p>
The following example demonstrates how you might get some data from a user at
the command line at run time rather than data about how the program was called.
</p>

<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #6c3163; font-weight: bold;">main</span> <span style="color: #715ab1;">::</span> <span style="color: #ba2f59; font-weight: bold;">IO</span> <span style="color: #3a81c3; font-weight: bold;">()</span>
<span style="color: #6c3163; font-weight: bold;">main</span> <span style="color: #715ab1;">=</span> <span style="color: #3a81c3; font-weight: bold;">do</span>
  putStrLn <span style="color: #2d9574;">"Do you want to continue? [y/n]"</span>
  response <span style="color: #715ab1;">&lt;-</span> getChar
  <span style="color: #3a81c3; font-weight: bold;">if</span> response <span style="color: #715ab1;">==</span> <span style="color: #2d9574;">'n'</span>
    <span style="color: #3a81c3; font-weight: bold;">then</span>
      <span style="color: #3a81c3; font-weight: bold;">do</span>
        putStrLn <span style="color: #2d9574;">"\nmaybe next time :)"</span>
        return <span style="color: #3a81c3; font-weight: bold;">()</span>
    <span style="color: #3a81c3; font-weight: bold;">else</span>
      <span style="color: #3a81c3; font-weight: bold;">if</span> response <span style="color: #715ab1;">/=</span> <span style="color: #2d9574;">'y'</span>
        <span style="color: #3a81c3; font-weight: bold;">then</span>
          <span style="color: #3a81c3; font-weight: bold;">do</span>
            putStrLn <span style="color: #2d9574;">"\n\nI doughnut understand..."</span>
            main
        <span style="color: #3a81c3; font-weight: bold;">else</span>
          <span style="color: #3a81c3; font-weight: bold;">do</span>
            putStrLn <span style="color: #2d9574;">"\nwoohoo!"</span>
            return <span style="color: #3a81c3; font-weight: bold;">()</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org36f0388" class="outline-3">
<h3 id="org36f0388">Testing <code>hspec</code></h3>
<div class="outline-text-3" id="text-org36f0388">
<p>
Add <code>hspec</code> to your dependencies and observe the following example 
</p>

<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #3a81c3; font-weight: bold;">import</span> <span style="color: #ba2f59; font-weight: bold;">Test.Hspec</span>
<span style="color: #3a81c3; font-weight: bold;">import</span> <span style="color: #ba2f59; font-weight: bold;">Control.Exception</span> <span style="color: #3a81c3;">(</span>evaluate<span style="color: #3a81c3;">)</span>

<span style="color: #6c3163; font-weight: bold;">main</span> <span style="color: #715ab1;">::</span> <span style="color: #ba2f59; font-weight: bold;">IO</span> <span style="color: #3a81c3; font-weight: bold;">()</span>
<span style="color: #6c3163; font-weight: bold;">main</span> <span style="color: #715ab1;">=</span> hspec <span style="color: #715ab1;">$</span> <span style="color: #3a81c3; font-weight: bold;">do</span>
  describe <span style="color: #2d9574;">"Prelude.head"</span> <span style="color: #715ab1;">$</span> <span style="color: #3a81c3; font-weight: bold;">do</span>
    it <span style="color: #2d9574;">"returns the first element of a list"</span> <span style="color: #715ab1;">$</span> <span style="color: #3a81c3; font-weight: bold;">do</span>
      head <span style="color: #3a81c3;">[</span><span style="color: #4e3163;">23</span> <span style="color: #715ab1;">..</span><span style="color: #3a81c3;">]</span> <span style="color: #715ab1;">`shouldBe`</span> <span style="color: #3a81c3;">(</span><span style="color: #4e3163;">23</span> <span style="color: #715ab1;">::</span> <span style="color: #ba2f59; font-weight: bold;">Int</span><span style="color: #3a81c3;">)</span>

    it <span style="color: #2d9574;">"throws an exception if used with an empty list"</span> <span style="color: #715ab1;">$</span> <span style="color: #3a81c3; font-weight: bold;">do</span>
      evaluate <span style="color: #3a81c3;">(</span>head <span style="color: #6c3163; font-weight: bold;">[]</span><span style="color: #3a81c3;">)</span> <span style="color: #715ab1;">`shouldThrow`</span> anyException
</pre>
</div>
</div>
</div>

<div id="outline-container-org98ed121" class="outline-3">
<h3 id="org98ed121">Testing <code>hspec</code> and <code>QuickCheck</code></h3>
<div class="outline-text-3" id="text-org98ed121">
<p>
You can use <a href="https://hspec.github.io/quickcheck.html">QuickCheck in your Hspec tests</a>
</p>

<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #6c3163;">{-# LANGUAGE DeriveGeneric #-}</span>

<span style="color: #3a81c3; font-weight: bold;">module</span> <span style="color: #ba2f59; font-weight: bold;">Main</span> <span style="color: #3a81c3; font-weight: bold;">where</span>

<span style="color: #3a81c3; font-weight: bold;">import</span> <span style="color: #ba2f59; font-weight: bold;">GHC.Generics</span>
<span style="color: #3a81c3; font-weight: bold;">import</span> <span style="color: #ba2f59; font-weight: bold;">Generic.Random</span> <span style="color: #3a81c3;">(</span>genericArbitraryU<span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3; font-weight: bold;">import</span> <span style="color: #ba2f59; font-weight: bold;">Test.Hspec</span>
<span style="color: #3a81c3; font-weight: bold;">import</span> <span style="color: #ba2f59; font-weight: bold;">Test.QuickCheck</span> <span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">Gen</span><span style="color: #6c3163;">(</span><span style="color: #715ab1;">..</span><span style="color: #6c3163;">)</span>, forAll, property, choose<span style="color: #3a81c3;">)</span>

<span style="color: #3a81c3; font-weight: bold;">data</span> <span style="color: #ba2f59; font-weight: bold;">RickMorty</span>
  <span style="color: #715ab1;">=</span> <span style="color: #ba2f59; font-weight: bold;">Fleeb</span>
  <span style="color: #715ab1;">|</span> <span style="color: #ba2f59; font-weight: bold;">Squanch</span>
  <span style="color: #715ab1;">|</span> <span style="color: #ba2f59; font-weight: bold;">Plumbus</span>
  <span style="color: #3a81c3; font-weight: bold;">deriving</span> <span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">Show</span>, <span style="color: #ba2f59; font-weight: bold;">Generic</span>, <span style="color: #ba2f59; font-weight: bold;">Eq</span><span style="color: #3a81c3;">)</span>

<span style="color: #6c3163; font-weight: bold;">main</span> <span style="color: #715ab1;">::</span> <span style="color: #ba2f59; font-weight: bold;">IO</span> <span style="color: #3a81c3; font-weight: bold;">()</span>
<span style="color: #6c3163; font-weight: bold;">main</span> <span style="color: #715ab1;">=</span>
  hspec <span style="color: #715ab1;">$</span> <span style="color: #3a81c3; font-weight: bold;">do</span>
    describe <span style="color: #2d9574;">"read"</span> <span style="color: #715ab1;">$</span> <span style="color: #3a81c3; font-weight: bold;">do</span>
      it <span style="color: #2d9574;">"fooo"</span> <span style="color: #715ab1;">$</span> property <span style="color: #715ab1;">$</span> foo
      it <span style="color: #2d9574;">"baar"</span> <span style="color: #715ab1;">$</span> forAll <span style="color: #3a81c3;">(</span>genericArbitraryU <span style="color: #715ab1;">::</span> <span style="color: #ba2f59; font-weight: bold;">Gen</span> <span style="color: #ba2f59; font-weight: bold;">RickMorty</span><span style="color: #3a81c3;">)</span> bar
      it <span style="color: #2d9574;">"baaz"</span> <span style="color: #715ab1;">$</span> forAll <span style="color: #3a81c3;">(</span>choose <span style="color: #6c3163;">(</span><span style="color: #4e3163;">1</span>, <span style="color: #4e3163;">3</span><span style="color: #6c3163;">)</span> <span style="color: #715ab1;">::</span> <span style="color: #ba2f59; font-weight: bold;">Gen</span> <span style="color: #ba2f59; font-weight: bold;">Int</span><span style="color: #3a81c3;">)</span> foo

<span style="color: #6c3163; font-weight: bold;">foo</span> <span style="color: #715ab1;">::</span> <span style="color: #ba2f59; font-weight: bold;">Int</span> <span style="color: #715ab1;">-&gt;</span> <span style="color: #ba2f59; font-weight: bold;">Bool</span>
<span style="color: #6c3163; font-weight: bold;">foo</span> x <span style="color: #715ab1;">=</span> x <span style="color: #715ab1;">==</span> x

<span style="color: #6c3163; font-weight: bold;">bar</span> <span style="color: #715ab1;">::</span> <span style="color: #ba2f59; font-weight: bold;">RickMorty</span> <span style="color: #715ab1;">-&gt;</span> <span style="color: #ba2f59; font-weight: bold;">Bool</span>
<span style="color: #6c3163; font-weight: bold;">bar</span> x <span style="color: #715ab1;">=</span> x <span style="color: #715ab1;">==</span> x
</pre>
</div>

<p>
The simplest way to use QuickCheck is via the <code>property</code> function which just
takes a predicate based on some standard types. If you want to provide your own
generator you need to use the <code>forAll</code> function, but once this has happened you
are free to use a wider range of generators. In the example above we just sample
uniformly from our <code>RickMorty</code> type. This is further demonstrated by the example
with <code>choose</code> which will generate integers from \(1\) to \(3\) inclusive as test
cases.
</p>
</div>
</div>

<div id="outline-container-org4bb76b0" class="outline-3">
<h3 id="org4bb76b0">Handy IO</h3>
<div class="outline-text-3" id="text-org4bb76b0">
</div>
<div id="outline-container-orgc6155d9" class="outline-4">
<h4 id="orgc6155d9">Writing a list of values to CSV</h4>
<div class="outline-text-4" id="text-orgc6155d9">
<p>
The following assumes that the type <code>Foo</code> is an instance of <code>Csv.ToRecord</code> which
can often be derived.
</p>

<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #3a81c3; font-weight: bold;">import</span> <span style="color: #3a81c3; font-weight: bold;">qualified</span> <span style="color: #ba2f59; font-weight: bold;">Data.ByteString.Lazy</span> <span style="color: #3a81c3; font-weight: bold;">as</span> <span style="color: #ba2f59; font-weight: bold;">L</span>
<span style="color: #3a81c3; font-weight: bold;">import</span> <span style="color: #3a81c3; font-weight: bold;">qualified</span> <span style="color: #ba2f59; font-weight: bold;">Data.Csv</span> <span style="color: #3a81c3; font-weight: bold;">as</span> <span style="color: #ba2f59; font-weight: bold;">Csv</span>

L<span style="color: #6c3163; font-weight: bold;">.</span>writeFile <span style="color: #2d9574;">"output.csv"</span> <span style="color: #3a81c3;">(</span>Csv.encode <span style="color: #6c3163;">(</span>foos <span style="color: #715ab1;">::</span> <span style="color: #2d9574;">[</span><span style="color: #ba2f59; font-weight: bold;">Foo</span><span style="color: #2d9574;">]</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org0eb3e68" class="outline-3">
<h3 id="org0eb3e68">Boring haskell and <code>rio</code></h3>
<div class="outline-text-3" id="text-org0eb3e68">
<p>
The documentation for the <code>rio</code> package gives an opinionated view which features
of haskell are mature and useful enough to warant inclusion in production code.
The <code>rio</code> package itself is intended as a safe and sufficient Prelude
replacement. The authors suggest the following lists of language extensions and
compiler flags are fine to use if they are helpful.
</p>
</div>

<div id="outline-container-org429a0e2" class="outline-4">
<h4 id="org429a0e2">Language extensions</h4>
<div class="outline-text-4" id="text-org429a0e2">
<pre class="example">
AutoDeriveTypeable
BangPatterns
BinaryLiterals
ConstraintKinds
DataKinds
DefaultSignatures
DeriveDataTypeable
DeriveFoldable
DeriveFunctor
DeriveGeneric
DeriveTraversable
DoAndIfThenElse
EmptyDataDecls
ExistentialQuantification
FlexibleContexts
FlexibleInstances
FunctionalDependencies
GADTs
GeneralizedNewtypeDeriving
InstanceSigs
KindSignatures
LambdaCase
MonadFailDesugaring
MultiParamTypeClasses
MultiWayIf
NamedFieldPuns
NoImplicitPrelude
OverloadedStrings
PartialTypeSignatures
PatternGuards
PolyKinds
RankNTypes
RecordWildCards
ScopedTypeVariables
StandaloneDeriving
TupleSections
TypeFamilies
TypeSynonymInstances
ViewPatterns 
</pre>

<p>
Note that <a href="https://lexi-lambda.github.io/blog/2018/02/10/an-opinionated-guide-to-haskell-in-2018/">Alexis King</a> thinks that <code>PatternSynonyms</code> are safe to enable by
default.
</p>
</div>
</div>

<div id="outline-container-org5cde9c6" class="outline-4">
<h4 id="org5cde9c6">Compiler flags</h4>
<div class="outline-text-4" id="text-org5cde9c6">
<pre class="example">
-Wall
-Wcompat
-Widentities
-Wincomplete-record-updates
-Wincomplete-uni-patterns
-Wpartial-fields
-Wredundant-constraints
</pre>

<p>
and <code>-Werror</code> for production.
</p>
</div>
</div>
</div>

<div id="outline-container-orgacc4347" class="outline-3">
<h3 id="orgacc4347">Syntax</h3>
<div class="outline-text-3" id="text-orgacc4347">
</div>
<div id="outline-container-org84eac76" class="outline-4">
<h4 id="org84eac76">Naming conventions</h4>
<div class="outline-text-4" id="text-org84eac76">
<p>
Kowainik has an excellent summary of <a href="https://kowainik.github.io/posts/naming-conventions">naming conventions in Haskell</a>.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Pattern</th>
<th scope="col" class="org-left">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><code>go</code></td>
<td class="org-left">recursive helper function</td>
</tr>

<tr>
<td class="org-left"><code>p</code></td>
<td class="org-left">predicate function argument</td>
</tr>

<tr>
<td class="org-left"><code>xxx'</code></td>
<td class="org-left">strict version of <code>xxx</code></td>
</tr>

<tr>
<td class="org-left"><code>xxxF</code></td>
<td class="org-left">returns in a functor</td>
</tr>

<tr>
<td class="org-left"><code>xxxA</code></td>
<td class="org-left">returns in a applicative</td>
</tr>

<tr>
<td class="org-left"><code>xxxM</code></td>
<td class="org-left">returns in a monad</td>
</tr>

<tr>
<td class="org-left"><code>xxxP</code></td>
<td class="org-left">returns a parser</td>
</tr>

<tr>
<td class="org-left"><code>xxx_</code></td>
<td class="org-left">discards result</td>
</tr>

<tr>
<td class="org-left"><code>xxxL</code> or <code>xxxR</code></td>
<td class="org-left">traverse left/right</td>
</tr>

<tr>
<td class="org-left"><code>xxxBy</code> or <code>xxxOn</code></td>
<td class="org-left">works with summary value</td>
</tr>

<tr>
<td class="org-left"><code>unXxx</code>, <code>getXxx</code> and <code>runXxx</code></td>
<td class="org-left">extract data</td>
</tr>

<tr>
<td class="org-left"><i>eliminator</i> eg <code>maybe</code></td>
<td class="org-left">remove constructor</td>
</tr>

<tr>
<td class="org-left"><code>mkXxx</code></td>
<td class="org-left">apply constructor</td>
</tr>

<tr>
<td class="org-left"><code>genericXxx</code></td>
<td class="org-left">polymorphic version</td>
</tr>

<tr>
<td class="org-left"><code>isXxx</code></td>
<td class="org-left">predicate</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-org6f46a05" class="outline-4">
<h4 id="org6f46a05">Function syntax</h4>
<div class="outline-text-4" id="text-org6f46a05">
<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #da8b55;">-- |wild card</span>
<span style="color: #6c3163; font-weight: bold;">f</span> <span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">_</span><span style="color: #ba2f59; font-weight: bold;">:</span>xs<span style="color: #3a81c3;">)</span> <span style="color: #715ab1;">=</span> xs

<span style="color: #da8b55;">-- |as-pattern</span>
<span style="color: #6c3163; font-weight: bold;">f</span> l<span style="color: #715ab1;">@</span><span style="color: #3a81c3;">(</span>x<span style="color: #ba2f59; font-weight: bold;">:</span>xs<span style="color: #3a81c3;">)</span> <span style="color: #715ab1;">=</span> x<span style="color: #ba2f59; font-weight: bold;">:</span>l

<span style="color: #da8b55;">-- |guards</span>
<span style="color: #6c3163; font-weight: bold;">f</span> x
  <span style="color: #715ab1;">|</span> x <span style="color: #715ab1;">&lt;</span> <span style="color: #4e3163;">0</span>     <span style="color: #715ab1;">=</span> <span style="color: #4e3163;">0</span>
  <span style="color: #715ab1;">|</span> x <span style="color: #715ab1;">&gt;=</span> <span style="color: #4e3163;">0</span>    <span style="color: #715ab1;">=</span> <span style="color: #4e3163;">1</span>
  <span style="color: #715ab1;">|</span> otherwise <span style="color: #715ab1;">=</span> undefined

<span style="color: #da8b55;">-- |case expression</span>
<span style="color: #6c3163; font-weight: bold;">f</span> x <span style="color: #715ab1;">=</span> <span style="color: #3a81c3; font-weight: bold;">case</span> x <span style="color: #3a81c3; font-weight: bold;">of</span>
  pattern1 <span style="color: #715ab1;">-&gt;</span> expression1
  pattern2 <span style="color: #715ab1;">-&gt;</span> expression2
  <span style="color: #3a81c3; font-weight: bold;">_</span>        <span style="color: #715ab1;">-&gt;</span> undefined

<span style="color: #da8b55;">-- |where clause</span>
<span style="color: #6c3163; font-weight: bold;">f</span> x <span style="color: #715ab1;">=</span> g z
  <span style="color: #3a81c3; font-weight: bold;">where</span>
    z <span style="color: #715ab1;">=</span> epxression

<span style="color: #da8b55;">-- |let expression</span>
<span style="color: #6c3163; font-weight: bold;">f</span> x <span style="color: #715ab1;">=</span> <span style="color: #3a81c3; font-weight: bold;">let</span> z <span style="color: #715ab1;">=</span> expression
      <span style="color: #3a81c3; font-weight: bold;">in</span> g z
</pre>
</div>

<p>
If you have the <code>MultiWayIf</code> extension you can use guard style syntax in a
conditional as demonstrated in the following example from the <a href="https://www.schoolofhaskell.com/school/to-infinity-and-beyond/pick-of-the-week/guide-to-ghc-extensions/basic-syntax-extensions#multiwayif">School of Haskell</a>:
</p>

<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #6c3163;">{-# LANGUAGE MultiWayIf #-}</span>

<span style="color: #6c3163; font-weight: bold;">fn</span> <span style="color: #715ab1;">::</span> <span style="color: #ba2f59; font-weight: bold;">Int</span> <span style="color: #715ab1;">-&gt;</span> <span style="color: #ba2f59; font-weight: bold;">Int</span> <span style="color: #715ab1;">-&gt;</span> <span style="color: #ba2f59; font-weight: bold;">String</span>
<span style="color: #6c3163; font-weight: bold;">fn</span> x y <span style="color: #715ab1;">=</span> <span style="color: #3a81c3; font-weight: bold;">if</span> <span style="color: #715ab1;">|</span> x <span style="color: #715ab1;">==</span> <span style="color: #4e3163;">1</span>    <span style="color: #715ab1;">-&gt;</span> <span style="color: #2d9574;">"a"</span>
            <span style="color: #715ab1;">|</span> y <span style="color: #715ab1;">&lt;</span>  <span style="color: #4e3163;">2</span>    <span style="color: #715ab1;">-&gt;</span> <span style="color: #2d9574;">"b"</span>
            <span style="color: #715ab1;">|</span> otherwise <span style="color: #715ab1;">-&gt;</span> <span style="color: #2d9574;">"c"</span>

<span style="color: #da8b55;">-- | should print:</span>
<span style="color: #da8b55;">--   @c@</span>
<span style="color: #6c3163; font-weight: bold;">main</span> <span style="color: #715ab1;">=</span> putStrLn <span style="color: #715ab1;">$</span> fn <span style="color: #4e3163;">3</span> <span style="color: #4e3163;">4</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc24d955" class="outline-4">
<h4 id="orgc24d955">Records syntax</h4>
<div class="outline-text-4" id="text-orgc24d955">
<p>
There is "Record Update Syntax" to construct a new record with some of the
fields taking different values.
</p>

<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #3a81c3; font-weight: bold;">data</span> <span style="color: #ba2f59; font-weight: bold;">Foo</span> <span style="color: #715ab1;">=</span> <span style="color: #ba2f59; font-weight: bold;">Foo</span> <span style="color: #3a81c3;">{</span>a <span style="color: #715ab1;">::</span> <span style="color: #ba2f59; font-weight: bold;">Int</span>, b <span style="color: #715ab1;">::</span> <span style="color: #ba2f59; font-weight: bold;">Char</span><span style="color: #3a81c3;">}</span> <span style="color: #3a81c3; font-weight: bold;">deriving</span> <span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">Show</span><span style="color: #3a81c3;">)</span>

<span style="color: #6c3163; font-weight: bold;">foo1</span> <span style="color: #715ab1;">=</span> <span style="color: #ba2f59; font-weight: bold;">Foo</span> <span style="color: #4e3163;">1</span> <span style="color: #2d9574;">'a'</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">-- </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Foo {a = 1, b = 'a'}</span>
<span style="color: #6c3163; font-weight: bold;">foo2</span> <span style="color: #715ab1;">=</span> foo1 <span style="color: #3a81c3;">{</span>b <span style="color: #715ab1;">=</span> <span style="color: #2d9574;">'b'</span><span style="color: #3a81c3;">}</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">-- </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Foo {a = 1, b = 'b'}</span>
</pre>
</div>

<p>
The <code>RecordWildcards</code> extension provides some additional sugar for pattern
working with records. It makes the fields available in the local scope under the
name of their accessors. The same is true for record construction. For example
</p>

<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #6c3163;">{-# LANGUAGE RecordWildCards #-}</span>

<span style="color: #3a81c3; font-weight: bold;">data</span> <span style="color: #ba2f59; font-weight: bold;">Person</span> <span style="color: #715ab1;">=</span> <span style="color: #ba2f59; font-weight: bold;">Person</span> <span style="color: #3a81c3;">{</span> name <span style="color: #715ab1;">::</span> <span style="color: #ba2f59; font-weight: bold;">String</span> , admin <span style="color: #715ab1;">::</span> <span style="color: #ba2f59; font-weight: bold;">Bool</span> <span style="color: #3a81c3;">}</span>

<span style="color: #6c3163; font-weight: bold;">example</span> <span style="color: #715ab1;">::</span> <span style="color: #ba2f59; font-weight: bold;">Person</span>
<span style="color: #6c3163; font-weight: bold;">example</span> <span style="color: #715ab1;">=</span> <span style="color: #ba2f59; font-weight: bold;">Person</span><span style="color: #3a81c3;">{</span><span style="color: #715ab1;">..</span><span style="color: #3a81c3;">}</span>
  <span style="color: #3a81c3; font-weight: bold;">where</span>
    name <span style="color: #715ab1;">=</span> <span style="color: #2d9574;">"John Doe"</span>
    admin <span style="color: #715ab1;">=</span> <span style="color: #ba2f59; font-weight: bold;">True</span>
</pre>
</div>

<p>
The <code>NamedFieldPuns</code> extensions attempts to make it easier to construct and
reference values in a record. With this extension enabled, this
</p>

<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #3a81c3; font-weight: bold;">data</span> <span style="color: #ba2f59; font-weight: bold;">C</span> <span style="color: #715ab1;">=</span> <span style="color: #ba2f59; font-weight: bold;">C</span> <span style="color: #3a81c3;">{</span>a <span style="color: #715ab1;">::</span> <span style="color: #ba2f59; font-weight: bold;">Int</span><span style="color: #3a81c3;">}</span>
<span style="color: #6c3163; font-weight: bold;">f</span> <span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">C</span> <span style="color: #6c3163;">{</span>a <span style="color: #715ab1;">=</span> a<span style="color: #6c3163;">}</span><span style="color: #3a81c3;">)</span> <span style="color: #715ab1;">=</span> a
</pre>
</div>

<p>
can be written as this
</p>

<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #6c3163; font-weight: bold;">f</span> <span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">C</span> <span style="color: #6c3163;">{</span>a<span style="color: #6c3163;">}</span><span style="color: #3a81c3;">)</span> <span style="color: #715ab1;">=</span> a 
</pre>
</div>

<p>
It is possible to mix the effects of <code>RecordWildCards</code> and <code>NamedFieldPuns</code>, eg
<code>C {a = 1, b, ..}</code>.
</p>
</div>
</div>

<div id="outline-container-org653e0fc" class="outline-4">
<h4 id="org653e0fc">Types syntax</h4>
<div class="outline-text-4" id="text-org653e0fc">
<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #3a81c3; font-weight: bold;">data</span> <span style="color: #ba2f59; font-weight: bold;">Person</span> <span style="color: #715ab1;">=</span> <span style="color: #ba2f59; font-weight: bold;">Person</span> <span style="color: #3a81c3;">{</span> personFirstName <span style="color: #715ab1;">::</span> <span style="color: #ba2f59; font-weight: bold;">String</span>  
                     , personLastName <span style="color: #715ab1;">::</span> <span style="color: #ba2f59; font-weight: bold;">String</span>  
                     , personAge <span style="color: #715ab1;">::</span> <span style="color: #ba2f59; font-weight: bold;">Int</span>  
                     <span style="color: #3a81c3;">}</span> <span style="color: #3a81c3; font-weight: bold;">deriving</span> <span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">Show</span>, <span style="color: #ba2f59; font-weight: bold;">Eq</span><span style="color: #3a81c3;">)</span>
</pre>
</div>

<p>
It is considered decent to prefix the attributes with something that is unique
to the record type to avoid name clashes.
</p>

<p>
If you have a wrapper type and want to access the data within but do not want to
continually pattern match to get the value out you can use the <code>coerce</code> function
from <code>Data.Coerce</code> (which is part of base). This functionality is encoded in the
<code>Coercible</code> typeclass.
</p>
</div>
</div>

<div id="outline-container-org5594360" class="outline-4">
<h4 id="org5594360">List comprehensions</h4>
<div class="outline-text-4" id="text-org5594360">
<p>
List comprehensions are a nice way to combine a map and a filter.
</p>

<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #3a81c3;">[</span>sqrt x <span style="color: #715ab1;">|</span> x <span style="color: #715ab1;">&lt;-</span> <span style="color: #6c3163;">[</span><span style="color: #4e3163;">1</span><span style="color: #715ab1;">..</span><span style="color: #4e3163;">9</span><span style="color: #6c3163;">]</span>, x <span style="color: #715ab1;">&gt;</span> <span style="color: #4e3163;">3</span><span style="color: #3a81c3;">]</span>
</pre>
</div>

<p>
You can use pattern matching to filter in a list comprehension as the following
example demonstrates
</p>

<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #3a81c3; font-weight: bold;">data</span> <span style="color: #ba2f59; font-weight: bold;">Foobar</span> <span style="color: #715ab1;">=</span> <span style="color: #ba2f59; font-weight: bold;">Foo</span> <span style="color: #ba2f59; font-weight: bold;">Int</span> <span style="color: #715ab1;">|</span> <span style="color: #ba2f59; font-weight: bold;">Bar</span> <span style="color: #ba2f59; font-weight: bold;">Char</span> <span style="color: #3a81c3; font-weight: bold;">deriving</span> <span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">Show</span><span style="color: #3a81c3;">)</span>
<span style="color: #6c3163; font-weight: bold;">x</span> <span style="color: #715ab1;">=</span> <span style="color: #3a81c3;">[</span><span style="color: #ba2f59; font-weight: bold;">Foo</span> <span style="color: #4e3163;">1</span>, <span style="color: #ba2f59; font-weight: bold;">Bar</span> <span style="color: #2d9574;">'a'</span>, <span style="color: #ba2f59; font-weight: bold;">Foo</span> <span style="color: #4e3163;">2</span>, <span style="color: #ba2f59; font-weight: bold;">Bar</span> <span style="color: #2d9574;">'b'</span><span style="color: #3a81c3;">]</span>
<span style="color: #6c3163; font-weight: bold;">y</span> <span style="color: #715ab1;">=</span> <span style="color: #3a81c3;">[</span>n <span style="color: #715ab1;">|</span> <span style="color: #6c3163;">(</span><span style="color: #ba2f59; font-weight: bold;">Foo</span> n<span style="color: #6c3163;">)</span> <span style="color: #715ab1;">&lt;-</span> x<span style="color: #3a81c3;">]</span>
</pre>
</div>

<p>
The variable <code>y</code> has the value <code>[1,2]</code>.
</p>
</div>
</div>

<div id="outline-container-orgf041bb1" class="outline-4">
<h4 id="orgf041bb1">Variable names</h4>
<div class="outline-text-4" id="text-orgf041bb1">
<p>
<a href="https://www.haskell.org/onlinereport/"><i>The Haskell 98 Report</i></a> says 
</p>

<blockquote>
<p>
Underscore, "_", is treated as a lower-case letter, and can occur
wherever a lower-case letter can. However, "_" all by itself is a
reserved identifier, used as wild card in patterns. Compilers that offer
warnings for unused identifiers are encouraged to suppress such warnings for
identifiers beginning with underscore. This allows programmers to use
"_foo" for a parameter that they expect to be unused.
</p>
</blockquote>
</div>
</div>

<div id="outline-container-orge437f9b" class="outline-4">
<h4 id="orge437f9b">Module names</h4>
<div class="outline-text-4" id="text-orge437f9b">
<p>
<a href="https://www.haskell.org/onlinereport/"><i>The Haskell 98 Report</i></a> says
</p>

<blockquote>
<p>
Module names are alphanumeric and must begin with an uppercase letter.
</p>
</blockquote>
</div>
</div>

<div id="outline-container-org4bb4f31" class="outline-4">
<h4 id="org4bb4f31">Typeclasses</h4>
<div class="outline-text-4" id="text-org4bb4f31">
<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #3a81c3; font-weight: bold;">class</span> <span style="color: #ba2f59; font-weight: bold;">Eq</span> a <span style="color: #3a81c3; font-weight: bold;">where</span>  
    <span style="color: #3a81c3;">(</span><span style="color: #715ab1;">==</span><span style="color: #3a81c3;">)</span> <span style="color: #715ab1;">::</span> a <span style="color: #715ab1;">-&gt;</span> a <span style="color: #715ab1;">-&gt;</span> <span style="color: #ba2f59; font-weight: bold;">Bool</span>  
    <span style="color: #3a81c3;">(</span><span style="color: #715ab1;">/=</span><span style="color: #3a81c3;">)</span> <span style="color: #715ab1;">::</span> a <span style="color: #715ab1;">-&gt;</span> a <span style="color: #715ab1;">-&gt;</span> <span style="color: #ba2f59; font-weight: bold;">Bool</span>  
    x <span style="color: #715ab1;">==</span> y <span style="color: #715ab1;">=</span> not <span style="color: #3a81c3;">(</span>x <span style="color: #715ab1;">/=</span> y<span style="color: #3a81c3;">)</span>  
    x <span style="color: #715ab1;">/=</span> y <span style="color: #715ab1;">=</span> not <span style="color: #3a81c3;">(</span>x <span style="color: #715ab1;">==</span> y<span style="color: #3a81c3;">)</span>  

<span style="color: #3a81c3; font-weight: bold;">data</span> <span style="color: #ba2f59; font-weight: bold;">Foobar</span> <span style="color: #715ab1;">=</span> <span style="color: #ba2f59; font-weight: bold;">Foo</span> <span style="color: #715ab1;">|</span> <span style="color: #ba2f59; font-weight: bold;">Bar</span>

<span style="color: #3a81c3; font-weight: bold;">instance</span> <span style="color: #ba2f59; font-weight: bold;">Eq</span> <span style="color: #ba2f59; font-weight: bold;">Foobar</span> <span style="color: #3a81c3; font-weight: bold;">where</span>
    <span style="color: #ba2f59; font-weight: bold;">Foo</span> <span style="color: #715ab1;">==</span> <span style="color: #ba2f59; font-weight: bold;">Foo</span> <span style="color: #715ab1;">=</span> <span style="color: #ba2f59; font-weight: bold;">True</span>
    <span style="color: #ba2f59; font-weight: bold;">Bar</span> <span style="color: #715ab1;">==</span> <span style="color: #ba2f59; font-weight: bold;">Bar</span> <span style="color: #715ab1;">=</span> <span style="color: #ba2f59; font-weight: bold;">True</span>
    <span style="color: #3a81c3; font-weight: bold;">_</span> <span style="color: #715ab1;">==</span> <span style="color: #3a81c3; font-weight: bold;">_</span> <span style="color: #715ab1;">=</span> <span style="color: #ba2f59; font-weight: bold;">False</span>
</pre>
</div>

<p>
There are cases where a class will have multiple type parameters, e.g. <code>a</code>, <code>b</code>,
and <code>c</code>, but one of them may be determined by the others, <code>c</code> is determined by
<code>a</code> and <code>b</code>. One way to resolve this is by adding type annotations, but this is
unpleasant. <i>Functional dependencies</i> are a way to tell the compiler that <code>c</code> is
determined by <code>a</code> and <code>b</code>. The following snippet gives an example of the syntax
(a vertical bar, <code>|</code>) used to acheive this
</p>

<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #3a81c3; font-weight: bold;">class</span> <span style="color: #ba2f59; font-weight: bold;">Foo</span> a b c <span style="color: #715ab1;">|</span> a b <span style="color: #715ab1;">-&gt;</span> c <span style="color: #3a81c3; font-weight: bold;">where</span> <span style="color: #715ab1;">...</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org4fe9101" class="outline-4">
<h4 id="org4fe9101"><code>let</code> and <code>where</code></h4>
<div class="outline-text-4" id="text-org4fe9101">
<p>
As stated on the <a href="https://wiki.haskell.org/Let_vs._Where">Haskell wiki page "Let vs. Where"</a>
</p>

<blockquote>
<p>
It is important to know that <code>let ... in ...</code> is an expression, that is, it can
be written wherever expressions are allowed. In contrast, <code>where</code> is bound to a
surrounding syntactic construct, like the pattern matching line of a function
definition.
</p>
</blockquote>
</div>
</div>
</div>

<div id="outline-container-org4ef6cfc" class="outline-3">
<h3 id="org4ef6cfc">Monad transformers with <code>mtl</code></h3>
<div class="outline-text-3" id="text-org4ef6cfc">
</div>
<div id="outline-container-org1056f3c" class="outline-4">
<h4 id="org1056f3c"><code>ReaderT</code></h4>
<div class="outline-text-4" id="text-org1056f3c">
<p>
To avoid explicitly passing environment data around, one can use the <code>ReaderT</code>
monad transformer to add read-only environment. The following example shows the
reader monad transformer in action. 
</p>

<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #3a81c3; font-weight: bold;">import</span> <span style="color: #ba2f59; font-weight: bold;">Control.Monad.Reader</span> <span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">ReaderT</span>, ask, liftIO, runReaderT<span style="color: #3a81c3;">)</span>

<span style="color: #3a81c3; font-weight: bold;">data</span> <span style="color: #ba2f59; font-weight: bold;">Env</span> <span style="color: #715ab1;">=</span> <span style="color: #ba2f59; font-weight: bold;">Env</span> <span style="color: #3a81c3;">{</span> envInput <span style="color: #715ab1;">::</span> <span style="color: #ba2f59; font-weight: bold;">FilePath</span> <span style="color: #3a81c3;">}</span>

<span style="color: #6c3163; font-weight: bold;">step1</span> <span style="color: #715ab1;">::</span> <span style="color: #ba2f59; font-weight: bold;">ReaderT</span> <span style="color: #ba2f59; font-weight: bold;">Env</span> <span style="color: #ba2f59; font-weight: bold;">IO</span> <span style="color: #ba2f59; font-weight: bold;">Int</span>
<span style="color: #6c3163; font-weight: bold;">step1</span> <span style="color: #715ab1;">=</span> <span style="color: #3a81c3; font-weight: bold;">do</span>
  liftIO <span style="color: #715ab1;">$</span> putStrLn <span style="color: #2d9574;">"Greetings from Step 1."</span>
  return <span style="color: #4e3163;">0</span>

<span style="color: #6c3163; font-weight: bold;">step2</span> <span style="color: #715ab1;">::</span> <span style="color: #ba2f59; font-weight: bold;">Int</span> <span style="color: #715ab1;">-&gt;</span> <span style="color: #ba2f59; font-weight: bold;">ReaderT</span> <span style="color: #ba2f59; font-weight: bold;">Env</span> <span style="color: #ba2f59; font-weight: bold;">IO</span> <span style="color: #3a81c3; font-weight: bold;">()</span>
<span style="color: #6c3163; font-weight: bold;">step2</span> n <span style="color: #715ab1;">=</span> <span style="color: #3a81c3; font-weight: bold;">do</span>
  liftIO <span style="color: #715ab1;">$</span> putStrLn <span style="color: #3a81c3;">(</span>show n<span style="color: #3a81c3;">)</span>
  fp <span style="color: #715ab1;">&lt;-</span> envInput <span style="color: #715ab1;">&lt;$&gt;</span> ask
  line <span style="color: #715ab1;">&lt;-</span> liftIO <span style="color: #715ab1;">$</span> readFile fp
  liftIO <span style="color: #715ab1;">$</span> putStr <span style="color: #3a81c3;">(</span><span style="color: #2d9574;">"Autobots, "</span> <span style="color: #715ab1;">++</span> line<span style="color: #3a81c3;">)</span>

<span style="color: #6c3163; font-weight: bold;">main</span> <span style="color: #715ab1;">::</span> <span style="color: #ba2f59; font-weight: bold;">IO</span> <span style="color: #3a81c3; font-weight: bold;">()</span>
<span style="color: #6c3163; font-weight: bold;">main</span> <span style="color: #715ab1;">=</span> <span style="color: #3a81c3; font-weight: bold;">do</span>
  runReaderT <span style="color: #3a81c3;">(</span>step1 <span style="color: #715ab1;">&gt;&gt;=</span> step2<span style="color: #3a81c3;">)</span> <span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">Env</span> <span style="color: #2d9574;">"autobots.txt"</span><span style="color: #3a81c3;">)</span>
</pre>
</div>

<p>
The <code>main</code> function sets up an environment which is passes to Step 1 which puts
a value of 0 in the monad. Then in the second function the value is printed and
the contents of the file referenced in the environment is printed out, i.e., the
file <code>autobots.txt</code> which just contains a single line with "roll out". Running
this in the REPL gives the following output.
</p>

<pre class="example">
λ&gt; main
Greetings from Step 1.
0
Autobots, roll out
</pre>
</div>
</div>

<div id="outline-container-orge1aa55b" class="outline-4">
<h4 id="orge1aa55b"><code>ReaderT</code> on <code>ExceptT</code></h4>
<div class="outline-text-4" id="text-orge1aa55b">
<p>
The example above using the reader monad transformer can be extended to improve
the error handling in the case where the file path in the environment does not
exist.
</p>

<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #3a81c3; font-weight: bold;">import</span> <span style="color: #ba2f59; font-weight: bold;">Control.Monad.Except</span> <span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">ExceptT</span>, runExceptT, throwError<span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3; font-weight: bold;">import</span> <span style="color: #ba2f59; font-weight: bold;">Control.Monad.Reader</span> <span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">ReaderT</span>, asks, liftIO, runReaderT<span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3; font-weight: bold;">import</span> <span style="color: #ba2f59; font-weight: bold;">System.Directory</span> <span style="color: #3a81c3;">(</span>doesFileExist<span style="color: #3a81c3;">)</span>

<span style="color: #3a81c3; font-weight: bold;">newtype</span> <span style="color: #ba2f59; font-weight: bold;">Env</span> <span style="color: #715ab1;">=</span> <span style="color: #ba2f59; font-weight: bold;">Env</span> <span style="color: #3a81c3;">{</span> envInput <span style="color: #715ab1;">::</span> <span style="color: #ba2f59; font-weight: bold;">FilePath</span> <span style="color: #3a81c3;">}</span>

<span style="color: #3a81c3; font-weight: bold;">type</span> <span style="color: #ba2f59; font-weight: bold;">Robot</span> a <span style="color: #715ab1;">=</span> <span style="color: #ba2f59; font-weight: bold;">ReaderT</span> <span style="color: #ba2f59; font-weight: bold;">Env</span> <span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">ExceptT</span> <span style="color: #ba2f59; font-weight: bold;">String</span> <span style="color: #ba2f59; font-weight: bold;">IO</span><span style="color: #3a81c3;">)</span> a

<span style="color: #6c3163; font-weight: bold;">runRobot</span> <span style="color: #715ab1;">::</span> <span style="color: #ba2f59; font-weight: bold;">Robot</span> a <span style="color: #715ab1;">-&gt;</span> <span style="color: #ba2f59; font-weight: bold;">Env</span> <span style="color: #715ab1;">-&gt;</span> <span style="color: #ba2f59; font-weight: bold;">IO</span> <span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">Either</span> <span style="color: #ba2f59; font-weight: bold;">String</span> a<span style="color: #3a81c3;">)</span>
<span style="color: #6c3163; font-weight: bold;">runRobot</span> robot env <span style="color: #715ab1;">=</span> runExceptT <span style="color: #3a81c3;">(</span>runReaderT robot env<span style="color: #3a81c3;">)</span>

<span style="color: #6c3163; font-weight: bold;">step1</span> <span style="color: #715ab1;">::</span> <span style="color: #ba2f59; font-weight: bold;">Robot</span> <span style="color: #ba2f59; font-weight: bold;">Int</span>
<span style="color: #6c3163; font-weight: bold;">step1</span> <span style="color: #715ab1;">=</span> <span style="color: #3a81c3; font-weight: bold;">do</span>
  liftIO <span style="color: #715ab1;">$</span> putStrLn <span style="color: #2d9574;">"Greetings from Step 1."</span>
  return <span style="color: #4e3163;">0</span>

<span style="color: #6c3163; font-weight: bold;">step2</span> <span style="color: #715ab1;">::</span> <span style="color: #ba2f59; font-weight: bold;">Int</span> <span style="color: #715ab1;">-&gt;</span> <span style="color: #ba2f59; font-weight: bold;">Robot</span> <span style="color: #3a81c3; font-weight: bold;">()</span>
<span style="color: #6c3163; font-weight: bold;">step2</span> n <span style="color: #715ab1;">=</span> <span style="color: #3a81c3; font-weight: bold;">do</span>
  liftIO <span style="color: #715ab1;">$</span> print n
  fp <span style="color: #715ab1;">&lt;-</span> asks envInput
  exists <span style="color: #715ab1;">&lt;-</span> liftIO <span style="color: #715ab1;">$</span> doesFileExist fp
  <span style="color: #3a81c3; font-weight: bold;">if</span> exists
  <span style="color: #3a81c3; font-weight: bold;">then</span> <span style="color: #3a81c3; font-weight: bold;">do</span> line <span style="color: #715ab1;">&lt;-</span> liftIO <span style="color: #715ab1;">$</span> readFile fp
          liftIO <span style="color: #715ab1;">$</span> putStr <span style="color: #3a81c3;">(</span><span style="color: #2d9574;">"Autobots, "</span> <span style="color: #715ab1;">++</span> line<span style="color: #3a81c3;">)</span>
  <span style="color: #3a81c3; font-weight: bold;">else</span> throwError <span style="color: #2d9574;">"Could not find file in step 2"</span>
</pre>
</div>

<p>
The <code>main</code> function has been remove but there is not much added code here.
Running the <code>runRobot</code> function in the REPL we get the following results which
demonstrate how the failure path evaluates.
</p>

<pre class="example">
λ&gt; runRobot (step1 &gt;&gt;= step2) (Env "autobots.txt")
Greetings from Step 1.
0
Autobots, roll out
Right ()
λ&gt; runRobot (step1 &gt;&gt;= step2) (Env "autobats.txt")
Greetings from Step 1.
0
Left "Could not find file in step 2"
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcbc161f" class="outline-3">
<h3 id="orgcbc161f">Data structures and types</h3>
<div class="outline-text-3" id="text-orgcbc161f">
</div>
<div id="outline-container-org92f8601" class="outline-4">
<h4 id="org92f8601"><code>Int</code> and <code>Word</code></h4>
<div class="outline-text-4" id="text-org92f8601">
<p>
The package <code>Data.Int</code> provides signed integers and <code>Data.Word</code> provides
unsigned integers. The latter may be useful to encode that the number has to be
positive at the type level.
</p>
</div>
</div>

<div id="outline-container-org8aedf25" class="outline-4">
<h4 id="org8aedf25">Strings</h4>
<div class="outline-text-4" id="text-org8aedf25">
<p>
Strings are just lists of characters which can lead to poor preformance, which
is why people warn that <code>String</code> should be avoided if you are doing anything
serious with text. Still, for the cases where performance isn't going to be a
problem strings are simple to work with. The <code>printf</code> function in <code>base</code>
provides string interpolation.
</p>

<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #3a81c3; font-weight: bold;">import</span> <span style="color: #ba2f59; font-weight: bold;">Text.Printf</span> <span style="color: #3a81c3;">(</span>printf<span style="color: #3a81c3;">)</span>

<span style="color: #6c3163; font-weight: bold;">a</span> <span style="color: #715ab1;">=</span> printf <span style="color: #2d9574;">"foo %d"</span> <span style="color: #4e3163;">1</span> <span style="color: #715ab1;">::</span> <span style="color: #ba2f59; font-weight: bold;">IO</span> <span style="color: #3a81c3; font-weight: bold;">()</span>
<span style="color: #6c3163; font-weight: bold;">b</span> <span style="color: #715ab1;">=</span> printf <span style="color: #2d9574;">"bar %d"</span> <span style="color: #4e3163;">2</span> <span style="color: #715ab1;">::</span> <span style="color: #ba2f59; font-weight: bold;">String</span>
</pre>
</div>

<p>
The variable <code>a</code> stores and action which prints "foo 1" and <code>b</code> is a string:
"bar 2".
</p>
</div>
</div>

<div id="outline-container-org29073c0" class="outline-4">
<h4 id="org29073c0">Semigroup</h4>
<div class="outline-text-4" id="text-org29073c0">
<p>
A <i>semigroup</i> is a set with an associative binary operation. In <code>base</code> this type
class, <code>Data.Semigroup</code>, requires a function <code>&lt;&gt;</code>, and instances of this function must be
associative.
</p>
</div>
</div>
<div id="outline-container-org9964805" class="outline-4">
<h4 id="org9964805">Monoid</h4>
<div class="outline-text-4" id="text-org9964805">
<p>
A <i>monoid</i> is a semigroup which has an identity element. In <code>base</code> this type
class, <code>Data.Monoid</code>, requires the function <code>&lt;&gt;</code>, as in semigroup, and <code>mempty</code>
for the identity element. The <code>mempty</code> must be both a left and right identity.
</p>
<ul class="org-ul">
<li><code>Data.List.NonEmpty</code> (in <code>base</code>) for non-empty lists to avoid run time errors
due to bad calls to <code>head</code> or <code>tail</code>.</li>
<li><code>containers</code> has several efficient data structures that can be used as an
alternative to lists.
<ul class="org-ul">
<li><code>Data.Map</code> for look-up tables</li>
<li><code>Data.Sequence</code> if you finite lists you can access from both ends</li>
<li><code>Data.Set</code> for sets of elements in <code>Eq</code> and <code>Ord</code></li>
</ul></li>
<li><code>vector</code> has vectors.</li>
</ul>
</div>
</div>
<div id="outline-container-orgf9791d0" class="outline-4">
<h4 id="orgf9791d0">Foldable</h4>
<div class="outline-text-4" id="text-orgf9791d0">
<p>
A data structure that reduced to a single summary value: <code>foldr :: (a -&gt; b -&gt; b)
-&gt; b -&gt; t a -&gt; b</code>. For example, you might add up all the values on a tree where
each node has a value. When the data form a monoid <code>foldMap</code> can be implemented
instead which just uses the monoid's addition.
</p>
</div>
</div>
<div id="outline-container-org3ebae5e" class="outline-4">
<h4 id="org3ebae5e">Traversable</h4>
<div class="outline-text-4" id="text-org3ebae5e">
<p>
Like a more powerful functor: <code>traverse :: Applicative f =&gt; (a -&gt; f b) -&gt; t a -&gt;
f (t b)</code>
</p>
</div>
</div>
</div>

<div id="outline-container-orga529127" class="outline-3">
<h3 id="orga529127"><code>ST</code> monad</h3>
<div class="outline-text-3" id="text-orga529127">
</div>
<div id="outline-container-org69acf89" class="outline-4">
<h4 id="org69acf89">Example</h4>
<div class="outline-text-4" id="text-org69acf89">
<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #3a81c3; font-weight: bold;">import</span> <span style="color: #ba2f59; font-weight: bold;">Control.Monad</span> <span style="color: #3a81c3;">(</span>replicateM_,liftM<span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3; font-weight: bold;">import</span> <span style="color: #ba2f59; font-weight: bold;">Control.Monad.ST</span> <span style="color: #3a81c3;">(</span>runST<span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3; font-weight: bold;">import</span> <span style="color: #ba2f59; font-weight: bold;">Data.STRef</span>

<span style="color: #6c3163; font-weight: bold;">foo</span> <span style="color: #715ab1;">::</span> <span style="color: #ba2f59; font-weight: bold;">String</span>
<span style="color: #6c3163; font-weight: bold;">foo</span> <span style="color: #715ab1;">=</span> runST <span style="color: #715ab1;">$</span> <span style="color: #3a81c3; font-weight: bold;">do</span>
  ref <span style="color: #715ab1;">&lt;-</span> newSTRef <span style="color: #2d9574;">"hello "</span>
  x <span style="color: #715ab1;">&lt;-</span> readSTRef ref
  writeSTRef ref <span style="color: #3a81c3;">(</span>x <span style="color: #715ab1;">++</span> <span style="color: #2d9574;">"world"</span><span style="color: #3a81c3;">)</span>
  readSTRef ref
</pre>
</div>
</div>
</div>

<div id="outline-container-orgffac7cf" class="outline-4">
<h4 id="orgffac7cf">Another example</h4>
<div class="outline-text-4" id="text-orgffac7cf">
<p>
Next time you have tricky fold, the following might be useful. Note that we use
the <code>modifySTRef'</code> with the apostrophe, which is the strick version of the
function to avoid the build up of thunks which might otherwise be a problem.
</p>

<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #3a81c3; font-weight: bold;">import</span> <span style="color: #ba2f59; font-weight: bold;">Control.Monad</span> <span style="color: #3a81c3;">(</span>replicateM_,liftM<span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3; font-weight: bold;">import</span> <span style="color: #ba2f59; font-weight: bold;">Control.Monad.ST</span> <span style="color: #3a81c3;">(</span>runST<span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3; font-weight: bold;">import</span> <span style="color: #ba2f59; font-weight: bold;">Data.STRef</span>

<span style="color: #6c3163; font-weight: bold;">fib</span> <span style="color: #715ab1;">::</span> <span style="color: #ba2f59; font-weight: bold;">Int</span> <span style="color: #715ab1;">-&gt;</span> <span style="color: #ba2f59; font-weight: bold;">Int</span>
<span style="color: #6c3163; font-weight: bold;">fib</span> n <span style="color: #715ab1;">=</span> runST <span style="color: #715ab1;">$</span> <span style="color: #3a81c3; font-weight: bold;">do</span>
  ref <span style="color: #715ab1;">&lt;-</span> newSTRef <span style="color: #3a81c3;">(</span><span style="color: #4e3163;">0</span>,<span style="color: #4e3163;">1</span><span style="color: #3a81c3;">)</span>
  replicateM_ n <span style="color: #715ab1;">$</span> modifySTRef' ref <span style="color: #3a81c3;">(</span><span style="color: #715ab1;">\</span><span style="color: #6c3163;">(</span>a,b<span style="color: #6c3163;">)</span> <span style="color: #715ab1;">-&gt;</span> <span style="color: #6c3163;">(</span>b,a<span style="color: #715ab1;">+</span>b<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
  liftM snd <span style="color: #715ab1;">$</span> readSTRef ref
</pre>
</div>

<p>
Moreover, this appears to be faster than the following non-tail recursive
implementation
</p>

<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #6c3163; font-weight: bold;">fib2</span> <span style="color: #715ab1;">::</span> <span style="color: #ba2f59; font-weight: bold;">Int</span> <span style="color: #715ab1;">-&gt;</span> <span style="color: #ba2f59; font-weight: bold;">Int</span>
<span style="color: #6c3163; font-weight: bold;">fib2</span> n
  <span style="color: #715ab1;">|</span> n <span style="color: #715ab1;">&lt;</span> <span style="color: #4e3163;">2</span> <span style="color: #715ab1;">=</span> <span style="color: #4e3163;">1</span>
  <span style="color: #715ab1;">|</span> otherwise <span style="color: #715ab1;">=</span> fib <span style="color: #3a81c3;">(</span>n<span style="color: #715ab1;">-</span><span style="color: #4e3163;">1</span><span style="color: #3a81c3;">)</span> <span style="color: #715ab1;">+</span> fib <span style="color: #3a81c3;">(</span>n<span style="color: #715ab1;">-</span><span style="color: #4e3163;">2</span><span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org0eb5315" class="outline-4">
<h4 id="org0eb5315">Another example again</h4>
<div class="outline-text-4" id="text-org0eb5315">
<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #3a81c3; font-weight: bold;">import</span> <span style="color: #ba2f59; font-weight: bold;">Control.Monad.ST</span>
<span style="color: #3a81c3; font-weight: bold;">import</span> <span style="color: #ba2f59; font-weight: bold;">Data.STRef</span>
<span style="color: #3a81c3; font-weight: bold;">import</span> <span style="color: #ba2f59; font-weight: bold;">Data.Foldable</span>

<span style="color: #6c3163; font-weight: bold;">sumST</span> <span style="color: #715ab1;">::</span> <span style="color: #ba2f59; font-weight: bold;">Num</span> a <span style="color: #715ab1;">=&gt;</span> <span style="color: #3a81c3;">[</span>a<span style="color: #3a81c3;">]</span> <span style="color: #715ab1;">-&gt;</span> a
<span style="color: #6c3163; font-weight: bold;">sumST</span> xs <span style="color: #715ab1;">=</span> runST <span style="color: #715ab1;">$</span> <span style="color: #3a81c3; font-weight: bold;">do</span>
    n <span style="color: #715ab1;">&lt;-</span> newSTRef <span style="color: #4e3163;">0</span>
    for_ xs <span style="color: #715ab1;">$</span> <span style="color: #715ab1;">\</span>x <span style="color: #715ab1;">-&gt;</span>
        modifySTRef n <span style="color: #3a81c3;">(</span><span style="color: #715ab1;">+</span>x<span style="color: #3a81c3;">)</span>
    readSTRef n
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgd5a4edc" class="outline-3">
<h3 id="orgd5a4edc"><code>Either</code> monad</h3>
<div class="outline-text-3" id="text-orgd5a4edc">
</div>
<div id="outline-container-org614a667" class="outline-4">
<h4 id="org614a667">Definition</h4>
<div class="outline-text-4" id="text-org614a667">
<p>
The source for the either monad in Haskell is <a href="https://hackage.haskell.org/package/base-4.15.0.0/docs/src/Data-Either.html#Either">here</a>. Importantly, the instance of
monad is
</p>

<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #3a81c3; font-weight: bold;">instance</span> <span style="color: #ba2f59; font-weight: bold;">Monad</span> <span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">Either</span> e<span style="color: #3a81c3;">)</span> <span style="color: #3a81c3; font-weight: bold;">where</span>
    <span style="color: #ba2f59; font-weight: bold;">Left</span>  l <span style="color: #715ab1;">&gt;&gt;=</span> <span style="color: #3a81c3; font-weight: bold;">_</span> <span style="color: #715ab1;">=</span> <span style="color: #ba2f59; font-weight: bold;">Left</span> l
    <span style="color: #ba2f59; font-weight: bold;">Right</span> r <span style="color: #715ab1;">&gt;&gt;=</span> k <span style="color: #715ab1;">=</span> k r 
</pre>
</div>

<p>
Note that the left branch will short-circuit which is particularly useful! See
<a href="https://www.haskellforall.com/2021/05/the-trick-to-avoid-deeply-nested-error.html">this post</a> by Gabriel Gonzalez for a worked example.
</p>
</div>
</div>

<div id="outline-container-org3a489c5" class="outline-4">
<h4 id="org3a489c5">Missing <code>MonadFail</code> instance</h4>
<div class="outline-text-4" id="text-org3a489c5">
<p>
Described <a href="https://gitlab.haskell.org/ghc/ghc/-/issues/12160">here</a>
</p>

<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #3a81c3; font-weight: bold;">instance</span> <span style="color: #ba2f59; font-weight: bold;">MonadFail</span> <span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">Either</span> <span style="color: #ba2f59; font-weight: bold;">String</span><span style="color: #3a81c3;">)</span> <span style="color: #3a81c3; font-weight: bold;">where</span>
  fail <span style="color: #715ab1;">=</span> <span style="color: #ba2f59; font-weight: bold;">Left</span>
</pre>
</div>

<p>
This sort of thing was ultimately rejected to preserve a neutral interpretation
of how the Either monad would should work.
</p>
</div>
</div>
</div>

<div id="outline-container-orgb2faa4e" class="outline-3">
<h3 id="orgb2faa4e">JSON with Aeson</h3>
<div class="outline-text-3" id="text-orgb2faa4e">
<p>
For additional notes on JSON see <a href="./json-notes.html">my json notes</a>.
</p>

<p>
<code>aeson</code> is <i>the</i> package for working with JSON. The important functions provided
are <code>encode</code> and <code>decode</code> and the typeclasses <code>ToJson</code> and <code>FromJson</code> which
ensure a type can be encoded and decoded. They can be derived automatically
along with <code>Generic</code>, although this requires the <code>DeriveGeneric</code> extension to be
include. The <code>OverloadedStrings</code> is also very useful to include. In addition to
loading <code>import Data.Aeson as JSON</code> you need to <code>import GHC.Generics</code>. This
stuff tends to work with lazy bytestrings, so there may be a little bit of
messing around to get that working but it is not too bad. The following are very
useful signatures to keep handy.
</p>

<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #6c3163;">{-# LANGUAGE DeriveGeneric #-}</span>

<span style="color: #3a81c3; font-weight: bold;">import</span> <span style="color: #ba2f59; font-weight: bold;">Data.Aeson</span>

<span style="color: #6c3163; font-weight: bold;">decode</span> <span style="color: #715ab1;">::</span> <span style="color: #ba2f59; font-weight: bold;">FromJSON</span> a <span style="color: #715ab1;">=&gt;</span> <span style="color: #ba2f59; font-weight: bold;">ByteString</span> <span style="color: #715ab1;">-&gt;</span> <span style="color: #ba2f59; font-weight: bold;">Maybe</span> a
<span style="color: #6c3163; font-weight: bold;">encode</span> <span style="color: #715ab1;">::</span> <span style="color: #ba2f59; font-weight: bold;">ToJSON</span> a <span style="color: #715ab1;">=&gt;</span> a <span style="color: #715ab1;">-&gt;</span> <span style="color: #ba2f59; font-weight: bold;">ByteString</span>
<span style="color: #6c3163; font-weight: bold;">encodeFile</span> <span style="color: #715ab1;">::</span> <span style="color: #ba2f59; font-weight: bold;">ToJSON</span> a <span style="color: #715ab1;">=&gt;</span> <span style="color: #ba2f59; font-weight: bold;">FilePath</span> <span style="color: #715ab1;">-&gt;</span> a <span style="color: #715ab1;">-&gt;</span> <span style="color: #ba2f59; font-weight: bold;">IO</span> <span style="color: #3a81c3; font-weight: bold;">()</span> 
</pre>
</div>

<p>
Alternatively, you can use the <a href="https://hackage.haskell.org/package/bytestring-0.10.10.0/docs/Data-ByteString-Lazy.html#t:ByteString"><code>ByteString</code></a> type from the <code>bytestring</code> package
to write things to disk.
</p>

<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #3a81c3; font-weight: bold;">import</span> <span style="color: #ba2f59; font-weight: bold;">Data.ByteString.Lazy</span>

<span style="color: #6c3163; font-weight: bold;">writeFile</span> <span style="color: #715ab1;">::</span> <span style="color: #ba2f59; font-weight: bold;">FilePath</span> <span style="color: #715ab1;">-&gt;</span> <span style="color: #ba2f59; font-weight: bold;">ByteString</span> <span style="color: #715ab1;">-&gt;</span> <span style="color: #ba2f59; font-weight: bold;">IO</span> <span style="color: #3a81c3; font-weight: bold;">()</span>
<span style="color: #6c3163; font-weight: bold;">readFile</span> <span style="color: #715ab1;">::</span> <span style="color: #ba2f59; font-weight: bold;">FilePath</span> <span style="color: #715ab1;">-&gt;</span> <span style="color: #ba2f59; font-weight: bold;">IO</span> <span style="color: #ba2f59; font-weight: bold;">ByteString</span>
</pre>
</div>

<p>
<b>Note</b> that when decoding an object from a JSON file, the order of the key-value
pairs in the JSON does not matter, nor does the existance of additional fields
provided the important ones can be parsed correctly.
</p>

<p>
There is a useful <a href="https://williamyaoh.com/posts/2019-10-19-a-cheatsheet-to-json-handling.html">cheatsheet</a> on parsing JSON from William Yao which may be worth
looking at.
</p>
</div>

<div id="outline-container-org9fc007b" class="outline-4">
<h4 id="org9fc007b">Pretty printing JSON</h4>
<div class="outline-text-4" id="text-org9fc007b">
<p>
There is the <code>aeson-pretty</code> package to pretty print JSON values. The following
function might be useful as a quick toggle between the methods.
</p>

<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #3a81c3; font-weight: bold;">import</span> <span style="color: #3a81c3; font-weight: bold;">qualified</span> <span style="color: #ba2f59; font-weight: bold;">Data.Aeson</span>                         <span style="color: #3a81c3; font-weight: bold;">as</span> <span style="color: #ba2f59; font-weight: bold;">Json</span>
<span style="color: #3a81c3; font-weight: bold;">import</span> <span style="color: #3a81c3; font-weight: bold;">qualified</span> <span style="color: #ba2f59; font-weight: bold;">Data.Aeson.Encode.Pretty</span>           <span style="color: #3a81c3; font-weight: bold;">as</span> <span style="color: #ba2f59; font-weight: bold;">Pretty</span>

<span style="color: #da8b55;">-- | Write the object to file as JSON with optional pretty printing.</span>
<span style="color: #6c3163; font-weight: bold;">encode2File</span> <span style="color: #715ab1;">::</span> <span style="color: #ba2f59; font-weight: bold;">Json.ToJSON</span> a <span style="color: #715ab1;">=&gt;</span> <span style="color: #ba2f59; font-weight: bold;">Bool</span> <span style="color: #715ab1;">-&gt;</span> <span style="color: #ba2f59; font-weight: bold;">FilePath</span> <span style="color: #715ab1;">-&gt;</span> a <span style="color: #715ab1;">-&gt;</span> <span style="color: #ba2f59; font-weight: bold;">IO</span> <span style="color: #3a81c3; font-weight: bold;">()</span>
<span style="color: #6c3163; font-weight: bold;">encode2File</span> isPretty fp <span style="color: #715ab1;">=</span> L.writeFile fp <span style="color: #715ab1;">.</span> <span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">if</span> isPretty <span style="color: #3a81c3; font-weight: bold;">then</span> Pretty.encodePretty <span style="color: #3a81c3; font-weight: bold;">else</span> Json.encode<span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgefe787c" class="outline-3">
<h3 id="orgefe787c">GHC extensions</h3>
<div class="outline-text-3" id="text-orgefe787c">
</div>
<div id="outline-container-orgc783adb" class="outline-4">
<h4 id="orgc783adb"><a href="https://downloads.haskell.org/~ghc/8.2.1/docs/html/users_guide/glasgow_exts.html#overloaded-string-literals"><code>OverloadedStrings</code></a></h4>
<div class="outline-text-4" id="text-orgc783adb">
<p>
Allows you to use string literals to mean other string-ey type things.
For instance, this would be useful when working with <code>Text</code>.
</p>
</div>
</div>
<div id="outline-container-orgecfbeaa" class="outline-4">
<h4 id="orgecfbeaa"><a href="https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#unicode-syntax"><code>UnicodeSyntax</code></a></h4>
<div class="outline-text-4" id="text-orgecfbeaa">
<p>
This allows you to make use of Unicode characters in your code which is
particularly nice if you are going a verbatim translation of some mathematics.
Emacs provides a nice way to make it easy to <a href="https://www.gnu.org/software/emacs/manual/html_node/emacs/Select-Input-Method.html">input Unicode</a>.
</p>

<p>
Although this does not appear in the <a href="#org0eb3e68">Boring Haskell</a> recommendations, I suspect
it has sufficient utility in scientific programming to warrant an exception.
</p>
</div>
</div>

<div id="outline-container-org75ad957" class="outline-4">
<h4 id="org75ad957"><a href="https://gitlab.haskell.org/ghc/ghc/-/wikis/overloaded-lists"><code>OverloadedLists</code></a></h4>
<div class="outline-text-4" id="text-org75ad957">
<p>
This desugars list syntax to make it easier to use list syntax to construct
things.
</p>

<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #6c3163;">{-# LANGUAGE OverloadedLists #-}</span>

<span style="color: #6c3163; font-weight: bold;">foo</span> <span style="color: #715ab1;">=</span> <span style="color: #3a81c3;">[</span><span style="color: #6c3163;">(</span><span style="color: #4e3163;">1</span>,<span style="color: #4e3163;">2</span><span style="color: #6c3163;">)</span>,<span style="color: #6c3163;">(</span><span style="color: #4e3163;">2</span>,<span style="color: #4e3163;">3</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">]</span> <span style="color: #715ab1;">::</span> <span style="color: #ba2f59; font-weight: bold;">Map</span> <span style="color: #ba2f59; font-weight: bold;">Int</span> <span style="color: #ba2f59; font-weight: bold;">Int</span>
</pre>
</div>

<p>
This will only work with the <code>OverloadedLists</code> extension.
</p>
</div>
</div>

<div id="outline-container-org3196c2b" class="outline-4">
<h4 id="org3196c2b">View Patterns</h4>
<div class="outline-text-4" id="text-org3196c2b">
<p>
The following example from <a href="https://kowainik.github.io/posts/arrows-zoo#view-patterns">Kowainik</a> demonstrates nicely
</p>

<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #6c3163; font-weight: bold;">mkUser</span> <span style="color: #715ab1;">::</span> <span style="color: #ba2f59; font-weight: bold;">Text</span> <span style="color: #715ab1;">-&gt;</span> <span style="color: #ba2f59; font-weight: bold;">Text</span> <span style="color: #715ab1;">-&gt;</span> <span style="color: #ba2f59; font-weight: bold;">User</span>
<span style="color: #6c3163; font-weight: bold;">mkUser</span> <span style="color: #3a81c3;">(</span>Text.toLower <span style="color: #715ab1;">-&gt;</span> nickname<span style="color: #3a81c3;">)</span> <span style="color: #3a81c3;">(</span>Text.toLower <span style="color: #715ab1;">-&gt;</span> name<span style="color: #3a81c3;">)</span> <span style="color: #715ab1;">=</span> <span style="color: #ba2f59; font-weight: bold;">User</span>
    <span style="color: #3a81c3;">{</span> userNickname <span style="color: #715ab1;">=</span> nickname
    , userName <span style="color: #715ab1;">=</span> name
    <span style="color: #3a81c3;">}</span> 
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org480344f" class="outline-3">
<h3 id="org480344f">GHC extensions: <code>DeriveX</code></h3>
<div class="outline-text-3" id="text-org480344f">
<ul class="org-ul">
<li><code>DeriveFunctor</code></li>
<li><code>DeriveFoldable</code></li>
<li><code>DeriveTraversable</code></li>
<li><code>GeneralizedNewtypeDeriving</code> to make better use of <code>newtype</code>.</li>
</ul>
</div>
</div>

<div id="outline-container-orgdb77f73" class="outline-3">
<h3 id="orgdb77f73">Packages I like</h3>
<div class="outline-text-3" id="text-orgdb77f73">
</div>
<div id="outline-container-org8f711fa" class="outline-4">
<h4 id="org8f711fa"><a href="http://hackage.haskell.org/package/ad"><code>ad</code></a>: combinators for automatic differentiation</h4>
</div>
<div id="outline-container-org39d545d" class="outline-4">
<h4 id="org39d545d"><a href="https://hackage.haskell.org/package/aeson"><code>aeson</code></a>: a JSON parsing and encoding library</h4>
</div>
<div id="outline-container-orgb7d7cec" class="outline-4">
<h4 id="orgb7d7cec"><a href="https://hackage.haskell.org/package/cassava"><code>cassava</code></a>: parsing and encoding RFC 4180 compliant CSV data</h4>
<div class="outline-text-4" id="text-orgb7d7cec">
<p>
One example of using <code>cassava</code> is to make the <code>Chain</code> type from <code>mcmc-types</code> an
instance of <code>ToRecord</code> which makes it easier to write MCMC samples to a CSV. The
following snippet demonstrates how you might do this with an orphan-instance.
</p>

<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #3a81c3; font-weight: bold;">import</span> <span style="color: #ba2f59; font-weight: bold;">Data.Csv</span>
<span style="color: #3a81c3; font-weight: bold;">import</span> <span style="color: #ba2f59; font-weight: bold;">Data.Maybe</span> <span style="color: #3a81c3;">(</span>fromMaybe<span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3; font-weight: bold;">import</span> <span style="color: #3a81c3; font-weight: bold;">qualified</span> <span style="color: #ba2f59; font-weight: bold;">Data.Vector</span> <span style="color: #3a81c3; font-weight: bold;">as</span> <span style="color: #ba2f59; font-weight: bold;">V</span>

<span style="color: #3a81c3; font-weight: bold;">instance</span> <span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">ToRecord</span> a, <span style="color: #ba2f59; font-weight: bold;">ToRecord</span> b<span style="color: #3a81c3;">)</span> <span style="color: #715ab1;">=&gt;</span> <span style="color: #ba2f59; font-weight: bold;">ToRecord</span> <span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">Chain</span> a b<span style="color: #3a81c3;">)</span> <span style="color: #3a81c3; font-weight: bold;">where</span>
  toRecord <span style="color: #ba2f59; font-weight: bold;">Chain</span> <span style="color: #3a81c3;">{</span><span style="color: #715ab1;">..</span><span style="color: #3a81c3;">}</span> <span style="color: #715ab1;">=</span>
    V.concat
      <span style="color: #3a81c3;">[</span> <span style="color: #6c3163;">(</span>record <span style="color: #2d9574;">[</span>toField chainScore<span style="color: #2d9574;">]</span><span style="color: #6c3163;">)</span>
      , <span style="color: #6c3163;">(</span>toRecord chainPosition<span style="color: #6c3163;">)</span>
      , fromMaybe V.empty <span style="color: #6c3163;">(</span>toRecord <span style="color: #715ab1;">&lt;$&gt;</span> chainTunables<span style="color: #6c3163;">)</span>
      <span style="color: #3a81c3;">]</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org78e42ea" class="outline-4">
<h4 id="org78e42ea"><a href="https://hackage.haskell.org/package/math-functions"><code>math-functions</code></a>: various utilities for numerical computing</h4>
</div>
<div id="outline-container-orga3e47d3" class="outline-4">
<h4 id="orga3e47d3"><a href="https://hackage.haskell.org/package/moo"><code>moo</code></a>: provides building blocks to build genetic algorithms</h4>
</div>
<div id="outline-container-orgc46b722" class="outline-4">
<h4 id="orgc46b722"><a href="https://hackage.haskell.org/package/monad-par"><code>monad-par</code></a> which makes use of combinators in <a href="https://hackage.haskell.org/package/monad-par-extras"><code>monad-par-extras</code></a></h4>
<div class="outline-text-4" id="text-orgc46b722">
<p>
Without knowing anything about how this works internally, the following functions should be sufficient for running a map type computation in parallel.
</p>

<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #3a81c3; font-weight: bold;">import</span> <span style="color: #ba2f59; font-weight: bold;">Control.Monad.Par</span> <span style="color: #3a81c3;">(</span>runPar<span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3; font-weight: bold;">import</span> <span style="color: #ba2f59; font-weight: bold;">Control.Monad.Par.Combinator</span> <span style="color: #3a81c3;">(</span>parMap<span style="color: #3a81c3;">)</span>

<span style="color: #3a81c3; font-weight: bold;">data</span> <span style="color: #ba2f59; font-weight: bold;">Par</span> a

<span style="color: #6c3163; font-weight: bold;">runPar</span> <span style="color: #715ab1;">::</span> <span style="color: #ba2f59; font-weight: bold;">Par</span> a <span style="color: #715ab1;">-&gt;</span> a
<span style="color: #6c3163; font-weight: bold;">parMap</span> <span style="color: #715ab1;">::</span> <span style="color: #ba2f59; font-weight: bold;">Traversable</span> t <span style="color: #715ab1;">=&gt;</span> <span style="color: #3a81c3;">(</span>a <span style="color: #715ab1;">-&gt;</span> b<span style="color: #3a81c3;">)</span> <span style="color: #715ab1;">-&gt;</span> t a <span style="color: #715ab1;">-&gt;</span> p <span style="color: #3a81c3;">(</span>t b<span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcddd880" class="outline-4">
<h4 id="orgcddd880"><a href="https://hackage.haskell.org/package/statistics"><code>statistics</code></a>: common functions and types useful in statistics</h4>
</div>
</div>

<div id="outline-container-org7ad9e95" class="outline-3">
<h3 id="org7ad9e95">Scary and terrifying functions!!!</h3>
<div class="outline-text-3" id="text-org7ad9e95">
</div>
<div id="outline-container-org94bd3b2" class="outline-4">
<h4 id="org94bd3b2">Scary</h4>
<div class="outline-text-4" id="text-org94bd3b2">
<ul class="org-ul">
<li><code>Data.List.sum</code> and <code>Data.List.product</code> use <code>foldl</code> instead of <code>foldl'</code> so can
have poor performance.</li>
<li>Lots of the functions in <code>Data.List</code> are partial: <code>head</code>, <code>init</code>, <code>last</code>,
<code>tail</code> and <code>(!!)</code> for example.</li>
</ul>
</div>
</div>

<div id="outline-container-orge815e3e" class="outline-4">
<h4 id="orge815e3e">Terrifying</h4>
<div class="outline-text-4" id="text-orge815e3e">
<dl class="org-dl">
<dt><code>fromJust</code>, always use ~fromMaybe</dt><dd>a -&gt; Maybe a -&gt; a~ instead.</dd>
</dl>
</div>
</div>
</div>

<div id="outline-container-org795228b" class="outline-3">
<h3 id="org795228b">Parallel execution</h3>
<div class="outline-text-3" id="text-org795228b">
<p>
There is <code>GHC.Conc.numCapabilities</code> to see how many cores are available to the
runtime.
</p>
</div>

<div id="outline-container-orgfb3f7f3" class="outline-4">
<h4 id="orgfb3f7f3">Evaluation with <code>seq</code></h4>
<div class="outline-text-4" id="text-orgfb3f7f3">
<p>
There is a section on <code>seq</code> in Chapter 4 of Real World Haskell. In particular,
the following snippet from that chapter provides insight.
</p>

<div class="org-src-container">
<pre class="src src-haskell"> <span style="color: #2aa1ae; background-color: #ecf3ec;">-- </span><span style="color: #2aa1ae; background-color: #ecf3ec;">file: ch04/Fold.hs</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">-- </span><span style="color: #2aa1ae; background-color: #ecf3ec;">incorrect: seq is hidden by the application of someFunc</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">-- </span><span style="color: #2aa1ae; background-color: #ecf3ec;">since someFunc will be evaluated first, seq may occur too late</span>
<span style="color: #6c3163; font-weight: bold;">hiddenInside</span> x y <span style="color: #715ab1;">=</span> someFunc <span style="color: #3a81c3;">(</span>x <span style="color: #715ab1;">`seq`</span> y<span style="color: #3a81c3;">)</span>

<span style="color: #2aa1ae; background-color: #ecf3ec;">-- </span><span style="color: #2aa1ae; background-color: #ecf3ec;">incorrect: a variation of the above mistake</span>
<span style="color: #6c3163; font-weight: bold;">hiddenByLet</span> x y z <span style="color: #715ab1;">=</span> <span style="color: #3a81c3; font-weight: bold;">let</span> a <span style="color: #715ab1;">=</span> x <span style="color: #715ab1;">`seq`</span> someFunc y
                    <span style="color: #3a81c3; font-weight: bold;">in</span> anotherFunc a z

<span style="color: #2aa1ae; background-color: #ecf3ec;">-- </span><span style="color: #2aa1ae; background-color: #ecf3ec;">correct: seq will be evaluated first, forcing evaluation of x</span>
<span style="color: #6c3163; font-weight: bold;">onTheOutside</span> x y <span style="color: #715ab1;">=</span> x <span style="color: #715ab1;">`seq`</span> someFunc y 
</pre>
</div>

<p>
Keep in mind that <code>seq</code> only evaluates up to the first constructor, and that
there is an additional cost with forcing evaulation since the runtime needs to
do a look up to determine if it has already been evaluated. Depending on what is
being evaluated this can even introduce a space leak.
</p>
</div>
</div>

<div id="outline-container-org8bbdd24" class="outline-4">
<h4 id="org8bbdd24">Example</h4>
<div class="outline-text-4" id="text-org8bbdd24">
<p>
The very simple example given here demonstrates how to run code in parallel
using only the <code>parallel</code> library (which is maintained by
<code>libraries@haskell.org</code> so can be relied upon).
</p>

<div class="org-src-container">
<pre class="src src-yaml">executable party
  <span style="color: #715ab1;">hs-source-dirs</span>:   src
  <span style="color: #715ab1;">main-is</span>:          Main.hs
  <span style="color: #715ab1;">default-language</span>: Haskell2010
  <span style="color: #715ab1;">ghc-options</span>:      -threaded -O2
  <span style="color: #715ab1;">build-depends</span>:
      base               &gt;=4.7      &amp;&amp; &lt;5
    , mwc-random
    , parallel
    , primitive          &gt;=0.7.1.0
    , vector             &gt;=0.12.1.2
</pre>
</div>

<p>
And the following <code>Main.hs</code>
</p>

<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #3a81c3; font-weight: bold;">module</span> <span style="color: #ba2f59; font-weight: bold;">Main</span> <span style="color: #3a81c3; font-weight: bold;">where</span>

<span style="color: #3a81c3; font-weight: bold;">import</span> <span style="color: #ba2f59; font-weight: bold;">Control.Monad.Primitive</span> <span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">PrimMonad</span>, <span style="color: #ba2f59; font-weight: bold;">PrimState</span><span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3; font-weight: bold;">import</span> <span style="color: #ba2f59; font-weight: bold;">Control.Monad.ST</span> <span style="color: #3a81c3;">(</span>runST<span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3; font-weight: bold;">import</span> <span style="color: #ba2f59; font-weight: bold;">Data.Vector.Unboxed</span> <span style="color: #3a81c3;">(</span>singleton<span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3; font-weight: bold;">import</span> <span style="color: #ba2f59; font-weight: bold;">Data.Word</span> <span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">Word32</span><span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3; font-weight: bold;">import</span> <span style="color: #ba2f59; font-weight: bold;">System.Random.MWC</span> <span style="color: #3a81c3;">(</span>asGenST, initialize<span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3; font-weight: bold;">import</span> <span style="color: #ba2f59; font-weight: bold;">Control.Parallel.Strategies</span>
<span style="color: #3a81c3; font-weight: bold;">import</span> <span style="color: #ba2f59; font-weight: bold;">System.Environment</span> <span style="color: #3a81c3;">(</span>getArgs<span style="color: #3a81c3;">)</span>

<span style="color: #6c3163; font-weight: bold;">main</span> <span style="color: #715ab1;">::</span> <span style="color: #ba2f59; font-weight: bold;">IO</span> <span style="color: #3a81c3; font-weight: bold;">()</span>
<span style="color: #6c3163; font-weight: bold;">main</span> <span style="color: #715ab1;">=</span> <span style="color: #3a81c3; font-weight: bold;">do</span>
  putStrLn <span style="color: #2d9574;">"Hello"</span>
  <span style="color: #3a81c3;">(</span>inParallel<span style="color: #ba2f59; font-weight: bold;">:</span>maxN<span style="color: #ba2f59; font-weight: bold;">:</span><span style="color: #6c3163; font-weight: bold;">[]</span><span style="color: #3a81c3;">)</span> <span style="color: #715ab1;">&lt;-</span> getArgs
  <span style="color: #3a81c3; font-weight: bold;">let</span> maxNInteger <span style="color: #715ab1;">=</span> read maxN <span style="color: #715ab1;">::</span> <span style="color: #ba2f59; font-weight: bold;">Int</span>
      ns <span style="color: #715ab1;">=</span> replicate maxNInteger <span style="color: #4e3163;">30</span>
  print <span style="color: #715ab1;">$</span> <span style="color: #2d9574;">"running up to "</span> <span style="color: #715ab1;">++</span> maxN
  <span style="color: #3a81c3; font-weight: bold;">if</span> inParallel <span style="color: #715ab1;">==</span> <span style="color: #2d9574;">"true"</span>
    <span style="color: #3a81c3; font-weight: bold;">then</span> <span style="color: #3a81c3; font-weight: bold;">let</span> results <span style="color: #715ab1;">=</span> <span style="color: #3a81c3;">(</span>fib <span style="color: #715ab1;">&lt;$&gt;</span> ns <span style="color: #715ab1;">`using`</span> parListChunk <span style="color: #4e3163;">4</span> rdeepseq<span style="color: #3a81c3;">)</span> <span style="color: #715ab1;">::</span> <span style="color: #3a81c3;">[</span><span style="color: #ba2f59; font-weight: bold;">Integer</span><span style="color: #3a81c3;">]</span>
         <span style="color: #3a81c3; font-weight: bold;">in</span> <span style="color: #3a81c3; font-weight: bold;">do</span> print <span style="color: #2d9574;">"running parallel"</span>; print <span style="color: #715ab1;">$</span> sum results
    <span style="color: #3a81c3; font-weight: bold;">else</span> <span style="color: #3a81c3; font-weight: bold;">let</span> results <span style="color: #715ab1;">=</span> <span style="color: #3a81c3;">(</span>fib <span style="color: #715ab1;">&lt;$&gt;</span> ns<span style="color: #3a81c3;">)</span> <span style="color: #715ab1;">::</span> <span style="color: #3a81c3;">[</span><span style="color: #ba2f59; font-weight: bold;">Integer</span><span style="color: #3a81c3;">]</span>
         <span style="color: #3a81c3; font-weight: bold;">in</span> <span style="color: #3a81c3; font-weight: bold;">do</span> print <span style="color: #2d9574;">"running serial"</span>; print <span style="color: #715ab1;">$</span> sum results
  putStrLn <span style="color: #2d9574;">"Goodbye"</span>

<span style="color: #6c3163; font-weight: bold;">fib</span> <span style="color: #715ab1;">::</span> <span style="color: #ba2f59; font-weight: bold;">Integer</span> <span style="color: #715ab1;">-&gt;</span> <span style="color: #ba2f59; font-weight: bold;">Integer</span>
<span style="color: #6c3163; font-weight: bold;">fib</span> n
  <span style="color: #715ab1;">|</span> n <span style="color: #715ab1;">&lt;</span> <span style="color: #4e3163;">2</span> <span style="color: #715ab1;">=</span> <span style="color: #4e3163;">1</span>
  <span style="color: #715ab1;">|</span> otherwise <span style="color: #715ab1;">=</span> fib <span style="color: #3a81c3;">(</span>n <span style="color: #715ab1;">-</span><span style="color: #4e3163;">1</span><span style="color: #3a81c3;">)</span> <span style="color: #715ab1;">+</span> fib<span style="color: #3a81c3;">(</span>n<span style="color: #715ab1;">-</span><span style="color: #4e3163;">2</span><span style="color: #3a81c3;">)</span>
</pre>
</div>

<p>
The following script is used to test out the performance of this code.
</p>

<pre class="example">
time stack exec party false 100 --rts-options -N1
time stack exec party false 100 --rts-options -N2
time stack exec party false 100 --rts-options -N4

time stack exec party true 100 --rts-options -N1
time stack exec party true 100 --rts-options -N2
time stack exec party true 100 --rts-options -N4
</pre>

<p>
the results of this confirm that increasing the number of processors allowed to
be used reduces the run time but there is a limit to how useful this will be.
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">Number of threads</th>
<th scope="col" class="org-right">Serial</th>
<th scope="col" class="org-right">Parallel</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">1</td>
<td class="org-right">4.33</td>
<td class="org-right">4.32</td>
</tr>

<tr>
<td class="org-right">2</td>
<td class="org-right">4.32</td>
<td class="org-right">2.36</td>
</tr>

<tr>
<td class="org-right">4</td>
<td class="org-right">4.41</td>
<td class="org-right">2.23</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>

<div id="outline-container-org1b41c64" class="outline-2">
<h2 id="org1b41c64">Hackage</h2>
<div class="outline-text-2" id="text-org1b41c64">
<ul class="org-ul">
<li><a href="https://pvp.haskell.org/">Haskell Package Versioning Policy</a></li>
</ul>
</div>

<div id="outline-container-org9c0246b" class="outline-3">
<h3 id="org9c0246b">Development shell</h3>
<div class="outline-text-3" id="text-org9c0246b">
<ul class="org-ul">
<li>There is a nix-shell to assist in testing your package in a reproducible
environment described in <a href="./nix-notes.html">my nix note</a>. This provides a couple of utilities for
building your package.</li>
</ul>
</div>
</div>

<div id="outline-container-org01e0d74" class="outline-3">
<h3 id="org01e0d74">Notes about uploading a package to hackage</h3>
<div class="outline-text-3" id="text-org01e0d74">
<ul class="org-ul">
<li>Once a package is uploaded, it is there forever so make sure it is correct,
that is why there is the package candidate system.</li>
<li>The utility <code>cabal gen-bounds</code> makes it easy to generate suitable bounds on
dependency versions. To keep the version bounds DRY you only need to specify
them on their first occurrence in the cabal file. This will only work with an
up to date version of cabal.</li>
<li>There is the <code>cabal-fmt</code> package which you can use to format your cabal file,
eg <code>cabal-fmt --inplace demo.cabal</code>.</li>
<li>There is a cabal <code>sdist</code> utility to zip up a package prior to submission.</li>
<li>When a package is updated the <i>package versioning policy</i> should be used to
update the package version. There is a useful <a href="https://pvp.haskell.org/#decision-tree">decision tree</a> to help you apply
this policy. A version must be of the form <code>A.B.C</code> with an optional suffix of
<code>.D</code>.</li>
<li>The command <code>stack sdist</code> will check the package for common mistakes and
produce a tarball ready for uploading. When a package is uploaded, it may take
a while for the documentation to be build and uploaded.</li>
<li>To use the uploaded package before it has made it onto stackage you can copy
the link for the tarball into <code>extra-deps</code> in the stack YAML file.</li>
<li>Don't forget to <code>stack haddock --no-haddock-deps</code> first to make sure that the
documentation will build. Also, don't be surprised if the documentation does
not appear online immediately, this can take a while.</li>
<li>There is a <a href="http://hackage.haskell.org/upload">link to upload</a> packages on the hackage page, you can use <code>stack
  upload .</code>. Either way, you will need your hackage username and password.</li>
</ul>
</div>
</div>

<div id="outline-container-orga722cf0" class="outline-3">
<h3 id="orga722cf0">Extracting example code</h3>
<div class="outline-text-3" id="text-orga722cf0">
<p>
If you have examples in a source file using the <code>&gt;&gt;&gt;</code> notation you can extract
it with the following one liner.
</p>

<div class="org-src-container">
<pre class="src src-sh">$ cat &lt;path/to/hs&gt; | grep <span style="color: #2d9574;">"^-- &gt;&gt;&gt;"</span> 
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org4942902" class="outline-2">
<h2 id="org4942902">Type theory and functional programming</h2>
<div class="outline-text-2" id="text-org4942902">
<p>
See my <a href="./type-theory-notes.html">type theory and functional programming notes</a>
</p>
</div>
</div>

<div id="outline-container-orgaccd5fd" class="outline-2">
<h2 id="orgaccd5fd">Haskell for science</h2>
<div class="outline-text-2" id="text-orgaccd5fd">
<p>
I have some <a href="./numerics-notes.html">notes on numerics</a> that might be useful.
</p>
</div>

<div id="outline-container-org5e15a33" class="outline-3">
<h3 id="org5e15a33">Optimisation</h3>
<div class="outline-text-3" id="text-org5e15a33">
<p>
Use <code>moo</code> for a rough estimate.
</p>
</div>
</div>

<div id="outline-container-orge95a44b" class="outline-3">
<h3 id="orge95a44b">Root finding</h3>
<div class="outline-text-3" id="text-orge95a44b">
<p>
Use <code>statistics</code> for finding roots if you know a bounding interval, with or
without derivatives, both Ridders and Newton have good convergence.
</p>
</div>
</div>

<div id="outline-container-orgff6a7fd" class="outline-3">
<h3 id="orgff6a7fd">Differential equations</h3>
<div class="outline-text-3" id="text-orgff6a7fd">
<p>
Consider
</p>

<p>
\[
\frac{dx}{dt} = \alpha x(t), \quad x(0) = x_0
\]
</p>

<p>
This example needs <code>hmatrix</code> and <code>hmatrix-gsl</code>.
</p>

<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #3a81c3; font-weight: bold;">import</span> <span style="color: #ba2f59; font-weight: bold;">Numeric.GSL.ODE</span>
<span style="color: #3a81c3; font-weight: bold;">import</span> <span style="color: #ba2f59; font-weight: bold;">Numeric.LinearAlgebra</span>
<span style="color: #3a81c3; font-weight: bold;">import</span> <span style="color: #ba2f59; font-weight: bold;">Numeric.LinearAlgebra.Data</span>

<span style="color: #6c3163; font-weight: bold;">alpha</span> <span style="color: #715ab1;">=</span> <span style="color: #4e3163;">0.1</span>

<span style="color: #6c3163; font-weight: bold;">xdash</span> <span style="color: #3a81c3; font-weight: bold;">_</span> <span style="color: #3a81c3;">[</span>x<span style="color: #3a81c3;">]</span> <span style="color: #715ab1;">=</span> <span style="color: #3a81c3;">[</span>x <span style="color: #715ab1;">*</span> alpha<span style="color: #3a81c3;">]</span>

<span style="color: #6c3163; font-weight: bold;">x0</span> <span style="color: #715ab1;">=</span> <span style="color: #4e3163;">1.0</span>

<span style="color: #6c3163; font-weight: bold;">ts</span> <span style="color: #715ab1;">=</span> linspace <span style="color: #4e3163;">100</span> <span style="color: #3a81c3;">(</span><span style="color: #4e3163;">0</span>,<span style="color: #4e3163;">3</span><span style="color: #3a81c3;">)</span>

<span style="color: #6c3163; font-weight: bold;">numericSol</span> <span style="color: #715ab1;">=</span> odeSolve xdash <span style="color: #3a81c3;">[</span>x0<span style="color: #3a81c3;">]</span> ts

<span style="color: #6c3163; font-weight: bold;">exactSol</span> <span style="color: #715ab1;">=</span> asColumn <span style="color: #715ab1;">$</span> x0' <span style="color: #715ab1;">*</span> exp <span style="color: #3a81c3;">(</span>alpha' <span style="color: #715ab1;">*</span> ts<span style="color: #3a81c3;">)</span>
  <span style="color: #3a81c3; font-weight: bold;">where</span>
    x0' <span style="color: #715ab1;">=</span> scalar x0
    alpha' <span style="color: #715ab1;">=</span> scalar alpha


<span style="color: #6c3163; font-weight: bold;">main</span> <span style="color: #715ab1;">::</span> <span style="color: #ba2f59; font-weight: bold;">IO</span> <span style="color: #3a81c3; font-weight: bold;">()</span>
<span style="color: #6c3163; font-weight: bold;">main</span> <span style="color: #715ab1;">=</span>
  <span style="color: #3a81c3; font-weight: bold;">if</span> maxElement <span style="color: #3a81c3;">(</span>numericSol <span style="color: #715ab1;">-</span> exactSol<span style="color: #3a81c3;">)</span> <span style="color: #715ab1;">&lt;</span> <span style="color: #4e3163;">1e-10</span>
    <span style="color: #3a81c3; font-weight: bold;">then</span> putStrLn <span style="color: #2d9574;">"They are equal!"</span>
    <span style="color: #3a81c3; font-weight: bold;">else</span> putStrLn <span style="color: #2d9574;">"Huge error :("</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org048a8bc" class="outline-3">
<h3 id="org048a8bc">Random number simulation</h3>
<div class="outline-text-3" id="text-org048a8bc">
<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #3a81c3; font-weight: bold;">import</span> <span style="color: #ba2f59; font-weight: bold;">System.Random.MWC</span>

<span style="color: #6c3163; font-weight: bold;">foobar</span> <span style="color: #715ab1;">::</span> <span style="color: #ba2f59; font-weight: bold;">IO</span> <span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">Double</span>,<span style="color: #ba2f59; font-weight: bold;">Double</span><span style="color: #3a81c3;">)</span>
<span style="color: #6c3163; font-weight: bold;">foobar</span> <span style="color: #715ab1;">=</span> <span style="color: #3a81c3; font-weight: bold;">do</span>
  gen <span style="color: #715ab1;">&lt;-</span> create
  x1 <span style="color: #715ab1;">&lt;-</span> uniform gen
  x2 <span style="color: #715ab1;">&lt;-</span> uniform gen
  return <span style="color: #3a81c3;">(</span>x1,x2<span style="color: #3a81c3;">)</span>
</pre>
</div>

<p>
This returns a pair of <i>different</i> numbers because it is working in an instance
of <code>PrimMonad</code> and managing the state between uses of <code>gen</code>. Multiple calls to
this function always return the same values because the <code>create</code> function starts
with a hardcoded seed in the library.
</p>
</div>
</div>

<div id="outline-container-orgf8faf18" class="outline-3">
<h3 id="orgf8faf18">Numbers</h3>
<div class="outline-text-3" id="text-orgf8faf18">
<p>
To learn about how Haskell handles numbers &#x2014; although we only really care
about <code>Integer</code> and <code>Double</code> &#x2014; there is the <a href="https://www.haskell.org/onlinereport/basic.html">report</a> and a <a href="https://www.haskell.org/tutorial/numbers.html">gentle introduction</a>
available. The <a href="https://hackage.haskell.org/package/numeric-limits-0.1.0.0/docs/Numeric-Limits.html"><code>numeric-limits</code></a> package provides some helpful functions for
working with this too.
</p>
</div>

<div id="outline-container-org201f68c" class="outline-4">
<h4 id="org201f68c">Types</h4>
<div class="outline-text-4" id="text-org201f68c">
<ul class="org-ul">
<li><code>Natural</code> for the natural numbers</li>
<li><code>Word</code> is unsigned integers of with a finite range</li>
<li><code>Integer</code> for arbitrary integers
<ul class="org-ul">
<li>not to be confused with the <code>Integral</code> typeclass</li>
</ul></li>
<li><code>Int</code> for a finite range of integers</li>
<li><code>Float</code> for single precision floating point numbers
<ul class="org-ul">
<li>You should opt for <code>Double</code> whenever possible</li>
</ul></li>
<li><code>Double</code> for double precision floating point numbers</li>
</ul>

<p>
Also the table <a href="http://dev.stephendiehl.com/hask/#numeric-tower">here</a> provides a description of how to map between the different
numeric types.
</p>
</div>
</div>

<div id="outline-container-orgf5a15e4" class="outline-4">
<h4 id="orgf5a15e4">Typeclasses</h4>
<div class="outline-text-4" id="text-orgf5a15e4">
<p>
This graph shows the hierarchy of numeric typeclasses
</p>


<div id="orgc625067" class="figure">
<p><img src="../images/numeric-tower-haskell.png" alt="numeric-tower-haskell.png" />
</p>
</div>

<p>
The most important one here is the <code>Num</code> typeclass which ensures you have basic
arithmetic. <code>Ord</code> is also important but is a bit more general.
</p>
</div>
</div>
</div>

<div id="outline-container-orgf8327eb" class="outline-3">
<h3 id="orgf8327eb">Special functions</h3>
<div class="outline-text-3" id="text-orgf8327eb">
<p>
The <code>math-functions</code> package provides the <code>Numeric.SpecFunctions</code> module which
provides lots of useful functions: <code>choose</code> and <code>logChoose</code> for working with
binomial coefficients.
</p>
</div>
</div>

<div id="outline-container-org5acc9d4" class="outline-3">
<h3 id="org5acc9d4">Visualisation</h3>
<div class="outline-text-3" id="text-org5acc9d4">
<p>
There are bindings to gnuplot provided by the <a href="https://hackage.haskell.org/package/gnuplot">gnuplot package</a>. The documentation
is a little bit patchy, but there is a decent list of <a href="https://archives.haskell.org/code.haskell.org/gnuplot/src/Demo.hs">examples</a>. The easiest way
is to copy the demo script and to modify the code in it to generate the plot you
want. With this package you can render plots in a new window or write the
results to file.
</p>
</div>

<div id="outline-container-orge2a1f91" class="outline-4">
<h4 id="orge2a1f91">Example</h4>
<div class="outline-text-4" id="text-orge2a1f91">
<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #3a81c3; font-weight: bold;">module</span> <span style="color: #ba2f59; font-weight: bold;">Main</span> <span style="color: #3a81c3; font-weight: bold;">where</span>

<span style="color: #3a81c3; font-weight: bold;">import</span>           <span style="color: #ba2f59; font-weight: bold;">Data.Function</span>                         <span style="color: #3a81c3;">(</span><span style="color: #6c3163;">(</span><span style="color: #715ab1;">&amp;</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3; font-weight: bold;">import</span>           <span style="color: #ba2f59; font-weight: bold;">GHC.IO.Exception</span>                      <span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">ExitCode</span><span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3; font-weight: bold;">import</span> <span style="color: #3a81c3; font-weight: bold;">qualified</span> <span style="color: #ba2f59; font-weight: bold;">Graphics.Gnuplot.Advanced</span>             <span style="color: #3a81c3; font-weight: bold;">as</span> <span style="color: #ba2f59; font-weight: bold;">GP</span>
<span style="color: #3a81c3; font-weight: bold;">import</span> <span style="color: #3a81c3; font-weight: bold;">qualified</span> <span style="color: #ba2f59; font-weight: bold;">Graphics.Gnuplot.Frame</span>                <span style="color: #3a81c3; font-weight: bold;">as</span> <span style="color: #ba2f59; font-weight: bold;">Frame</span>
<span style="color: #3a81c3; font-weight: bold;">import</span> <span style="color: #3a81c3; font-weight: bold;">qualified</span> <span style="color: #ba2f59; font-weight: bold;">Graphics.Gnuplot.Frame.OptionSet</span>      <span style="color: #3a81c3; font-weight: bold;">as</span> <span style="color: #ba2f59; font-weight: bold;">Opts</span>
<span style="color: #3a81c3; font-weight: bold;">import</span> <span style="color: #3a81c3; font-weight: bold;">qualified</span> <span style="color: #ba2f59; font-weight: bold;">Graphics.Gnuplot.Graph.TwoDimensional</span> <span style="color: #3a81c3; font-weight: bold;">as</span> <span style="color: #ba2f59; font-weight: bold;">Graph2D</span>
<span style="color: #3a81c3; font-weight: bold;">import</span>           <span style="color: #ba2f59; font-weight: bold;">Graphics.Gnuplot.Plot.TwoDimensional</span>  <span style="color: #3a81c3;">(</span>linearScale<span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3; font-weight: bold;">import</span> <span style="color: #3a81c3; font-weight: bold;">qualified</span> <span style="color: #ba2f59; font-weight: bold;">Graphics.Gnuplot.Plot.TwoDimensional</span>  <span style="color: #3a81c3; font-weight: bold;">as</span> <span style="color: #ba2f59; font-weight: bold;">Plot2D</span>
<span style="color: #3a81c3; font-weight: bold;">import</span> <span style="color: #3a81c3; font-weight: bold;">qualified</span> <span style="color: #ba2f59; font-weight: bold;">Graphics.Gnuplot.Terminal.PNG</span>         <span style="color: #3a81c3; font-weight: bold;">as</span> <span style="color: #ba2f59; font-weight: bold;">PNG</span>


<span style="color: #6c3163; font-weight: bold;">main</span> <span style="color: #715ab1;">::</span> <span style="color: #ba2f59; font-weight: bold;">IO</span> <span style="color: #3a81c3; font-weight: bold;">()</span>
<span style="color: #6c3163; font-weight: bold;">main</span> <span style="color: #715ab1;">=</span> <span style="color: #3a81c3; font-weight: bold;">do</span> demo <span style="color: #ba2f59; font-weight: bold;">Nothing</span>
          return <span style="color: #3a81c3; font-weight: bold;">()</span>

<span style="color: #6c3163; font-weight: bold;">demo</span> <span style="color: #715ab1;">::</span> <span style="color: #ba2f59; font-weight: bold;">Maybe</span> <span style="color: #ba2f59; font-weight: bold;">FilePath</span> <span style="color: #715ab1;">-&gt;</span> <span style="color: #ba2f59; font-weight: bold;">IO</span> <span style="color: #ba2f59; font-weight: bold;">ExitCode</span>
<span style="color: #6c3163; font-weight: bold;">demo</span> maybeFilePath <span style="color: #715ab1;">=</span>
  <span style="color: #3a81c3; font-weight: bold;">case</span> maybeFilePath <span style="color: #3a81c3; font-weight: bold;">of</span>
    <span style="color: #ba2f59; font-weight: bold;">Just</span> fp <span style="color: #715ab1;">-&gt;</span> GP.plot <span style="color: #3a81c3;">(</span>PNG.cons fp<span style="color: #3a81c3;">)</span> foo
    <span style="color: #ba2f59; font-weight: bold;">Nothing</span> <span style="color: #715ab1;">-&gt;</span> GP.plotDefault foo
  <span style="color: #3a81c3; font-weight: bold;">where</span>
    foo <span style="color: #715ab1;">::</span> <span style="color: #ba2f59; font-weight: bold;">Frame.T</span> <span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">Graph2D.T</span> <span style="color: #ba2f59; font-weight: bold;">Double</span> <span style="color: #ba2f59; font-weight: bold;">Double</span><span style="color: #3a81c3;">)</span>
    foo <span style="color: #715ab1;">=</span> Frame.cons plotOptions <span style="color: #715ab1;">$</span> layer1 <span style="color: #715ab1;">&lt;&gt;</span> layer2
    plotOptions <span style="color: #715ab1;">=</span> Opts.deflt <span style="color: #715ab1;">&amp;</span>
      Opts.title <span style="color: #2d9574;">"hello"</span> <span style="color: #715ab1;">&amp;</span>
      Opts.key <span style="color: #ba2f59; font-weight: bold;">False</span>
    layer1 <span style="color: #715ab1;">=</span> Plot2D.function
      Graph2D.lines
      <span style="color: #3a81c3;">(</span>linearScale <span style="color: #4e3163;">200</span> <span style="color: #6c3163;">(</span><span style="color: #715ab1;">-</span><span style="color: #4e3163;">10</span>,<span style="color: #4e3163;">10</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
      <span style="color: #3a81c3;">(</span><span style="color: #715ab1;">\</span>x <span style="color: #715ab1;">-&gt;</span> x <span style="color: #715ab1;">*</span> cos x <span style="color: #715ab1;">/</span> <span style="color: #6c3163;">(</span><span style="color: #4e3163;">1</span> <span style="color: #715ab1;">+</span> x<span style="color: #715ab1;">^</span> <span style="color: #4e3163;">2</span><span style="color: #6c3163;">)</span> <span style="color: #3a81c3;">)</span>
    layer2Data <span style="color: #715ab1;">=</span> zip <span style="color: #3a81c3;">[</span><span style="color: #715ab1;">-</span><span style="color: #4e3163;">10</span><span style="color: #715ab1;">..</span><span style="color: #3a81c3;">]</span> <span style="color: #3a81c3;">(</span>take <span style="color: #4e3163;">21</span> <span style="color: #6c3163;">(</span>concat <span style="color: #2d9574;">(</span>repeat <span style="color: #67b11d;">[</span><span style="color: #715ab1;">-</span><span style="color: #4e3163;">1</span>,<span style="color: #4e3163;">0</span>,<span style="color: #4e3163;">1</span><span style="color: #67b11d;">]</span><span style="color: #2d9574;">)</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
    layer2 <span style="color: #715ab1;">=</span> Plot2D.list
      Graph2D.points <span style="color: #715ab1;">$</span> layer2Data

</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org6fd4326" class="outline-3">
<h3 id="org6fd4326">Mutable arrays</h3>
<div class="outline-text-3" id="text-org6fd4326">
<p>
Sometimes it is much more efficient to use a mutable array. Here is an example
of how to do this in the ST monad.
</p>

<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #3a81c3; font-weight: bold;">import</span>           <span style="color: #ba2f59; font-weight: bold;">Control.Monad</span>      <span style="color: #3a81c3;">(</span>forM_<span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3; font-weight: bold;">import</span>           <span style="color: #ba2f59; font-weight: bold;">Data.Array.MArray</span>  <span style="color: #3a81c3;">(</span>newArray, writeArray<span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3; font-weight: bold;">import</span>           <span style="color: #ba2f59; font-weight: bold;">Data.Array.ST</span>      <span style="color: #3a81c3;">(</span>runSTUArray<span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3; font-weight: bold;">import</span>           <span style="color: #ba2f59; font-weight: bold;">Data.Array.Unboxed</span> <span style="color: #3a81c3;">(</span>assocs<span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3; font-weight: bold;">import</span>           <span style="color: #ba2f59; font-weight: bold;">Data.STRef</span>         <span style="color: #3a81c3;">(</span>newSTRef, readSTRef, writeSTRef<span style="color: #3a81c3;">)</span>

<span style="color: #6c3163; font-weight: bold;">foo</span> <span style="color: #715ab1;">::</span> <span style="color: #3a81c3;">[</span><span style="color: #6c3163;">(</span><span style="color: #ba2f59; font-weight: bold;">Char</span>, <span style="color: #ba2f59; font-weight: bold;">Int</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">]</span>
<span style="color: #6c3163; font-weight: bold;">foo</span> <span style="color: #715ab1;">=</span> assocs <span style="color: #715ab1;">$</span> runSTUArray <span style="color: #715ab1;">$</span> <span style="color: #3a81c3; font-weight: bold;">do</span>
  index <span style="color: #715ab1;">&lt;-</span> newSTRef <span style="color: #2d9574;">'a'</span>
  ar <span style="color: #715ab1;">&lt;-</span> newArray <span style="color: #3a81c3;">(</span><span style="color: #2d9574;">'a'</span>, <span style="color: #2d9574;">'z'</span><span style="color: #3a81c3;">)</span> <span style="color: #4e3163;">0</span>
  forM_ <span style="color: #3a81c3;">[</span><span style="color: #4e3163;">1</span><span style="color: #715ab1;">..</span><span style="color: #4e3163;">26</span><span style="color: #3a81c3;">]</span> <span style="color: #715ab1;">$</span> <span style="color: #715ab1;">\</span>n <span style="color: #715ab1;">-&gt;</span>
    <span style="color: #3a81c3; font-weight: bold;">do</span> ix <span style="color: #715ab1;">&lt;-</span> readSTRef index
       writeArray ar ix n
       writeSTRef index <span style="color: #3a81c3;">(</span>succ ix<span style="color: #3a81c3;">)</span>
  return ar
</pre>
</div>

<p>
Note that in this example we have used an <code>STUArray</code>. There is also the
<code>STArray</code> which admits a wider range of types for the elements of the array,
however the <code>STUArray</code> is meant to have better performance. Don't forget to
check the provided instances of <code>MArray</code> to make sure that both your index and
element types have the necessary instances.
</p>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Alex Zarebski</p>
<p class="date">Created: 2021-10-01 Fri 15:46</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
