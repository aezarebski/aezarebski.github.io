<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2021-03-15 Mon 19:31 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>aez-notes</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Alex Zarebski" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link id="stylesheet" rel="stylesheet" type="text/css" href="../css/stylesheet-dark.css" />
<script type="text/javascript">
// @license magnet:?xt=urn:btih:e95b018ef3580986a04669f1b5879592219e2a7a&dn=public-domain.txt Public Domain
<!--/*--><![CDATA[/*><!--*/
     function CodeHighlightOn(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.add("code-highlighted");
         target.classList.add("code-highlighted");
       }
     }
     function CodeHighlightOff(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.remove("code-highlighted");
         target.classList.remove("code-highlighted");
       }
     }
    /*]]>*///-->
// @license-end
</script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
});
</script>
<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML"></script>
</head>
<body>
<div id="content">
<h1 class="title">aez-notes</h1>
<p>
<a href="../index.html">Home</a>
</p>

<button type="button" onclick="toggleStyle()">Light/Dark</button>
<script src="./main.js"></script>

<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orged7aa9e">Programming and developing in Haskell</a>
<ul>
<li><a href="#org8d171d9">Further reading</a></li>
<li><a href="#org9dd57a2">CLI</a></li>
<li><a href="#org980bda2">Debugging</a></li>
<li><a href="#org0a876e7">Testing <code>hspec</code></a></li>
<li><a href="#orgc6c1b3d">Testing <code>hspec</code> and <code>QuickCheck</code></a></li>
<li><a href="#org7afda29">Handy IO</a></li>
<li><a href="#org33637cf">Build tool stack</a></li>
<li><a href="#org3807824">Profiling criterion</a></li>
<li><a href="#orgb1e27e7">Documentation with <code>haddock</code></a></li>
<li><a href="#org223d3ab">Boring haskell and <code>rio</code></a></li>
<li><a href="#orgd433e27">Syntax</a></li>
<li><a href="#org9e9b9d2">Monad transformers with <code>mtl</code></a></li>
<li><a href="#org5a7f4df">Data structures</a></li>
<li><a href="#org4c36bc1"><code>ST</code> monad</a></li>
<li><a href="#orgdaaca94">Linting <code>hindent</code></a></li>
<li><a href="#org9eb552d">JSON with Aeson</a></li>
<li><a href="#orgf7c88b4">Haskell layer in Spacemacs</a></li>
<li><a href="#org2b010c6">GHC extensions</a></li>
<li><a href="#orgdfdec9a">GHC extensions: <code>DeriveX</code></a></li>
<li><a href="#orge2fbc3f">Packages I like</a></li>
</ul>
</li>
<li><a href="#org48998d7">Hackage</a>
<ul>
<li><a href="#org0754f39">Development shell</a></li>
<li><a href="#orgd15d8fc">Notes about uploading a package to hackage</a></li>
</ul>
</li>
<li><a href="#org5b0be74">Type theory and functional programming</a></li>
<li><a href="#orgd945df3">Haskell for science</a>
<ul>
<li><a href="#org5ac97e7">Optimisation</a></li>
<li><a href="#orgcb33cde">Root finding</a></li>
<li><a href="#orge93410e">Differential equations</a></li>
<li><a href="#org63e7575">Random number simulation</a></li>
<li><a href="#org330e47c">Numbers</a></li>
<li><a href="#orgcf47c91">Special functions</a></li>
</ul>
</li>
</ul>
</div>
</div>


<div id="org5a9151b" class="figure">
<p><img src="../images/haskell-logo.png" alt="haskell-logo.png" /> 
</p>
</div>

<div id="outline-container-orged7aa9e" class="outline-2">
<h2 id="orged7aa9e">Programming and developing in Haskell</h2>
<div class="outline-text-2" id="text-orged7aa9e">
<p>
<a href="../resources/haskell-cheat-sheet.pdf">HASKELL CHEAT SHEET</a>
</p>
</div>

<div id="outline-container-org8d171d9" class="outline-3">
<h3 id="org8d171d9">Further reading</h3>
<div class="outline-text-3" id="text-org8d171d9">
</div>
<div id="outline-container-orge1cecc0" class="outline-4">
<h4 id="orge1cecc0">Blog posts</h4>
<div class="outline-text-4" id="text-orge1cecc0">
<ul class="org-ul">
<li><a href="https://jelv.is/blog/Structure-your-Errors/">Structure your Errors</a> **</li>
<li><a href="https://kowainik.github.io/posts/haskell-mini-patterns">Haskell mini-patterns handbook</a> <b>*</b></li>
<li><a href="https://lexi-lambda.github.io/blog/2018/02/10/an-opinionated-guide-to-haskell-in-2018/">An opinionated guide to Haskell in 2018</a> **</li>
</ul>
</div>
</div>

<div id="outline-container-org9d5b78e" class="outline-4">
<h4 id="org9d5b78e">Blog posts I want to read</h4>
<div class="outline-text-4" id="text-org9d5b78e">
<ul class="org-ul">
<li><a href="https://markkarpov.com/post/existential-quantification.html">Existential quantification</a></li>
</ul>
</div>
</div>

<div id="outline-container-org304379d" class="outline-4">
<h4 id="org304379d">Documentation</h4>
<div class="outline-text-4" id="text-org304379d">
<ul class="org-ul">
<li><a href="https://www.haskell.org/definition/haskell2010.pdf">Haskell 2010 Language Report</a></li>
</ul>
</div>
</div>

<div id="outline-container-org357b98c" class="outline-4">
<h4 id="org357b98c">Books</h4>
<div class="outline-text-4" id="text-org357b98c">
<ul class="org-ul">
<li><a href="http://learnyouahaskell.com/chapters">Learn You a Haskell for Great Good!</a></li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org9dd57a2" class="outline-3">
<h3 id="org9dd57a2">CLI</h3>
<div class="outline-text-3" id="text-org9dd57a2">
<p>
The function <code>getArgs</code> from <code>System.Environment</code> in <code>base</code> is how you get
command line arguments. 
</p>

<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #268bd2; font-weight: bold;">import</span> <span style="color: #df005f; font-weight: bold;">System.Environment</span>

<span style="color: #d75fd7; font-weight: bold;">main</span> <span style="color: #8787d7;">=</span> <span style="color: #268bd2; font-weight: bold;">do</span>
  a <span style="color: #8787d7;">&lt;-</span> getArgs
  print a
  return <span style="color: #268bd2; font-weight: bold;">()</span>
</pre>
</div>

<p>
The following example demonstrates how you might get some data from a user at
the command line at run time rather than data about how the program was called.
</p>

<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #d75fd7; font-weight: bold;">main</span> <span style="color: #8787d7;">::</span> <span style="color: #df005f; font-weight: bold;">IO</span> <span style="color: #268bd2; font-weight: bold;">()</span>
<span style="color: #d75fd7; font-weight: bold;">main</span> <span style="color: #8787d7;">=</span> <span style="color: #268bd2; font-weight: bold;">do</span>
  putStrLn <span style="color: #2aa198;">"Do you want to continue? [y/n]"</span>
  response <span style="color: #8787d7;">&lt;-</span> getChar
  <span style="color: #268bd2; font-weight: bold;">if</span> response <span style="color: #8787d7;">==</span> <span style="color: #2aa198;">'n'</span>
    <span style="color: #268bd2; font-weight: bold;">then</span>
      <span style="color: #268bd2; font-weight: bold;">do</span>
        putStrLn <span style="color: #2aa198;">"\nmaybe next time :)"</span>
        return <span style="color: #268bd2; font-weight: bold;">()</span>
    <span style="color: #268bd2; font-weight: bold;">else</span>
      <span style="color: #268bd2; font-weight: bold;">if</span> response <span style="color: #8787d7;">/=</span> <span style="color: #2aa198;">'y'</span>
        <span style="color: #268bd2; font-weight: bold;">then</span>
          <span style="color: #268bd2; font-weight: bold;">do</span>
            putStrLn <span style="color: #2aa198;">"\n\nI doughnut understand..."</span>
            main
        <span style="color: #268bd2; font-weight: bold;">else</span>
          <span style="color: #268bd2; font-weight: bold;">do</span>
            putStrLn <span style="color: #2aa198;">"\nwoohoo!"</span>
            return <span style="color: #268bd2; font-weight: bold;">()</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org980bda2" class="outline-3">
<h3 id="org980bda2">Debugging</h3>
<div class="outline-text-3" id="text-org980bda2">
<ol class="org-ol">
<li>Load the relevant module: <code>λ&gt; :load &lt;module.hs&gt;</code></li>
<li>Set a break point: <code>λ&gt; :break &lt;n&gt;</code></li>
<li>Evaluate relevant expression</li>
</ol>

<p>
You can always use <code>:help</code> to get a listing, but here are some useful functions
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Command</th>
<th scope="col" class="org-left">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><code>:list</code></td>
<td class="org-left">See current line</td>
</tr>

<tr>
<td class="org-left"><code>:step</code></td>
<td class="org-left">Step to next line</td>
</tr>

<tr>
<td class="org-left"><code>:continue</code></td>
<td class="org-left">Run to next break</td>
</tr>

<tr>
<td class="org-left"><code>:show breaks</code></td>
<td class="org-left">Show break points</td>
</tr>

<tr>
<td class="org-left"><code>:delete &lt;n&gt;</code></td>
<td class="org-left">Delete break <code>n</code></td>
</tr>
</tbody>
</table>

<p>
The <code>trace</code> function provided by <code>Debug.Trace</code> from the standard library is a
good way to inspect the values of variables from pure code while debugging.
</p>

<p>
The GHC user guide has a section on <a href="https://downloads.haskell.org/~ghc/7.4.1/docs/html/users_guide/ghci-debugger.html">the GHCI debugger</a>.
</p>
</div>
</div>

<div id="outline-container-org0a876e7" class="outline-3">
<h3 id="org0a876e7">Testing <code>hspec</code></h3>
<div class="outline-text-3" id="text-org0a876e7">
<p>
Add <code>hspec</code> to your dependencies and observe the following example 
</p>

<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #268bd2; font-weight: bold;">import</span> <span style="color: #df005f; font-weight: bold;">Test.Hspec</span>
<span style="color: #268bd2; font-weight: bold;">import</span> <span style="color: #df005f; font-weight: bold;">Control.Exception</span> <span style="color: #268bd2;">(</span>evaluate<span style="color: #268bd2;">)</span>

<span style="color: #d75fd7; font-weight: bold;">main</span> <span style="color: #8787d7;">::</span> <span style="color: #df005f; font-weight: bold;">IO</span> <span style="color: #268bd2; font-weight: bold;">()</span>
<span style="color: #d75fd7; font-weight: bold;">main</span> <span style="color: #8787d7;">=</span> hspec <span style="color: #8787d7;">$</span> <span style="color: #268bd2; font-weight: bold;">do</span>
  describe <span style="color: #2aa198;">"Prelude.head"</span> <span style="color: #8787d7;">$</span> <span style="color: #268bd2; font-weight: bold;">do</span>
    it <span style="color: #2aa198;">"returns the first element of a list"</span> <span style="color: #8787d7;">$</span> <span style="color: #268bd2; font-weight: bold;">do</span>
      head <span style="color: #268bd2;">[</span><span style="color: #d75fd7;">23</span> <span style="color: #8787d7;">..</span><span style="color: #268bd2;">]</span> <span style="color: #8787d7;">`shouldBe`</span> <span style="color: #268bd2;">(</span><span style="color: #d75fd7;">23</span> <span style="color: #8787d7;">::</span> <span style="color: #df005f; font-weight: bold;">Int</span><span style="color: #268bd2;">)</span>

    it <span style="color: #2aa198;">"throws an exception if used with an empty list"</span> <span style="color: #8787d7;">$</span> <span style="color: #268bd2; font-weight: bold;">do</span>
      evaluate <span style="color: #268bd2;">(</span>head <span style="color: #d75fd7; font-weight: bold;">[]</span><span style="color: #268bd2;">)</span> <span style="color: #8787d7;">`shouldThrow`</span> anyException
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc6c1b3d" class="outline-3">
<h3 id="orgc6c1b3d">Testing <code>hspec</code> and <code>QuickCheck</code></h3>
<div class="outline-text-3" id="text-orgc6c1b3d">
<p>
You can use <a href="https://hspec.github.io/quickcheck.html">QuickCheck in your Hspec tests</a>
</p>

<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #d75fd7;">{-# LANGUAGE DeriveGeneric #-}</span>

<span style="color: #268bd2; font-weight: bold;">module</span> <span style="color: #df005f; font-weight: bold;">Main</span> <span style="color: #268bd2; font-weight: bold;">where</span>

<span style="color: #268bd2; font-weight: bold;">import</span> <span style="color: #df005f; font-weight: bold;">GHC.Generics</span>
<span style="color: #268bd2; font-weight: bold;">import</span> <span style="color: #df005f; font-weight: bold;">Generic.Random</span> <span style="color: #268bd2;">(</span>genericArbitraryU<span style="color: #268bd2;">)</span>
<span style="color: #268bd2; font-weight: bold;">import</span> <span style="color: #df005f; font-weight: bold;">Test.Hspec</span>
<span style="color: #268bd2; font-weight: bold;">import</span> <span style="color: #df005f; font-weight: bold;">Test.QuickCheck</span> <span style="color: #268bd2;">(</span><span style="color: #df005f; font-weight: bold;">Gen</span><span style="color: #d75fd7;">(</span><span style="color: #8787d7;">..</span><span style="color: #d75fd7;">)</span>, forAll, property, choose<span style="color: #268bd2;">)</span>

<span style="color: #268bd2; font-weight: bold;">data</span> <span style="color: #df005f; font-weight: bold;">RickMorty</span>
  <span style="color: #8787d7;">=</span> <span style="color: #df005f; font-weight: bold;">Fleeb</span>
  <span style="color: #8787d7;">|</span> <span style="color: #df005f; font-weight: bold;">Squanch</span>
  <span style="color: #8787d7;">|</span> <span style="color: #df005f; font-weight: bold;">Plumbus</span>
  <span style="color: #268bd2; font-weight: bold;">deriving</span> <span style="color: #268bd2;">(</span><span style="color: #df005f; font-weight: bold;">Show</span>, <span style="color: #df005f; font-weight: bold;">Generic</span>, <span style="color: #df005f; font-weight: bold;">Eq</span><span style="color: #268bd2;">)</span>

<span style="color: #d75fd7; font-weight: bold;">main</span> <span style="color: #8787d7;">::</span> <span style="color: #df005f; font-weight: bold;">IO</span> <span style="color: #268bd2; font-weight: bold;">()</span>
<span style="color: #d75fd7; font-weight: bold;">main</span> <span style="color: #8787d7;">=</span>
  hspec <span style="color: #8787d7;">$</span> <span style="color: #268bd2; font-weight: bold;">do</span>
    describe <span style="color: #2aa198;">"read"</span> <span style="color: #8787d7;">$</span> <span style="color: #268bd2; font-weight: bold;">do</span>
      it <span style="color: #2aa198;">"fooo"</span> <span style="color: #8787d7;">$</span> property <span style="color: #8787d7;">$</span> foo
      it <span style="color: #2aa198;">"baar"</span> <span style="color: #8787d7;">$</span> forAll <span style="color: #268bd2;">(</span>genericArbitraryU <span style="color: #8787d7;">::</span> <span style="color: #df005f; font-weight: bold;">Gen</span> <span style="color: #df005f; font-weight: bold;">RickMorty</span><span style="color: #268bd2;">)</span> bar
      it <span style="color: #2aa198;">"baaz"</span> <span style="color: #8787d7;">$</span> forAll <span style="color: #268bd2;">(</span>choose <span style="color: #d75fd7;">(</span><span style="color: #d75fd7;">1</span>, <span style="color: #d75fd7;">3</span><span style="color: #d75fd7;">)</span> <span style="color: #8787d7;">::</span> <span style="color: #df005f; font-weight: bold;">Gen</span> <span style="color: #df005f; font-weight: bold;">Int</span><span style="color: #268bd2;">)</span> foo

<span style="color: #d75fd7; font-weight: bold;">foo</span> <span style="color: #8787d7;">::</span> <span style="color: #df005f; font-weight: bold;">Int</span> <span style="color: #8787d7;">-&gt;</span> <span style="color: #df005f; font-weight: bold;">Bool</span>
<span style="color: #d75fd7; font-weight: bold;">foo</span> x <span style="color: #8787d7;">=</span> x <span style="color: #8787d7;">==</span> x

<span style="color: #d75fd7; font-weight: bold;">bar</span> <span style="color: #8787d7;">::</span> <span style="color: #df005f; font-weight: bold;">RickMorty</span> <span style="color: #8787d7;">-&gt;</span> <span style="color: #df005f; font-weight: bold;">Bool</span>
<span style="color: #d75fd7; font-weight: bold;">bar</span> x <span style="color: #8787d7;">=</span> x <span style="color: #8787d7;">==</span> x
</pre>
</div>

<p>
The simplest way to use QuickCheck is via the <code>property</code> function which just
takes a predicate based on some standard types. If you want to provide your own
generator you need to use the <code>forAll</code> function, but once this has happened you
are free to use a wider range of generators. In the example above we just sample
uniformly from our <code>RickMorty</code> type. This is further demonstrated by the example
with <code>choose</code> which will generate integers from \(1\) to \(3\) inclusive as test
cases.
</p>
</div>
</div>

<div id="outline-container-org7afda29" class="outline-3">
<h3 id="org7afda29">Handy IO</h3>
<div class="outline-text-3" id="text-org7afda29">
</div>
<div id="outline-container-org0081bde" class="outline-4">
<h4 id="org0081bde">Writing a list of values to CSV</h4>
<div class="outline-text-4" id="text-org0081bde">
<p>
The following assumes that the type <code>Foo</code> is an instance of <code>Csv.ToRecord</code> which
can often be derived.
</p>

<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #268bd2; font-weight: bold;">import</span> <span style="color: #268bd2; font-weight: bold;">qualified</span> <span style="color: #df005f; font-weight: bold;">Data.ByteString.Lazy</span> <span style="color: #268bd2; font-weight: bold;">as</span> <span style="color: #df005f; font-weight: bold;">L</span>
<span style="color: #268bd2; font-weight: bold;">import</span> <span style="color: #268bd2; font-weight: bold;">qualified</span> <span style="color: #df005f; font-weight: bold;">Data.Csv</span> <span style="color: #268bd2; font-weight: bold;">as</span> <span style="color: #df005f; font-weight: bold;">Csv</span>

L<span style="color: #d75fd7; font-weight: bold;">.</span>writeFile <span style="color: #2aa198;">"output.csv"</span> <span style="color: #268bd2;">(</span>Csv.encode <span style="color: #d75fd7;">(</span>foos <span style="color: #8787d7;">::</span> <span style="color: #2aa198;">[</span><span style="color: #df005f; font-weight: bold;">Foo</span><span style="color: #2aa198;">]</span><span style="color: #d75fd7;">)</span><span style="color: #268bd2;">)</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org33637cf" class="outline-3">
<h3 id="org33637cf">Build tool stack</h3>
<div class="outline-text-3" id="text-org33637cf">
</div>
<div id="outline-container-org1ae7cb6" class="outline-4">
<h4 id="org1ae7cb6">Installation, upgrading and uninstalling</h4>
<div class="outline-text-4" id="text-org1ae7cb6">
<p>
There is a script from <code>commercialhaskell</code> which installs <code>stack</code>
</p>

<div class="org-src-container">
<pre class="src src-sh">curl -sSL https://get.haskellstack.org/ | sh
</pre>
</div>

<p>
The executable is in <code>/usr/local/bin</code> by default. To upgrade <code>stack</code> there is
the <code>stack upgrade</code> command. To uninstall, remove the stack executable and
<code>~/.stack</code> and the <code>.stack-work</code> from any projects using <code>stack</code>.
</p>

<p>
<code>stack</code> installs to <code>/home/&lt;username&gt;/.local/bin</code> by default, so you should add
this to your path
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #268bd2;">export</span> <span style="color: #8787d7;">PATH</span>=/home/&lt;username&gt;/.local/bin:$<span style="color: #8787d7;">PATH</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfb70f2b" class="outline-4">
<h4 id="orgfb70f2b">Starting a new project</h4>
<div class="outline-text-4" id="text-orgfb70f2b">
<div class="org-src-container">
<pre class="src src-sh">stack new &lt;project-name&gt; &lt;template-name&gt;
<span style="color: #268bd2;">cd</span> my-project
stack setup
stack build
stack exec my-project-exe
</pre>
</div>

<p>
Here <code>&lt;project-name&gt;</code> is the name of the directory that will be created to house
the project and <code>&lt;template-name&gt;</code> is the template to use; I like the <code>simple</code>
template because it uses cabal directly and is free from clutter. If there is
only library code and no executables, then the <code>simple-library</code> might be a
cleaner choice. Packages get added to <code>package.yaml</code> under <code>dependencies:</code> and
you start the REPL with <code>stack ghci</code>. Projects are configured by the <code>.cabal</code>
file, for <code>simple</code> and <code>simple-library</code>. <code>stack</code> can use <code>hpack</code> to convert a
<code>package.yaml</code> file to a <code>.cabal</code> file.
</p>
</div>
</div>

<div id="outline-container-org3d9413c" class="outline-4">
<h4 id="org3d9413c">Starting a new project (with white chocolate macadamia)</h4>
<div class="outline-text-4" id="text-org3d9413c">
<p>
I wrote <code>white-chocolate-macadamia</code> which defines a minimalist project template.
It is hosted <a href="https://github.com/aezarebski/white-chocolate-macadamia">here</a>. To start a new project with it use the following command
</p>

<div class="org-src-container">
<pre class="src src-sh">stack new my-project https://raw.githubusercontent.com/aezarebski/white-chocolate-macadamia/main/macadamia.hsfiles
</pre>
</div>
</div>
</div>

<div id="outline-container-orgff3edd5" class="outline-4">
<h4 id="orgff3edd5">Commands</h4>
<div class="outline-text-4" id="text-orgff3edd5">
<p>
If you are ever unsure about some aspect of <code>stack</code>, appending <code>--help</code> is
usually pretty enlightening. There are few ways to initialise a project using
some standard templates.
</p>

<div class="org-src-container">
<pre class="src src-sh">stack new &lt;package-name&gt;
stack new &lt;package-name&gt; &lt;template-name&gt;        <span style="color: #008787; background-color: #262626;"># </span><span style="color: #008787; background-color: #262626;">Use a particular template</span>
stack new &lt;package-name&gt; --bare &lt;template-name&gt; <span style="color: #008787; background-color: #262626;"># </span><span style="color: #008787; background-color: #262626;">Without subdirectory</span>
</pre>
</div>

<p>
To build the targets described in the <code>.cabal</code> file there is <code>stack build</code>, but
unless you need GHC to optimise the executable, adding the <code>--fast</code> flag will
make it run faster. There is also the <code>--file-watch</code> flag which will cause it to
recompile each time that files are edited. There are many commands within
<code>stack</code> which are listed in the documentation. Run the executable with
</p>

<div class="org-src-container">
<pre class="src src-sh">stack exec -- &lt;target&gt; <span style="color: #268bd2;">[</span>arguments<span style="color: #268bd2;">]</span>
</pre>
</div>

<p>
To run the tests there is <code>stack test</code>. To build the documentation there is
<code>stack haddock</code> which if you only need the documentation of your dependencies,
you can speed up with <code>--haddock-deps</code>. Once you have the documentation build,
you can open the documentation for a particular package in the browser.
</p>

<div class="org-src-container">
<pre class="src src-sh">stack build --haddock-deps
stack haddock --open &lt;package&gt;
</pre>
</div>

<p>
To make the documentation searchable like the online version (though noticibly
more responsive) you can run a hoogle server. But first you must index the
documentation, and this will need to be done every time your dependencies
change.
</p>

<div class="org-src-container">
<pre class="src src-sh">stack hoogle -- generate --local 
stack hoogle -- server --local --port=<span style="color: #d75fd7;">8080</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgee26b95" class="outline-4">
<h4 id="orgee26b95">Building with nix</h4>
<div class="outline-text-4" id="text-orgee26b95">
<p>
When using stack and nix, the haskell dependencies are managed by stack and only
the non-haskell dependencies are managed by nix. You need nix installed on your
system for this to work, it will not be installed by stack. Adding the following
to your <code>stack.yaml</code> file will tell stack that you want to build your package in
a nix shell with these packages available.
</p>

<div class="org-src-container">
<pre class="src src-yaml"><span style="color: #008787; background-color: #262626;"># </span><span style="color: #008787; background-color: #262626;">stack.yaml</span>
<span style="color: #8787d7;">nix</span>:
  <span style="color: #8787d7;">enable</span>: <span style="color: #d75fd7;">true</span>
  <span style="color: #8787d7;">packages</span>: [glpk, pcre]
</pre>
</div>

<p>
You will need to double check that the resolver you have specified corresponds
to one of the GHC versions that are available in your nix channel. To find out
which versions of GHC are available to you, drop into a nix REPL with <code>nix repl</code>
and then load the available packages with <code>:l &lt;nixpkgs&gt;</code> then ask for a list of
the available compiler versions with <code>lib.attrNames haskell.compiler</code>.
</p>
</div>

<div id="outline-container-org6344d71" class="outline-5">
<h5 id="org6344d71">Further notes</h5>
<div class="outline-text-5" id="text-org6344d71">
<ul class="org-ul">
<li>use <code>cabal2nix</code> to convert a project's cabal file into a nix derivation. As a
result, every time the cabal file changes the nix derivation will need to be
regenerated.</li>
<li>The <code>nix-build</code> command is used to build a package and the <code>nix-shell</code> command
is used to enter a shell configured for development of the package. You'll one
nix file for your overall package which imports the one that was generated by
<code>cabal2nix</code>.</li>
<li>Despite being able to use nix to build your haskell project, Gabriel
recommends sticking with cabal and just using nix to provision the development
environment.</li>
</ul>
</div>
</div>
</div>
</div>

<div id="outline-container-org3807824" class="outline-3">
<h3 id="org3807824">Profiling criterion</h3>
<div class="outline-text-3" id="text-org3807824">
<p>
Criterion is <i>the</i> tools for profiling code. You build an application with
<code>defaultMain</code> which sets up the benchmarks with a CLI. The <code>defaultMain</code> expects
a <code>[Benchmark]</code>, you group multiple benchmarks with <code>bgroup</code>, you create
<code>Benchmark</code> objects with <code>bench</code>.
</p>

<p>
If you want to use some pre-computed environment variables in a benchmark, you
need the <code>env</code> function to manage this. The following snippet demonstrates how
to do this, generating some random variables once, and then passing them into a
function.
</p>

<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #268bd2; font-weight: bold;">module</span> <span style="color: #df005f; font-weight: bold;">Main</span> <span style="color: #268bd2; font-weight: bold;">where</span>

<span style="color: #268bd2; font-weight: bold;">import</span> <span style="color: #df005f; font-weight: bold;">Control.Monad</span>
<span style="color: #268bd2; font-weight: bold;">import</span> <span style="color: #df005f; font-weight: bold;">Criterion.Main</span>
<span style="color: #268bd2; font-weight: bold;">import</span> <span style="color: #268bd2; font-weight: bold;">qualified</span> <span style="color: #df005f; font-weight: bold;">Data.Vector</span> <span style="color: #268bd2; font-weight: bold;">as</span> <span style="color: #df005f; font-weight: bold;">V</span>
<span style="color: #268bd2; font-weight: bold;">import</span> <span style="color: #df005f; font-weight: bold;">Statistics.Sample</span>
<span style="color: #268bd2; font-weight: bold;">import</span> <span style="color: #268bd2; font-weight: bold;">qualified</span> <span style="color: #df005f; font-weight: bold;">System.Random.MWC</span> <span style="color: #268bd2; font-weight: bold;">as</span> <span style="color: #df005f; font-weight: bold;">MWC</span>

<span style="color: #d75fd7; font-weight: bold;">sampleMeanBench</span> <span style="color: #8787d7;">::</span> <span style="color: #df005f; font-weight: bold;">String</span> <span style="color: #8787d7;">-&gt;</span> <span style="color: #268bd2;">[</span><span style="color: #df005f; font-weight: bold;">Double</span><span style="color: #268bd2;">]</span> <span style="color: #8787d7;">-&gt;</span> <span style="color: #df005f; font-weight: bold;">Benchmark</span>
<span style="color: #d75fd7; font-weight: bold;">sampleMeanBench</span> name xs <span style="color: #8787d7;">=</span> bench name <span style="color: #8787d7;">$</span> nf <span style="color: #268bd2;">(</span>mean <span style="color: #8787d7;">.</span> V.fromList<span style="color: #268bd2;">)</span> xs

<span style="color: #d75fd7; font-weight: bold;">getRandomList</span> <span style="color: #8787d7;">::</span> <span style="color: #df005f; font-weight: bold;">Int</span> <span style="color: #8787d7;">-&gt;</span> <span style="color: #df005f; font-weight: bold;">IO</span> <span style="color: #268bd2;">[</span><span style="color: #df005f; font-weight: bold;">Double</span><span style="color: #268bd2;">]</span>
<span style="color: #d75fd7; font-weight: bold;">getRandomList</span> n <span style="color: #8787d7;">=</span> <span style="color: #268bd2; font-weight: bold;">do</span>
  gen <span style="color: #8787d7;">&lt;-</span> MWC.create
  foo <span style="color: #8787d7;">&lt;-</span> replicateM n <span style="color: #268bd2;">(</span>MWC.uniform gen<span style="color: #268bd2;">)</span>
  return foo

<span style="color: #008787; background-color: #262626;">-- </span><span style="color: #008787; background-color: #262626;">Our benchmark harness.</span>
<span style="color: #d75fd7; font-weight: bold;">main</span> <span style="color: #8787d7;">=</span>
  defaultMain
    <span style="color: #268bd2;">[</span> bgroup
        <span style="color: #2aa198;">"meanPure"</span>
        <span style="color: #d75fd7;">[</span> sampleMeanBench <span style="color: #2aa198;">"small"</span> <span style="color: #2aa198;">[</span><span style="color: #d75fd7;">1</span> <span style="color: #8787d7;">..</span> <span style="color: #d75fd7;">10</span><span style="color: #2aa198;">]</span>
        , sampleMeanBench <span style="color: #2aa198;">"medium"</span> <span style="color: #2aa198;">[</span><span style="color: #d75fd7;">1</span> <span style="color: #8787d7;">..</span> <span style="color: #d75fd7;">100</span><span style="color: #2aa198;">]</span>
        , sampleMeanBench <span style="color: #2aa198;">"large"</span> <span style="color: #2aa198;">[</span><span style="color: #d75fd7;">1</span> <span style="color: #8787d7;">..</span> <span style="color: #d75fd7;">1000</span><span style="color: #2aa198;">]</span>
        <span style="color: #d75fd7;">]</span>
    , bgroup
        <span style="color: #2aa198;">"meanEnv"</span>
        <span style="color: #d75fd7;">[</span> env <span style="color: #2aa198;">(</span>getRandomList <span style="color: #d75fd7;">10</span><span style="color: #2aa198;">)</span> <span style="color: #2aa198;">(</span><span style="color: #8787d7;">\</span>xs <span style="color: #8787d7;">-&gt;</span> sampleMeanBench <span style="color: #2aa198;">"small"</span> xs<span style="color: #2aa198;">)</span>
        , env <span style="color: #2aa198;">(</span>getRandomList <span style="color: #d75fd7;">100</span><span style="color: #2aa198;">)</span> <span style="color: #2aa198;">(</span><span style="color: #8787d7;">\</span>xs <span style="color: #8787d7;">-&gt;</span> sampleMeanBench <span style="color: #2aa198;">"medium"</span> xs<span style="color: #2aa198;">)</span>
        , env <span style="color: #2aa198;">(</span>getRandomList <span style="color: #d75fd7;">1000</span><span style="color: #2aa198;">)</span> <span style="color: #2aa198;">(</span><span style="color: #8787d7;">\</span>xs <span style="color: #8787d7;">-&gt;</span> sampleMeanBench <span style="color: #2aa198;">"large"</span> xs<span style="color: #2aa198;">)</span>
        <span style="color: #d75fd7;">]</span>
    <span style="color: #268bd2;">]</span>
</pre>
</div>

<p>
This could be run with the following to get a HTML report as output.
</p>

<pre class="example">
$ stack exec -- criterion-demo --output report.html
</pre>

<p>
Note that in the linear regression results reported, this considers the
relationship between the number of evaluations and the time that required.
</p>
</div>
</div>

<div id="outline-container-orgb1e27e7" class="outline-3">
<h3 id="orgb1e27e7">Documentation with <code>haddock</code></h3>
<div class="outline-text-3" id="text-orgb1e27e7">
</div>
<div id="outline-container-org90de28a" class="outline-4">
<h4 id="org90de28a">Markup</h4>
<div class="outline-text-4" id="text-org90de28a">
<p>
<a href="https://haskell-haddock.readthedocs.io/en/latest/markup.html#markup">Markup documentation</a>
</p>

<ul class="org-ul">
<li><code>/italics/</code></li>
<li><code>__bold__</code></li>
<li><code>'hyperlink'</code></li>
<li><code>@monospace@</code></li>
<li><code>![image description](pathtoimage.png)</code></li>
<li><code>[some link](http://example.com)</code></li>
</ul>

<blockquote>
<p>
Haddock supports LaTeX syntax for rendering mathematical notation. The
delimiters are \[...\] for displayed mathematics and \(...\) for in-line
mathematics.
</p>
</blockquote>
</div>
</div>

<div id="outline-container-orgbb7adbb" class="outline-4">
<h4 id="orgbb7adbb">Functions</h4>
<div class="outline-text-4" id="text-orgbb7adbb">
<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #af875f;">-- | Two examples are given below:</span>
<span style="color: #af875f;">--</span>
<span style="color: #af875f;">-- &gt;&gt;&gt; fib 10</span>
<span style="color: #af875f;">-- 55</span>
<span style="color: #af875f;">--</span>
<span style="color: #af875f;">-- &gt;&gt;&gt; putStrLn "foo\nbar"</span>
<span style="color: #af875f;">-- foo</span>
<span style="color: #af875f;">-- bar</span>
<span style="color: #d75fd7; font-weight: bold;">f</span>  <span style="color: #8787d7;">::</span> <span style="color: #df005f; font-weight: bold;">Int</span>      <span style="color: #af875f;">-- ^ The 'Int' argument</span>
   <span style="color: #8787d7;">-&gt;</span> <span style="color: #df005f; font-weight: bold;">Float</span>    <span style="color: #af875f;">-- ^ The 'Float' argument</span>
   <span style="color: #8787d7;">-&gt;</span> <span style="color: #df005f; font-weight: bold;">IO</span> <span style="color: #268bd2; font-weight: bold;">()</span>    <span style="color: #af875f;">-- ^ The return value</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org7e3f750" class="outline-4">
<h4 id="org7e3f750">Data</h4>
<div class="outline-text-4" id="text-org7e3f750">
<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #268bd2; font-weight: bold;">data</span> <span style="color: #df005f; font-weight: bold;">T</span> a b
  <span style="color: #af875f;">-- | This is the documentation for the 'C1' constructor</span>
  <span style="color: #8787d7;">=</span> <span style="color: #df005f; font-weight: bold;">C1</span> a b
  <span style="color: #af875f;">-- | This is the documentation for the 'C2' constructor</span>
  <span style="color: #8787d7;">|</span> <span style="color: #df005f; font-weight: bold;">C2</span> a b
</pre>
</div>
</div>
</div>

<div id="outline-container-org82c6263" class="outline-4">
<h4 id="org82c6263">Records</h4>
<div class="outline-text-4" id="text-org82c6263">
<p>
Sometimes <code>hindent</code> will reformat record definitions in a way that does not
appear to be compatible with <code>haddock</code>.
</p>

<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #268bd2; font-weight: bold;">data</span> <span style="color: #df005f; font-weight: bold;">R</span> a b <span style="color: #8787d7;">=</span>
  <span style="color: #df005f; font-weight: bold;">C</span> <span style="color: #268bd2;">{</span> <span style="color: #af875f;">-- | This is the documentation for the 'a' field</span>
      a <span style="color: #8787d7;">::</span> a,
      <span style="color: #af875f;">-- | This is the documentation for the 'b' field</span>
      b <span style="color: #8787d7;">::</span> b
    <span style="color: #268bd2;">}</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org8998870" class="outline-4">
<h4 id="org8998870">Usage</h4>
<div class="outline-text-4" id="text-org8998870">
<p>
Build and open the documentation in the browser. This does not seem to work well
from <code>eshell</code> but works fine from a bash shell.
</p>

<div class="org-src-container">
<pre class="src src-sh">stack haddock
stack haddock --open
</pre>
</div>

<p>
But a much quicker way to is to not build the documentation for the dependencies
by using the following command instead.
</p>

<div class="org-src-container">
<pre class="src src-sh">stack haddock --no-haddock-deps --open
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org223d3ab" class="outline-3">
<h3 id="org223d3ab">Boring haskell and <code>rio</code></h3>
<div class="outline-text-3" id="text-org223d3ab">
<p>
The documentation for the <code>rio</code> package gives an opinionated view which features
of haskell are mature and useful enough to warant inclusion in production code.
The <code>rio</code> package itself is intended as a safe and sufficient Prelude
replacement. The authors suggest the following lists of language extensions and
compiler flags are fine to use if they are helpful.
</p>
</div>

<div id="outline-container-org5d1259a" class="outline-4">
<h4 id="org5d1259a">Language extensions</h4>
<div class="outline-text-4" id="text-org5d1259a">
<pre class="example">
AutoDeriveTypeable
BangPatterns
BinaryLiterals
ConstraintKinds
DataKinds
DefaultSignatures
DeriveDataTypeable
DeriveFoldable
DeriveFunctor
DeriveGeneric
DeriveTraversable
DoAndIfThenElse
EmptyDataDecls
ExistentialQuantification
FlexibleContexts
FlexibleInstances
FunctionalDependencies
GADTs
GeneralizedNewtypeDeriving
InstanceSigs
KindSignatures
LambdaCase
MonadFailDesugaring
MultiParamTypeClasses
MultiWayIf
NamedFieldPuns
NoImplicitPrelude
OverloadedStrings
PartialTypeSignatures
PatternGuards
PolyKinds
RankNTypes
RecordWildCards
ScopedTypeVariables
StandaloneDeriving
TupleSections
TypeFamilies
TypeSynonymInstances
ViewPatterns 
</pre>
</div>
</div>

<div id="outline-container-org9f73555" class="outline-4">
<h4 id="org9f73555">Compiler flags</h4>
<div class="outline-text-4" id="text-org9f73555">
<pre class="example">
-Wall
-Wcompat
-Widentities
-Wincomplete-record-updates
-Wincomplete-uni-patterns
-Wpartial-fields
-Wredundant-constraints
</pre>

<p>
and <code>-Werror</code> for production.
</p>
</div>
</div>
</div>

<div id="outline-container-orgd433e27" class="outline-3">
<h3 id="orgd433e27">Syntax</h3>
<div class="outline-text-3" id="text-orgd433e27">
</div>
<div id="outline-container-orgae36227" class="outline-4">
<h4 id="orgae36227">Function syntax</h4>
<div class="outline-text-4" id="text-orgae36227">
<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #af875f;">-- |wild card</span>
<span style="color: #d75fd7; font-weight: bold;">f</span> <span style="color: #268bd2;">(</span><span style="color: #268bd2; font-weight: bold;">_</span><span style="color: #df005f; font-weight: bold;">:</span>xs<span style="color: #268bd2;">)</span> <span style="color: #8787d7;">=</span> xs

<span style="color: #af875f;">-- |as-pattern</span>
<span style="color: #d75fd7; font-weight: bold;">f</span> l<span style="color: #8787d7;">@</span><span style="color: #268bd2;">(</span>x<span style="color: #df005f; font-weight: bold;">:</span>xs<span style="color: #268bd2;">)</span> <span style="color: #8787d7;">=</span> x<span style="color: #df005f; font-weight: bold;">:</span>l

<span style="color: #af875f;">-- |guards</span>
<span style="color: #d75fd7; font-weight: bold;">f</span> x
  <span style="color: #8787d7;">|</span> x <span style="color: #8787d7;">&lt;</span> <span style="color: #d75fd7;">0</span>     <span style="color: #8787d7;">=</span> <span style="color: #d75fd7;">0</span>
  <span style="color: #8787d7;">|</span> x <span style="color: #8787d7;">&gt;=</span> <span style="color: #d75fd7;">0</span>    <span style="color: #8787d7;">=</span> <span style="color: #d75fd7;">1</span>
  <span style="color: #8787d7;">|</span> otherwise <span style="color: #8787d7;">=</span> undefined

<span style="color: #af875f;">-- |case expression</span>
<span style="color: #d75fd7; font-weight: bold;">f</span> x <span style="color: #8787d7;">=</span> <span style="color: #268bd2; font-weight: bold;">case</span> x <span style="color: #268bd2; font-weight: bold;">of</span>
  pattern1 <span style="color: #8787d7;">-&gt;</span> expression1
  pattern2 <span style="color: #8787d7;">-&gt;</span> expression2
  <span style="color: #268bd2; font-weight: bold;">_</span>        <span style="color: #8787d7;">-&gt;</span> undefined

<span style="color: #af875f;">-- |where clause</span>
<span style="color: #d75fd7; font-weight: bold;">f</span> x <span style="color: #8787d7;">=</span> g z
  <span style="color: #268bd2; font-weight: bold;">where</span>
    z <span style="color: #8787d7;">=</span> epxression

<span style="color: #af875f;">-- |let expression</span>
<span style="color: #d75fd7; font-weight: bold;">f</span> x <span style="color: #8787d7;">=</span> <span style="color: #268bd2; font-weight: bold;">let</span> z <span style="color: #8787d7;">=</span> expression
      <span style="color: #268bd2; font-weight: bold;">in</span> g z
</pre>
</div>

<p>
The <code>RecordWildcards</code> extension provides some additional sugar for pattern
working with records.
</p>
</div>
</div>

<div id="outline-container-orge23d639" class="outline-4">
<h4 id="orge23d639">Types syntax</h4>
<div class="outline-text-4" id="text-orge23d639">
<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #268bd2; font-weight: bold;">data</span> <span style="color: #df005f; font-weight: bold;">Person</span> <span style="color: #8787d7;">=</span> <span style="color: #df005f; font-weight: bold;">Person</span> <span style="color: #268bd2;">{</span> personFirstName <span style="color: #8787d7;">::</span> <span style="color: #df005f; font-weight: bold;">String</span>  
                     , personLastName <span style="color: #8787d7;">::</span> <span style="color: #df005f; font-weight: bold;">String</span>  
                     , personAge <span style="color: #8787d7;">::</span> <span style="color: #df005f; font-weight: bold;">Int</span>  
                     <span style="color: #268bd2;">}</span> <span style="color: #268bd2; font-weight: bold;">deriving</span> <span style="color: #268bd2;">(</span><span style="color: #df005f; font-weight: bold;">Show</span>, <span style="color: #df005f; font-weight: bold;">Eq</span><span style="color: #268bd2;">)</span>
</pre>
</div>

<p>
It is considered decent to prefix the attributes with something that is unique
to the record type to avoid name clashes.
</p>
</div>
</div>

<div id="outline-container-orgd7708f7" class="outline-4">
<h4 id="orgd7708f7">List comprehensions</h4>
<div class="outline-text-4" id="text-orgd7708f7">
<p>
List comprehensions are a nice way to combine a map and a filter.
</p>

<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #268bd2;">[</span>sqrt x <span style="color: #8787d7;">|</span> x <span style="color: #8787d7;">&lt;-</span> <span style="color: #d75fd7;">[</span><span style="color: #d75fd7;">1</span><span style="color: #8787d7;">..</span><span style="color: #d75fd7;">9</span><span style="color: #d75fd7;">]</span>, x <span style="color: #8787d7;">&gt;</span> <span style="color: #d75fd7;">3</span><span style="color: #268bd2;">]</span>
</pre>
</div>

<p>
You can use pattern matching to filter in a list comprehension as the following
example demonstrates
</p>

<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #268bd2; font-weight: bold;">data</span> <span style="color: #df005f; font-weight: bold;">Foobar</span> <span style="color: #8787d7;">=</span> <span style="color: #df005f; font-weight: bold;">Foo</span> <span style="color: #df005f; font-weight: bold;">Int</span> <span style="color: #8787d7;">|</span> <span style="color: #df005f; font-weight: bold;">Bar</span> <span style="color: #df005f; font-weight: bold;">Char</span> <span style="color: #268bd2; font-weight: bold;">deriving</span> <span style="color: #268bd2;">(</span><span style="color: #df005f; font-weight: bold;">Show</span><span style="color: #268bd2;">)</span>
<span style="color: #d75fd7; font-weight: bold;">x</span> <span style="color: #8787d7;">=</span> <span style="color: #268bd2;">[</span><span style="color: #df005f; font-weight: bold;">Foo</span> <span style="color: #d75fd7;">1</span>, <span style="color: #df005f; font-weight: bold;">Bar</span> <span style="color: #2aa198;">'a'</span>, <span style="color: #df005f; font-weight: bold;">Foo</span> <span style="color: #d75fd7;">2</span>, <span style="color: #df005f; font-weight: bold;">Bar</span> <span style="color: #2aa198;">'b'</span><span style="color: #268bd2;">]</span>
<span style="color: #d75fd7; font-weight: bold;">y</span> <span style="color: #8787d7;">=</span> <span style="color: #268bd2;">[</span>n <span style="color: #8787d7;">|</span> <span style="color: #d75fd7;">(</span><span style="color: #df005f; font-weight: bold;">Foo</span> n<span style="color: #d75fd7;">)</span> <span style="color: #8787d7;">&lt;-</span> x<span style="color: #268bd2;">]</span>
</pre>
</div>

<p>
The variable <code>y</code> has the value <code>[1,2]</code>.
</p>
</div>
</div>

<div id="outline-container-org92f7b6d" class="outline-4">
<h4 id="org92f7b6d">Variable names</h4>
<div class="outline-text-4" id="text-org92f7b6d">
<p>
<a href="https://www.haskell.org/onlinereport/"><i>The Haskell 98 Report</i></a> says 
</p>

<blockquote>
<p>
Underscore, "_", is treated as a lower-case letter, and can occur
wherever a lower-case letter can. However, "_" all by itself is a
reserved identifier, used as wild card in patterns. Compilers that offer
warnings for unused identifiers are encouraged to suppress such warnings for
identifiers beginning with underscore. This allows programmers to use
"_foo" for a parameter that they expect to be unused.
</p>
</blockquote>
</div>
</div>

<div id="outline-container-orgdea4dee" class="outline-4">
<h4 id="orgdea4dee">Typeclasses</h4>
<div class="outline-text-4" id="text-orgdea4dee">
<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #268bd2; font-weight: bold;">class</span> <span style="color: #df005f; font-weight: bold;">Eq</span> a <span style="color: #268bd2; font-weight: bold;">where</span>  
    <span style="color: #268bd2;">(</span><span style="color: #8787d7;">==</span><span style="color: #268bd2;">)</span> <span style="color: #8787d7;">::</span> a <span style="color: #8787d7;">-&gt;</span> a <span style="color: #8787d7;">-&gt;</span> <span style="color: #df005f; font-weight: bold;">Bool</span>  
    <span style="color: #268bd2;">(</span><span style="color: #8787d7;">/=</span><span style="color: #268bd2;">)</span> <span style="color: #8787d7;">::</span> a <span style="color: #8787d7;">-&gt;</span> a <span style="color: #8787d7;">-&gt;</span> <span style="color: #df005f; font-weight: bold;">Bool</span>  
    x <span style="color: #8787d7;">==</span> y <span style="color: #8787d7;">=</span> not <span style="color: #268bd2;">(</span>x <span style="color: #8787d7;">/=</span> y<span style="color: #268bd2;">)</span>  
    x <span style="color: #8787d7;">/=</span> y <span style="color: #8787d7;">=</span> not <span style="color: #268bd2;">(</span>x <span style="color: #8787d7;">==</span> y<span style="color: #268bd2;">)</span>  

<span style="color: #268bd2; font-weight: bold;">data</span> <span style="color: #df005f; font-weight: bold;">Foobar</span> <span style="color: #8787d7;">=</span> <span style="color: #df005f; font-weight: bold;">Foo</span> <span style="color: #8787d7;">|</span> <span style="color: #df005f; font-weight: bold;">Bar</span>

<span style="color: #268bd2; font-weight: bold;">instance</span> <span style="color: #df005f; font-weight: bold;">Eq</span> <span style="color: #df005f; font-weight: bold;">Foobar</span> <span style="color: #268bd2; font-weight: bold;">where</span>
    <span style="color: #df005f; font-weight: bold;">Foo</span> <span style="color: #8787d7;">==</span> <span style="color: #df005f; font-weight: bold;">Foo</span> <span style="color: #8787d7;">=</span> <span style="color: #df005f; font-weight: bold;">True</span>
    <span style="color: #df005f; font-weight: bold;">Bar</span> <span style="color: #8787d7;">==</span> <span style="color: #df005f; font-weight: bold;">Bar</span> <span style="color: #8787d7;">=</span> <span style="color: #df005f; font-weight: bold;">True</span>
    <span style="color: #268bd2; font-weight: bold;">_</span> <span style="color: #8787d7;">==</span> <span style="color: #268bd2; font-weight: bold;">_</span> <span style="color: #8787d7;">=</span> <span style="color: #df005f; font-weight: bold;">False</span>
</pre>
</div>

<p>
There are cases where a class will have multiple type parameters, e.g. <code>a</code>, <code>b</code>,
and <code>c</code>, but one of them may be determined by the others, <code>c</code> is determined by
<code>a</code> and <code>b</code>. One way to resolve this is by adding type annotations, but this is
unpleasant. <i>Functional dependencies</i> are a way to tell the compiler that <code>c</code> is
determined by <code>a</code> and <code>b</code>. The following snippet gives an example of the syntax
(a vertical bar, <code>|</code>) used to acheive this
</p>

<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #268bd2; font-weight: bold;">class</span> <span style="color: #df005f; font-weight: bold;">Foo</span> a b c <span style="color: #8787d7;">|</span> a b <span style="color: #8787d7;">-&gt;</span> c <span style="color: #268bd2; font-weight: bold;">where</span> <span style="color: #8787d7;">...</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org9e9b9d2" class="outline-3">
<h3 id="org9e9b9d2">Monad transformers with <code>mtl</code></h3>
<div class="outline-text-3" id="text-org9e9b9d2">
</div>
<div id="outline-container-org4152fde" class="outline-4">
<h4 id="org4152fde"><code>ReaderT</code></h4>
<div class="outline-text-4" id="text-org4152fde">
<p>
To avoid explicitly passing environment data around, one can use the <code>ReaderT</code>
monad transformer to add read-only environment. The following example shows the
reader monad transformer in action. 
</p>

<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #268bd2; font-weight: bold;">import</span> <span style="color: #df005f; font-weight: bold;">Control.Monad.Reader</span> <span style="color: #268bd2;">(</span><span style="color: #df005f; font-weight: bold;">ReaderT</span>, ask, liftIO, runReaderT<span style="color: #268bd2;">)</span>

<span style="color: #268bd2; font-weight: bold;">data</span> <span style="color: #df005f; font-weight: bold;">Env</span> <span style="color: #8787d7;">=</span> <span style="color: #df005f; font-weight: bold;">Env</span> <span style="color: #268bd2;">{</span> envInput <span style="color: #8787d7;">::</span> <span style="color: #df005f; font-weight: bold;">FilePath</span> <span style="color: #268bd2;">}</span>

<span style="color: #d75fd7; font-weight: bold;">step1</span> <span style="color: #8787d7;">::</span> <span style="color: #df005f; font-weight: bold;">ReaderT</span> <span style="color: #df005f; font-weight: bold;">Env</span> <span style="color: #df005f; font-weight: bold;">IO</span> <span style="color: #df005f; font-weight: bold;">Int</span>
<span style="color: #d75fd7; font-weight: bold;">step1</span> <span style="color: #8787d7;">=</span> <span style="color: #268bd2; font-weight: bold;">do</span>
  liftIO <span style="color: #8787d7;">$</span> putStrLn <span style="color: #2aa198;">"Greetings from Step 1."</span>
  return <span style="color: #d75fd7;">0</span>

<span style="color: #d75fd7; font-weight: bold;">step2</span> <span style="color: #8787d7;">::</span> <span style="color: #df005f; font-weight: bold;">Int</span> <span style="color: #8787d7;">-&gt;</span> <span style="color: #df005f; font-weight: bold;">ReaderT</span> <span style="color: #df005f; font-weight: bold;">Env</span> <span style="color: #df005f; font-weight: bold;">IO</span> <span style="color: #268bd2; font-weight: bold;">()</span>
<span style="color: #d75fd7; font-weight: bold;">step2</span> n <span style="color: #8787d7;">=</span> <span style="color: #268bd2; font-weight: bold;">do</span>
  liftIO <span style="color: #8787d7;">$</span> putStrLn <span style="color: #268bd2;">(</span>show n<span style="color: #268bd2;">)</span>
  fp <span style="color: #8787d7;">&lt;-</span> envInput <span style="color: #8787d7;">&lt;$&gt;</span> ask
  line <span style="color: #8787d7;">&lt;-</span> liftIO <span style="color: #8787d7;">$</span> readFile fp
  liftIO <span style="color: #8787d7;">$</span> putStr <span style="color: #268bd2;">(</span><span style="color: #2aa198;">"Autobots, "</span> <span style="color: #8787d7;">++</span> line<span style="color: #268bd2;">)</span>

<span style="color: #d75fd7; font-weight: bold;">main</span> <span style="color: #8787d7;">::</span> <span style="color: #df005f; font-weight: bold;">IO</span> <span style="color: #268bd2; font-weight: bold;">()</span>
<span style="color: #d75fd7; font-weight: bold;">main</span> <span style="color: #8787d7;">=</span> <span style="color: #268bd2; font-weight: bold;">do</span>
  runReaderT <span style="color: #268bd2;">(</span>step1 <span style="color: #8787d7;">&gt;&gt;=</span> step2<span style="color: #268bd2;">)</span> <span style="color: #268bd2;">(</span><span style="color: #df005f; font-weight: bold;">Env</span> <span style="color: #2aa198;">"autobots.txt"</span><span style="color: #268bd2;">)</span>
</pre>
</div>

<p>
The <code>main</code> function sets up an environment which is passes to Step 1 which puts
a value of 0 in the monad. Then in the second function the value is printed and
the contents of the file referenced in the environment is printed out, i.e., the
file <code>autobots.txt</code> which just contains a single line with "roll out". Running
this in the REPL gives the following output.
</p>

<pre class="example">
λ&gt; main
Greetings from Step 1.
0
Autobots, roll out
</pre>
</div>
</div>

<div id="outline-container-org0dad7da" class="outline-4">
<h4 id="org0dad7da"><code>ReaderT</code> on <code>ExceptT</code></h4>
<div class="outline-text-4" id="text-org0dad7da">
<p>
The example above using the reader monad transformer can be extended to improve
the error handling in the case where the file path in the environment does not
exist.
</p>

<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #268bd2; font-weight: bold;">import</span> <span style="color: #df005f; font-weight: bold;">Control.Monad.Except</span> <span style="color: #268bd2;">(</span><span style="color: #df005f; font-weight: bold;">ExceptT</span>, runExceptT, throwError<span style="color: #268bd2;">)</span>
<span style="color: #268bd2; font-weight: bold;">import</span> <span style="color: #df005f; font-weight: bold;">Control.Monad.Reader</span> <span style="color: #268bd2;">(</span><span style="color: #df005f; font-weight: bold;">ReaderT</span>, asks, liftIO, runReaderT<span style="color: #268bd2;">)</span>
<span style="color: #268bd2; font-weight: bold;">import</span> <span style="color: #df005f; font-weight: bold;">System.Directory</span> <span style="color: #268bd2;">(</span>doesFileExist<span style="color: #268bd2;">)</span>

<span style="color: #268bd2; font-weight: bold;">newtype</span> <span style="color: #df005f; font-weight: bold;">Env</span> <span style="color: #8787d7;">=</span> <span style="color: #df005f; font-weight: bold;">Env</span> <span style="color: #268bd2;">{</span> envInput <span style="color: #8787d7;">::</span> <span style="color: #df005f; font-weight: bold;">FilePath</span> <span style="color: #268bd2;">}</span>

<span style="color: #268bd2; font-weight: bold;">type</span> <span style="color: #df005f; font-weight: bold;">Robot</span> a <span style="color: #8787d7;">=</span> <span style="color: #df005f; font-weight: bold;">ReaderT</span> <span style="color: #df005f; font-weight: bold;">Env</span> <span style="color: #268bd2;">(</span><span style="color: #df005f; font-weight: bold;">ExceptT</span> <span style="color: #df005f; font-weight: bold;">String</span> <span style="color: #df005f; font-weight: bold;">IO</span><span style="color: #268bd2;">)</span> a

<span style="color: #d75fd7; font-weight: bold;">runRobot</span> <span style="color: #8787d7;">::</span> <span style="color: #df005f; font-weight: bold;">Robot</span> a <span style="color: #8787d7;">-&gt;</span> <span style="color: #df005f; font-weight: bold;">Env</span> <span style="color: #8787d7;">-&gt;</span> <span style="color: #df005f; font-weight: bold;">IO</span> <span style="color: #268bd2;">(</span><span style="color: #df005f; font-weight: bold;">Either</span> <span style="color: #df005f; font-weight: bold;">String</span> a<span style="color: #268bd2;">)</span>
<span style="color: #d75fd7; font-weight: bold;">runRobot</span> robot env <span style="color: #8787d7;">=</span> runExceptT <span style="color: #268bd2;">(</span>runReaderT robot env<span style="color: #268bd2;">)</span>

<span style="color: #d75fd7; font-weight: bold;">step1</span> <span style="color: #8787d7;">::</span> <span style="color: #df005f; font-weight: bold;">Robot</span> <span style="color: #df005f; font-weight: bold;">Int</span>
<span style="color: #d75fd7; font-weight: bold;">step1</span> <span style="color: #8787d7;">=</span> <span style="color: #268bd2; font-weight: bold;">do</span>
  liftIO <span style="color: #8787d7;">$</span> putStrLn <span style="color: #2aa198;">"Greetings from Step 1."</span>
  return <span style="color: #d75fd7;">0</span>

<span style="color: #d75fd7; font-weight: bold;">step2</span> <span style="color: #8787d7;">::</span> <span style="color: #df005f; font-weight: bold;">Int</span> <span style="color: #8787d7;">-&gt;</span> <span style="color: #df005f; font-weight: bold;">Robot</span> <span style="color: #268bd2; font-weight: bold;">()</span>
<span style="color: #d75fd7; font-weight: bold;">step2</span> n <span style="color: #8787d7;">=</span> <span style="color: #268bd2; font-weight: bold;">do</span>
  liftIO <span style="color: #8787d7;">$</span> print n
  fp <span style="color: #8787d7;">&lt;-</span> asks envInput
  exists <span style="color: #8787d7;">&lt;-</span> liftIO <span style="color: #8787d7;">$</span> doesFileExist fp
  <span style="color: #268bd2; font-weight: bold;">if</span> exists
  <span style="color: #268bd2; font-weight: bold;">then</span> <span style="color: #268bd2; font-weight: bold;">do</span> line <span style="color: #8787d7;">&lt;-</span> liftIO <span style="color: #8787d7;">$</span> readFile fp
          liftIO <span style="color: #8787d7;">$</span> putStr <span style="color: #268bd2;">(</span><span style="color: #2aa198;">"Autobots, "</span> <span style="color: #8787d7;">++</span> line<span style="color: #268bd2;">)</span>
  <span style="color: #268bd2; font-weight: bold;">else</span> throwError <span style="color: #2aa198;">"Could not find file in step 2"</span>
</pre>
</div>

<p>
The <code>main</code> function has been remove but there is not much added code here.
Running the <code>runRobot</code> function in the REPL we get the following results which
demonstrate how the failure path evaluates.
</p>

<pre class="example">
λ&gt; runRobot (step1 &gt;&gt;= step2) (Env "autobots.txt")
Greetings from Step 1.
0
Autobots, roll out
Right ()
λ&gt; runRobot (step1 &gt;&gt;= step2) (Env "autobats.txt")
Greetings from Step 1.
0
Left "Could not find file in step 2"
</pre>
</div>
</div>
</div>

<div id="outline-container-org5a7f4df" class="outline-3">
<h3 id="org5a7f4df">Data structures</h3>
<div class="outline-text-3" id="text-org5a7f4df">
</div>
<div id="outline-container-org21ae918" class="outline-4">
<h4 id="org21ae918">Numbers</h4>
<div class="outline-text-4" id="text-org21ae918">

<div id="orgc18e468" class="figure">
<p><img src="../images/numeric-tower-haskell.png" alt="numeric-tower-haskell.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-org01ce246" class="outline-4">
<h4 id="org01ce246"><code>Int</code> and <code>Word</code></h4>
<div class="outline-text-4" id="text-org01ce246">
<p>
The package <code>Data.Int</code> provides signed integers and <code>Data.Word</code> provides
unsigned integers. The latter may be useful to encode that the number has to be
positive at the type level.
</p>
</div>
</div>
<div id="outline-container-org33430c4" class="outline-4">
<h4 id="org33430c4">Strings</h4>
<div class="outline-text-4" id="text-org33430c4">
<p>
Strings are just lists of characters which can lead to poor preformance, which
is why people warn that <code>String</code> should be avoided if you are doing anything
serious with text. Still, for the cases where performance isn't going to be a
problem strings are simple to work with. The <code>printf</code> function in <code>base</code>
provides string interpolation.
</p>

<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #268bd2; font-weight: bold;">import</span> <span style="color: #df005f; font-weight: bold;">Text.Printf</span> <span style="color: #268bd2;">(</span>printf<span style="color: #268bd2;">)</span>

<span style="color: #d75fd7; font-weight: bold;">a</span> <span style="color: #8787d7;">=</span> printf <span style="color: #2aa198;">"foo %d"</span> <span style="color: #d75fd7;">1</span> <span style="color: #8787d7;">::</span> <span style="color: #df005f; font-weight: bold;">IO</span> <span style="color: #268bd2; font-weight: bold;">()</span>
<span style="color: #d75fd7; font-weight: bold;">b</span> <span style="color: #8787d7;">=</span> printf <span style="color: #2aa198;">"bar %d"</span> <span style="color: #d75fd7;">2</span> <span style="color: #8787d7;">::</span> <span style="color: #df005f; font-weight: bold;">String</span>
</pre>
</div>

<p>
The variable <code>a</code> stores and action which prints "foo 1" and <code>b</code> is a string:
"bar 2".
</p>
</div>
</div>

<div id="outline-container-orga9ad1dd" class="outline-4">
<h4 id="orga9ad1dd">Semigroup</h4>
<div class="outline-text-4" id="text-orga9ad1dd">
<p>
A <i>semigroup</i> is a set with an associative binary operation. In <code>base</code> this type
class, <code>Data.Semigroup</code>, requires a function <code>&lt;&gt;</code>, and instances of this function must be
associative.
</p>
</div>
</div>
<div id="outline-container-org2c22927" class="outline-4">
<h4 id="org2c22927">Monoid</h4>
<div class="outline-text-4" id="text-org2c22927">
<p>
A <i>monoid</i> is a semigroup which has an identity element. In <code>base</code> this type
class, <code>Data.Monoid</code>, requires the function <code>&lt;&gt;</code>, as in semigroup, and <code>mempty</code>
for the identity element. The <code>mempty</code> must be both a left and right identity.
</p>
<ul class="org-ul">
<li><code>Data.List.NonEmpty</code> (in <code>base</code>) for non-empty lists to avoid run time errors
due to bad calls to <code>head</code> or <code>tail</code>.</li>
<li><code>containers</code> has several efficient data structures that can be used as an
alternative to lists.
<ul class="org-ul">
<li><code>Data.Map</code> for look-up tables</li>
<li><code>Data.Sequence</code> if you finite lists you can access from both ends</li>
<li><code>Data.Set</code> for sets of elements in <code>Eq</code> and <code>Ord</code></li>
</ul></li>
<li><code>vector</code> has vectors.</li>
</ul>
</div>
</div>
<div id="outline-container-org3290f4d" class="outline-4">
<h4 id="org3290f4d">Foldable</h4>
<div class="outline-text-4" id="text-org3290f4d">
<p>
A data structure that reduced to a single summary value: <code>foldr :: (a -&gt; b -&gt; b)
-&gt; b -&gt; t a -&gt; b</code>. For example, you might add up all the values on a tree where
each node has a value. When the data form a monoid <code>foldMap</code> can be implemented
instead which just uses the monoid's addition.
</p>
</div>
</div>
<div id="outline-container-org3337703" class="outline-4">
<h4 id="org3337703">Traversable</h4>
<div class="outline-text-4" id="text-org3337703">
<p>
Like a more powerful functor: <code>traverse :: Applicative f =&gt; (a -&gt; f b) -&gt; t a -&gt;
f (t b)</code>
</p>
</div>
</div>
</div>

<div id="outline-container-org4c36bc1" class="outline-3">
<h3 id="org4c36bc1"><code>ST</code> monad</h3>
<div class="outline-text-3" id="text-org4c36bc1">
</div>
<div id="outline-container-org029d81c" class="outline-4">
<h4 id="org029d81c">Example</h4>
<div class="outline-text-4" id="text-org029d81c">
<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #268bd2; font-weight: bold;">import</span> <span style="color: #df005f; font-weight: bold;">Control.Monad</span> <span style="color: #268bd2;">(</span>replicateM_,liftM<span style="color: #268bd2;">)</span>
<span style="color: #268bd2; font-weight: bold;">import</span> <span style="color: #df005f; font-weight: bold;">Control.Monad.ST</span> <span style="color: #268bd2;">(</span>runST<span style="color: #268bd2;">)</span>
<span style="color: #268bd2; font-weight: bold;">import</span> <span style="color: #df005f; font-weight: bold;">Data.STRef</span>

<span style="color: #d75fd7; font-weight: bold;">foo</span> <span style="color: #8787d7;">::</span> <span style="color: #df005f; font-weight: bold;">String</span>
<span style="color: #d75fd7; font-weight: bold;">foo</span> <span style="color: #8787d7;">=</span> runST <span style="color: #8787d7;">$</span> <span style="color: #268bd2; font-weight: bold;">do</span>
  ref <span style="color: #8787d7;">&lt;-</span> newSTRef <span style="color: #2aa198;">"hello "</span>
  x <span style="color: #8787d7;">&lt;-</span> readSTRef ref
  writeSTRef ref <span style="color: #268bd2;">(</span>x <span style="color: #8787d7;">++</span> <span style="color: #2aa198;">"world"</span><span style="color: #268bd2;">)</span>
  readSTRef ref
</pre>
</div>
</div>
</div>

<div id="outline-container-org79919e2" class="outline-4">
<h4 id="org79919e2">Another example</h4>
<div class="outline-text-4" id="text-org79919e2">
<p>
Next time you have tricky fold, the following might be useful. Note that we use
the <code>modifySTRef'</code> with the apostrophe, which is the strick version of the
function to avoid the build up of thunks which might otherwise be a problem.
</p>

<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #268bd2; font-weight: bold;">import</span> <span style="color: #df005f; font-weight: bold;">Control.Monad</span> <span style="color: #268bd2;">(</span>replicateM_,liftM<span style="color: #268bd2;">)</span>
<span style="color: #268bd2; font-weight: bold;">import</span> <span style="color: #df005f; font-weight: bold;">Control.Monad.ST</span> <span style="color: #268bd2;">(</span>runST<span style="color: #268bd2;">)</span>
<span style="color: #268bd2; font-weight: bold;">import</span> <span style="color: #df005f; font-weight: bold;">Data.STRef</span>

<span style="color: #d75fd7; font-weight: bold;">fib</span> <span style="color: #8787d7;">::</span> <span style="color: #df005f; font-weight: bold;">Int</span> <span style="color: #8787d7;">-&gt;</span> <span style="color: #df005f; font-weight: bold;">Int</span>
<span style="color: #d75fd7; font-weight: bold;">fib</span> n <span style="color: #8787d7;">=</span> runST <span style="color: #8787d7;">$</span> <span style="color: #268bd2; font-weight: bold;">do</span>
  ref <span style="color: #8787d7;">&lt;-</span> newSTRef <span style="color: #268bd2;">(</span><span style="color: #d75fd7;">0</span>,<span style="color: #d75fd7;">1</span><span style="color: #268bd2;">)</span>
  replicateM_ n <span style="color: #8787d7;">$</span> modifySTRef' ref <span style="color: #268bd2;">(</span><span style="color: #8787d7;">\</span><span style="color: #d75fd7;">(</span>a,b<span style="color: #d75fd7;">)</span> <span style="color: #8787d7;">-&gt;</span> <span style="color: #d75fd7;">(</span>b,a<span style="color: #8787d7;">+</span>b<span style="color: #d75fd7;">)</span><span style="color: #268bd2;">)</span>
  liftM snd <span style="color: #8787d7;">$</span> readSTRef ref
</pre>
</div>

<p>
Moreover, this appears to be faster than the following non-tail recursive
implementation
</p>

<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #d75fd7; font-weight: bold;">fib2</span> <span style="color: #8787d7;">::</span> <span style="color: #df005f; font-weight: bold;">Int</span> <span style="color: #8787d7;">-&gt;</span> <span style="color: #df005f; font-weight: bold;">Int</span>
<span style="color: #d75fd7; font-weight: bold;">fib2</span> n
  <span style="color: #8787d7;">|</span> n <span style="color: #8787d7;">&lt;</span> <span style="color: #d75fd7;">2</span> <span style="color: #8787d7;">=</span> <span style="color: #d75fd7;">1</span>
  <span style="color: #8787d7;">|</span> otherwise <span style="color: #8787d7;">=</span> fib <span style="color: #268bd2;">(</span>n<span style="color: #8787d7;">-</span><span style="color: #d75fd7;">1</span><span style="color: #268bd2;">)</span> <span style="color: #8787d7;">+</span> fib <span style="color: #268bd2;">(</span>n<span style="color: #8787d7;">-</span><span style="color: #d75fd7;">2</span><span style="color: #268bd2;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb80a13b" class="outline-4">
<h4 id="orgb80a13b">Another example again</h4>
<div class="outline-text-4" id="text-orgb80a13b">
<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #268bd2; font-weight: bold;">import</span> <span style="color: #df005f; font-weight: bold;">Control.Monad.ST</span>
<span style="color: #268bd2; font-weight: bold;">import</span> <span style="color: #df005f; font-weight: bold;">Data.STRef</span>
<span style="color: #268bd2; font-weight: bold;">import</span> <span style="color: #df005f; font-weight: bold;">Data.Foldable</span>

<span style="color: #d75fd7; font-weight: bold;">sumST</span> <span style="color: #8787d7;">::</span> <span style="color: #df005f; font-weight: bold;">Num</span> a <span style="color: #8787d7;">=&gt;</span> <span style="color: #268bd2;">[</span>a<span style="color: #268bd2;">]</span> <span style="color: #8787d7;">-&gt;</span> a
<span style="color: #d75fd7; font-weight: bold;">sumST</span> xs <span style="color: #8787d7;">=</span> runST <span style="color: #8787d7;">$</span> <span style="color: #268bd2; font-weight: bold;">do</span>
    n <span style="color: #8787d7;">&lt;-</span> newSTRef <span style="color: #d75fd7;">0</span>
    for_ xs <span style="color: #8787d7;">$</span> <span style="color: #8787d7;">\</span>x <span style="color: #8787d7;">-&gt;</span>
        modifySTRef n <span style="color: #268bd2;">(</span><span style="color: #8787d7;">+</span>x<span style="color: #268bd2;">)</span>
    readSTRef n
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgdaaca94" class="outline-3">
<h3 id="orgdaaca94">Linting <code>hindent</code></h3>
<div class="outline-text-3" id="text-orgdaaca94">
<p>
<code>hindent</code> is a pretty printer which can be used to lint Haskell code.
Install it with <code>stack install hindent</code> and pay attention to where it installs because you need that on your path.
There is an Emacs minor mode, <code>hindent-mode</code>, which exposes the functionality of this program: <code>hindent-reformat-*</code>.
</p>

<p>
I have the following shortcuts:
</p>

<ul class="org-ul">
<li><code>SPC o h h r</code> owner haskell hindent region</li>
<li><code>SPC o h h b</code> owner haskell hindent buffer</li>
</ul>
</div>
</div>

<div id="outline-container-org9eb552d" class="outline-3">
<h3 id="org9eb552d">JSON with Aeson</h3>
<div class="outline-text-3" id="text-org9eb552d">
<p>
For additional notes on JSON see <a href="./json-notes.html">my json notes</a>.
</p>

<p>
<code>aeson</code> is <i>the</i> package for working with JSON. The important functions provided
are <code>encode</code> and <code>decode</code> and the typeclasses <code>ToJson</code> and <code>FromJson</code> which
ensure a type can be encoded and decoded. They can be derived automatically
along with <code>Generic</code>, although this requires the <code>DeriveGeneric</code> extension to be
include. The <code>OverloadedStrings</code> is also very useful to include. In addition to
loading <code>import Data.Aeson as JSON</code> you need to <code>import GHC.Generics</code>. This
stuff tends to work with lazy bytestrings, so there may be a little bit of
messing around to get that working but it is not too bad. The following are very
useful signatures to keep handy.
</p>

<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #d75fd7;">{-# LANGUAGE DeriveGeneric #-}</span>

<span style="color: #268bd2; font-weight: bold;">import</span> <span style="color: #df005f; font-weight: bold;">Data.Aeson</span>

<span style="color: #d75fd7; font-weight: bold;">decode</span> <span style="color: #8787d7;">::</span> <span style="color: #df005f; font-weight: bold;">FromJSON</span> a <span style="color: #8787d7;">=&gt;</span> <span style="color: #df005f; font-weight: bold;">ByteString</span> <span style="color: #8787d7;">-&gt;</span> <span style="color: #df005f; font-weight: bold;">Maybe</span> a
<span style="color: #d75fd7; font-weight: bold;">encode</span> <span style="color: #8787d7;">::</span> <span style="color: #df005f; font-weight: bold;">ToJSON</span> a <span style="color: #8787d7;">=&gt;</span> a <span style="color: #8787d7;">-&gt;</span> <span style="color: #df005f; font-weight: bold;">ByteString</span>
<span style="color: #d75fd7; font-weight: bold;">encodeFile</span> <span style="color: #8787d7;">::</span> <span style="color: #df005f; font-weight: bold;">ToJSON</span> a <span style="color: #8787d7;">=&gt;</span> <span style="color: #df005f; font-weight: bold;">FilePath</span> <span style="color: #8787d7;">-&gt;</span> a <span style="color: #8787d7;">-&gt;</span> <span style="color: #df005f; font-weight: bold;">IO</span> <span style="color: #268bd2; font-weight: bold;">()</span> 
</pre>
</div>

<p>
Alternatively, you can use the <a href="https://hackage.haskell.org/package/bytestring-0.10.10.0/docs/Data-ByteString-Lazy.html#t:ByteString"><code>ByteString</code></a> type from the <code>bytestring</code> package
to write things to disk.
</p>

<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #268bd2; font-weight: bold;">import</span> <span style="color: #df005f; font-weight: bold;">Data.ByteString.Lazy</span>

<span style="color: #d75fd7; font-weight: bold;">writeFile</span> <span style="color: #8787d7;">::</span> <span style="color: #df005f; font-weight: bold;">FilePath</span> <span style="color: #8787d7;">-&gt;</span> <span style="color: #df005f; font-weight: bold;">ByteString</span> <span style="color: #8787d7;">-&gt;</span> <span style="color: #df005f; font-weight: bold;">IO</span> <span style="color: #268bd2; font-weight: bold;">()</span>
<span style="color: #d75fd7; font-weight: bold;">readFile</span> <span style="color: #8787d7;">::</span> <span style="color: #df005f; font-weight: bold;">FilePath</span> <span style="color: #8787d7;">-&gt;</span> <span style="color: #df005f; font-weight: bold;">IO</span> <span style="color: #df005f; font-weight: bold;">ByteString</span>
</pre>
</div>

<p>
<b>Note</b> that when decoding an object from a JSON file, the order of the key-value
pairs in the JSON does not matter, nor does the existance of additional fields
provided the important ones can be parsed correctly.
</p>

<p>
There is a useful <a href="https://williamyaoh.com/posts/2019-10-19-a-cheatsheet-to-json-handling.html">cheatsheet</a> on parsing JSON from William Yao which may be worth
looking at.
</p>
</div>
</div>

<div id="outline-container-orgf7c88b4" class="outline-3">
<h3 id="orgf7c88b4">Haskell layer in Spacemacs</h3>
<div class="outline-text-3" id="text-orgf7c88b4">
<p>
To enable the <a href="https://github.com/syl20bnr/spacemacs/tree/master/layers/%2Blang/haskell">Haskell layer</a> add the following to <code>dotspacemacs-configuration-layers</code>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #268bd2;">(</span>haskell <span style="color: #268bd2;">:variables</span>
         haskell-enable-hindent-style <span style="color: #2aa198;">"johan-tibell"</span>
         haskell-process-type 'stack-ghci<span style="color: #268bd2;">)</span>
</pre>
</div>

<p>
If you want to make use of <code>hindent</code>, you'll need to make sure that the executable is on the path Emacs uses: <code>exec-path</code> or <code>eshell-path-env</code>.
</p>
</div>
</div>

<div id="outline-container-org2b010c6" class="outline-3">
<h3 id="org2b010c6">GHC extensions</h3>
<div class="outline-text-3" id="text-org2b010c6">
</div>
<div id="outline-container-orgbe5e98e" class="outline-4">
<h4 id="orgbe5e98e"><a href="https://downloads.haskell.org/~ghc/8.2.1/docs/html/users_guide/glasgow_exts.html#overloaded-string-literals"><code>OverloadedStrings</code></a></h4>
<div class="outline-text-4" id="text-orgbe5e98e">
<p>
Allows you to use string literals to mean other string-ey type things.
For instance, this would be useful when working with <code>Text</code>.
</p>
</div>
</div>
<div id="outline-container-orgc403830" class="outline-4">
<h4 id="orgc403830"><a href="https://ocharles.org.uk/posts/2014-12-04-record-wildcards.html"><code>RecordWildcards</code></a></h4>
<div class="outline-text-4" id="text-orgc403830">
<p>
Neat syntax for pattern matching a record based on its field names.
</p>
</div>
</div>
<div id="outline-container-org5096126" class="outline-4">
<h4 id="org5096126"><a href="https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#unicode-syntax"><code>UnicodeSyntax</code></a></h4>
<div class="outline-text-4" id="text-org5096126">
<p>
This allows you to make use of Unicode characters in your code which is
particularly nice if you are going a verbatim translation of some mathematics.
Emacs provides a nice way to make it easy to <a href="https://www.gnu.org/software/emacs/manual/html_node/emacs/Select-Input-Method.html">input Unicode</a> but to make it even
easier, I've added the following bindings.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #008787; background-color: #262626;">;; </span><span style="color: #008787; background-color: #262626;">Set the input method to TeX so typing TeX defaults to the Unicode.</span>
<span style="color: #008787; background-color: #262626;">;; </span><span style="color: #008787; background-color: #262626;">Use C-\ to escape this input method.</span>
<span style="color: #008787; background-color: #262626;">;; </span><span style="color: #008787; background-color: #262626;">MNEMONIC: owner-haskell-unicode</span>
<span style="color: #268bd2;">(</span>spacemacs/set-leader-keys <span style="color: #2aa198;">"ohu"</span> 'set-input-method<span style="color: #268bd2;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orga81d7c4" class="outline-4">
<h4 id="orga81d7c4"><a href="https://gitlab.haskell.org/ghc/ghc/-/wikis/overloaded-lists"><code>OverloadedLists</code></a></h4>
<div class="outline-text-4" id="text-orga81d7c4">
<p>
This desugars list syntax to make it easier to use list syntax to construct
things.
</p>

<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #d75fd7;">{-# LANGUAGE OverloadedLists #-}</span>

<span style="color: #d75fd7; font-weight: bold;">foo</span> <span style="color: #8787d7;">=</span> <span style="color: #268bd2;">[</span><span style="color: #d75fd7;">(</span><span style="color: #d75fd7;">1</span>,<span style="color: #d75fd7;">2</span><span style="color: #d75fd7;">)</span>,<span style="color: #d75fd7;">(</span><span style="color: #d75fd7;">2</span>,<span style="color: #d75fd7;">3</span><span style="color: #d75fd7;">)</span><span style="color: #268bd2;">]</span> <span style="color: #8787d7;">::</span> <span style="color: #df005f; font-weight: bold;">Map</span> <span style="color: #df005f; font-weight: bold;">Int</span> <span style="color: #df005f; font-weight: bold;">Int</span>
</pre>
</div>

<p>
This will only work with the <code>OverloadedLists</code> extension.
</p>
</div>
</div>
</div>
<div id="outline-container-orgdfdec9a" class="outline-3">
<h3 id="orgdfdec9a">GHC extensions: <code>DeriveX</code></h3>
<div class="outline-text-3" id="text-orgdfdec9a">
<ul class="org-ul">
<li><code>DeriveFunctor</code></li>
<li><code>DeriveFoldable</code></li>
<li><code>DeriveTraversable</code></li>
<li><code>GeneralizedNewtypeDeriving</code> to make better use of <code>newtype</code>.</li>
</ul>
</div>
</div>

<div id="outline-container-orge2fbc3f" class="outline-3">
<h3 id="orge2fbc3f">Packages I like</h3>
<div class="outline-text-3" id="text-orge2fbc3f">
</div>
<div id="outline-container-org3ea65e2" class="outline-4">
<h4 id="org3ea65e2"><a href="http://hackage.haskell.org/package/ad"><code>ad</code></a>: combinators for automatic differentiation</h4>
</div>
<div id="outline-container-org056eb62" class="outline-4">
<h4 id="org056eb62"><a href="https://hackage.haskell.org/package/aeson"><code>aeson</code></a>: a JSON parsing and encoding library</h4>
</div>
<div id="outline-container-orgeca4c64" class="outline-4">
<h4 id="orgeca4c64"><a href="https://hackage.haskell.org/package/cassava"><code>cassava</code></a>: parsing and encoding RFC 4180 compliant CSV data</h4>
<div class="outline-text-4" id="text-orgeca4c64">
<p>
One example of using <code>cassava</code> is to make the <code>Chain</code> type from <code>mcmc-types</code> an
instance of <code>ToRecord</code> which makes it easier to write MCMC samples to a CSV. The
following snippet demonstrates how you might do this with an orphan-instance.
</p>

<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #268bd2; font-weight: bold;">import</span> <span style="color: #df005f; font-weight: bold;">Data.Csv</span>
<span style="color: #268bd2; font-weight: bold;">import</span> <span style="color: #df005f; font-weight: bold;">Data.Maybe</span> <span style="color: #268bd2;">(</span>fromMaybe<span style="color: #268bd2;">)</span>
<span style="color: #268bd2; font-weight: bold;">import</span> <span style="color: #268bd2; font-weight: bold;">qualified</span> <span style="color: #df005f; font-weight: bold;">Data.Vector</span> <span style="color: #268bd2; font-weight: bold;">as</span> <span style="color: #df005f; font-weight: bold;">V</span>

<span style="color: #268bd2; font-weight: bold;">instance</span> <span style="color: #268bd2;">(</span><span style="color: #df005f; font-weight: bold;">ToRecord</span> a, <span style="color: #df005f; font-weight: bold;">ToRecord</span> b<span style="color: #268bd2;">)</span> <span style="color: #8787d7;">=&gt;</span> <span style="color: #df005f; font-weight: bold;">ToRecord</span> <span style="color: #268bd2;">(</span><span style="color: #df005f; font-weight: bold;">Chain</span> a b<span style="color: #268bd2;">)</span> <span style="color: #268bd2; font-weight: bold;">where</span>
  toRecord <span style="color: #df005f; font-weight: bold;">Chain</span> <span style="color: #268bd2;">{</span><span style="color: #8787d7;">..</span><span style="color: #268bd2;">}</span> <span style="color: #8787d7;">=</span>
    V.concat
      <span style="color: #268bd2;">[</span> <span style="color: #d75fd7;">(</span>record <span style="color: #2aa198;">[</span>toField chainScore<span style="color: #2aa198;">]</span><span style="color: #d75fd7;">)</span>
      , <span style="color: #d75fd7;">(</span>toRecord chainPosition<span style="color: #d75fd7;">)</span>
      , fromMaybe V.empty <span style="color: #d75fd7;">(</span>toRecord <span style="color: #8787d7;">&lt;$&gt;</span> chainTunables<span style="color: #d75fd7;">)</span>
      <span style="color: #268bd2;">]</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org3b3f7fb" class="outline-4">
<h4 id="org3b3f7fb"><a href="https://hackage.haskell.org/package/math-functions"><code>math-functions</code></a>: various utilities for numerical computing</h4>
</div>
<div id="outline-container-org5afe740" class="outline-4">
<h4 id="org5afe740"><a href="https://hackage.haskell.org/package/moo"><code>moo</code></a>: provides building blocks to build genetic algorithms</h4>
</div>
<div id="outline-container-org603593b" class="outline-4">
<h4 id="org603593b"><a href="https://hackage.haskell.org/package/monad-par"><code>monad-par</code></a> which makes use of combinators in <a href="https://hackage.haskell.org/package/monad-par-extras"><code>monad-par-extras</code></a></h4>
<div class="outline-text-4" id="text-org603593b">
<p>
Without knowing anything about how this works internally, the following functions should be sufficient for running a map type computation in parallel.
</p>

<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #268bd2; font-weight: bold;">import</span> <span style="color: #df005f; font-weight: bold;">Control.Monad.Par</span> <span style="color: #268bd2;">(</span>runPar<span style="color: #268bd2;">)</span>
<span style="color: #268bd2; font-weight: bold;">import</span> <span style="color: #df005f; font-weight: bold;">Control.Monad.Par.Combinator</span> <span style="color: #268bd2;">(</span>parMap<span style="color: #268bd2;">)</span>

<span style="color: #268bd2; font-weight: bold;">data</span> <span style="color: #df005f; font-weight: bold;">Par</span> a

<span style="color: #d75fd7; font-weight: bold;">runPar</span> <span style="color: #8787d7;">::</span> <span style="color: #df005f; font-weight: bold;">Par</span> a <span style="color: #8787d7;">-&gt;</span> a
<span style="color: #d75fd7; font-weight: bold;">parMap</span> <span style="color: #8787d7;">::</span> <span style="color: #df005f; font-weight: bold;">Traversable</span> t <span style="color: #8787d7;">=&gt;</span> <span style="color: #268bd2;">(</span>a <span style="color: #8787d7;">-&gt;</span> b<span style="color: #268bd2;">)</span> <span style="color: #8787d7;">-&gt;</span> t a <span style="color: #8787d7;">-&gt;</span> p <span style="color: #268bd2;">(</span>t b<span style="color: #268bd2;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org11f6817" class="outline-4">
<h4 id="org11f6817"><a href="https://hackage.haskell.org/package/statistics"><code>statistics</code></a>: common functions and types useful in statistics</h4>
</div>
</div>
</div>

<div id="outline-container-org48998d7" class="outline-2">
<h2 id="org48998d7">Hackage</h2>
<div class="outline-text-2" id="text-org48998d7">
</div>
<div id="outline-container-org0754f39" class="outline-3">
<h3 id="org0754f39">Development shell</h3>
<div class="outline-text-3" id="text-org0754f39">
<ul class="org-ul">
<li>There is a nix-shell to assist in testing your package in a reproducible
environment described in <a href="./nix-notes.html">my nix notes</a>.</li>
</ul>
</div>
</div>

<div id="outline-container-orgd15d8fc" class="outline-3">
<h3 id="orgd15d8fc">Notes about uploading a package to hackage</h3>
<div class="outline-text-3" id="text-orgd15d8fc">
<ul class="org-ul">
<li>Once a package is uploaded, it is there forever so make sure it is correct,
that is why there is the package candidate system.</li>
<li>The utility <code>cabal gen-bounds</code> makes it easy to generate suitable bounds on
dependency versions. To keep the version bounds DRY you only need to specify
them on their first occurrence in the cabal file. This will only work with an
up to date version of cabal.</li>
<li>There is a cabal <code>sdist</code> utility to zip up a package prior to submission.</li>
<li>When a package is updated the <i>package versioning policy</i> should be used to
update the package version. There is a useful <a href="https://pvp.haskell.org/#decision-tree">decision tree</a> to help you apply
this policy. A version must be of the form <code>A.B.C</code> with an optional suffix of
<code>.D</code>.</li>
<li>The command <code>stack sdist</code> will check the package for common mistakes and
produce a tarball ready for uploading. When a package is uploaded, it may take
a while for the documentation to be build and uploaded.</li>
<li>To use the uploaded package before it has made it onto stackage you can copy
the link for the tarball into <code>extra-deps</code> in the stack YAML file.</li>
<li>There is the <code>cabal-fmt</code> package which you can use to format your cabal file,
eg <code>cabal-fmt --inplace demo.cabal</code>.</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org5b0be74" class="outline-2">
<h2 id="org5b0be74">Type theory and functional programming</h2>
<div class="outline-text-2" id="text-org5b0be74">
<p>
See my <a href="./type-theory-notes.html">type theory and functional programming notes</a>
</p>
</div>
</div>

<div id="outline-container-orgd945df3" class="outline-2">
<h2 id="orgd945df3">Haskell for science</h2>
<div class="outline-text-2" id="text-orgd945df3">
</div>
<div id="outline-container-org5ac97e7" class="outline-3">
<h3 id="org5ac97e7">Optimisation</h3>
<div class="outline-text-3" id="text-org5ac97e7">
<p>
Use <code>moo</code> for a rough estimate.
</p>
</div>
</div>
<div id="outline-container-orgcb33cde" class="outline-3">
<h3 id="orgcb33cde">Root finding</h3>
<div class="outline-text-3" id="text-orgcb33cde">
<p>
Use <code>statistics</code> for finding roots if you know a bounding interval, with or
without derivatives, both Ridders and Newton have good convergence.
</p>
</div>
</div>
<div id="outline-container-orge93410e" class="outline-3">
<h3 id="orge93410e">Differential equations</h3>
<div class="outline-text-3" id="text-orge93410e">
<p>
Consider
</p>

<p>
\[
\frac{dx}{dt} = \alpha x(t), \quad x(0) = x_0
\]
</p>

<p>
This example needs <code>hmatrix</code> and <code>hmatrix-gsl</code>.
</p>

<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #268bd2; font-weight: bold;">import</span> <span style="color: #df005f; font-weight: bold;">Numeric.GSL.ODE</span>
<span style="color: #268bd2; font-weight: bold;">import</span> <span style="color: #df005f; font-weight: bold;">Numeric.LinearAlgebra</span>
<span style="color: #268bd2; font-weight: bold;">import</span> <span style="color: #df005f; font-weight: bold;">Numeric.LinearAlgebra.Data</span>

<span style="color: #d75fd7; font-weight: bold;">alpha</span> <span style="color: #8787d7;">=</span> <span style="color: #d75fd7;">0.1</span>

<span style="color: #d75fd7; font-weight: bold;">xdash</span> <span style="color: #268bd2; font-weight: bold;">_</span> <span style="color: #268bd2;">[</span>x<span style="color: #268bd2;">]</span> <span style="color: #8787d7;">=</span> <span style="color: #268bd2;">[</span>x <span style="color: #8787d7;">*</span> alpha<span style="color: #268bd2;">]</span>

<span style="color: #d75fd7; font-weight: bold;">x0</span> <span style="color: #8787d7;">=</span> <span style="color: #d75fd7;">1.0</span>

<span style="color: #d75fd7; font-weight: bold;">ts</span> <span style="color: #8787d7;">=</span> linspace <span style="color: #d75fd7;">100</span> <span style="color: #268bd2;">(</span><span style="color: #d75fd7;">0</span>,<span style="color: #d75fd7;">3</span><span style="color: #268bd2;">)</span>

<span style="color: #d75fd7; font-weight: bold;">numericSol</span> <span style="color: #8787d7;">=</span> odeSolve xdash <span style="color: #268bd2;">[</span>x0<span style="color: #268bd2;">]</span> ts

<span style="color: #d75fd7; font-weight: bold;">exactSol</span> <span style="color: #8787d7;">=</span> asColumn <span style="color: #8787d7;">$</span> x0' <span style="color: #8787d7;">*</span> exp <span style="color: #268bd2;">(</span>alpha' <span style="color: #8787d7;">*</span> ts<span style="color: #268bd2;">)</span>
  <span style="color: #268bd2; font-weight: bold;">where</span>
    x0' <span style="color: #8787d7;">=</span> scalar x0
    alpha' <span style="color: #8787d7;">=</span> scalar alpha


<span style="color: #d75fd7; font-weight: bold;">main</span> <span style="color: #8787d7;">::</span> <span style="color: #df005f; font-weight: bold;">IO</span> <span style="color: #268bd2; font-weight: bold;">()</span>
<span style="color: #d75fd7; font-weight: bold;">main</span> <span style="color: #8787d7;">=</span>
  <span style="color: #268bd2; font-weight: bold;">if</span> maxElement <span style="color: #268bd2;">(</span>numericSol <span style="color: #8787d7;">-</span> exactSol<span style="color: #268bd2;">)</span> <span style="color: #8787d7;">&lt;</span> <span style="color: #d75fd7;">1e-10</span>
    <span style="color: #268bd2; font-weight: bold;">then</span> putStrLn <span style="color: #2aa198;">"They are equal!"</span>
    <span style="color: #268bd2; font-weight: bold;">else</span> putStrLn <span style="color: #2aa198;">"Huge error :("</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org63e7575" class="outline-3">
<h3 id="org63e7575">Random number simulation</h3>
<div class="outline-text-3" id="text-org63e7575">
<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #268bd2; font-weight: bold;">import</span> <span style="color: #df005f; font-weight: bold;">System.Random.MWC</span>

<span style="color: #d75fd7; font-weight: bold;">foobar</span> <span style="color: #8787d7;">::</span> <span style="color: #df005f; font-weight: bold;">IO</span> <span style="color: #268bd2;">(</span><span style="color: #df005f; font-weight: bold;">Double</span>,<span style="color: #df005f; font-weight: bold;">Double</span><span style="color: #268bd2;">)</span>
<span style="color: #d75fd7; font-weight: bold;">foobar</span> <span style="color: #8787d7;">=</span> <span style="color: #268bd2; font-weight: bold;">do</span>
  gen <span style="color: #8787d7;">&lt;-</span> create
  x1 <span style="color: #8787d7;">&lt;-</span> uniform gen
  x2 <span style="color: #8787d7;">&lt;-</span> uniform gen
  return <span style="color: #268bd2;">(</span>x1,x2<span style="color: #268bd2;">)</span>
</pre>
</div>

<p>
This returns a pair of <i>different</i> numbers because it is working in an instance
of <code>PrimMonad</code> and managing the state between uses of <code>gen</code>. Multiple calls to
this function always return the same values because the <code>create</code> function starts
with a hardcoded seed in the library.
</p>
</div>
</div>

<div id="outline-container-org330e47c" class="outline-3">
<h3 id="org330e47c">Numbers</h3>
<div class="outline-text-3" id="text-org330e47c">
<p>
To learn about how Haskell handles numbers &#x2014; although we only really care
about <code>Integer</code> and <code>Double</code> &#x2014; there is the <a href="https://www.haskell.org/onlinereport/basic.html">report</a> and a <a href="https://www.haskell.org/tutorial/numbers.html">gentle introduction</a>
available. The <a href="https://hackage.haskell.org/package/numeric-limits-0.1.0.0/docs/Numeric-Limits.html"><code>numeric-limits</code></a> package provides some helpful functions for
working with this too.
</p>
</div>
</div>

<div id="outline-container-orgcf47c91" class="outline-3">
<h3 id="orgcf47c91">Special functions</h3>
<div class="outline-text-3" id="text-orgcf47c91">
<p>
The <code>math-functions</code> package provides the <code>Numeric.SpecFunctions</code> module which
provides lots of useful functions: <code>choose</code> and <code>logChoose</code> for working with
binomial coefficients.
</p>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Alex Zarebski</p>
<p class="date">Created: 2021-03-15 Mon 19:31</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
