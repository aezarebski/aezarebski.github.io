<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2020-10-15 Thu 16:04 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>&lrm;</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Alex Zarebski" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<link rel="stylesheet" type="text/css" href="../css/stylesheet.css" />
<script type="text/javascript">
// @license magnet:?xt=urn:btih:e95b018ef3580986a04669f1b5879592219e2a7a&dn=public-domain.txt Public Domain
<!--/*--><![CDATA[/*><!--*/
     function CodeHighlightOn(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.add("code-highlighted");
         target.classList.add("code-highlighted");
       }
     }
     function CodeHighlightOff(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.remove("code-highlighted");
         target.classList.remove("code-highlighted");
       }
     }
    /*]]>*///-->
// @license-end
</script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
});
</script>
<script type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML"></script>
</head>
<body>
<div id="content">
<p>
<a href="../index.html">Home</a>
</p>



<div id="orga71aa87" class="figure">
<p><img src="../images/haskell-logo.png" alt="haskell-logo.png" /> 
</p>
</div>

<div id="outline-container-orga8b6914" class="outline-2">
<h2 id="orga8b6914">Programming in Haskell</h2>
<div class="outline-text-2" id="text-orga8b6914">
<p>
<a href="../resources/haskell-cheat-sheet.pdf">HASKELL CHEAT SHEET</a>
</p>
</div>

<div id="outline-container-org31947ce" class="outline-3">
<h3 id="org31947ce">CLI</h3>
<div class="outline-text-3" id="text-org31947ce">
<p>
The function <code>getArgs</code> from <code>System.Environment</code> in <code>base</code> is how you get
command line arguments. 
</p>

<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #3a81c3; font-weight: bold;">import</span> <span style="color: #ba2f59; font-weight: bold;">System.Environment</span>

<span style="color: #6c3163; font-weight: bold;">main</span> <span style="color: #715ab1;">=</span> <span style="color: #3a81c3; font-weight: bold;">do</span>
  a <span style="color: #715ab1;">&lt;-</span> getArgs
  print a
  return <span style="color: #3a81c3; font-weight: bold;">()</span>
</pre>
</div>

<p>
The following example demonstrates how you might get some data from a user at
the command line at run time rather than data about how the program was called.
</p>

<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #6c3163; font-weight: bold;">main</span> <span style="color: #715ab1;">::</span> <span style="color: #ba2f59; font-weight: bold;">IO</span> <span style="color: #3a81c3; font-weight: bold;">()</span>
<span style="color: #6c3163; font-weight: bold;">main</span> <span style="color: #715ab1;">=</span> <span style="color: #3a81c3; font-weight: bold;">do</span>
  putStrLn <span style="color: #2d9574;">"Do you want to continue? [y/n]"</span>
  response <span style="color: #715ab1;">&lt;-</span> getChar
  <span style="color: #3a81c3; font-weight: bold;">if</span> response <span style="color: #715ab1;">==</span> <span style="color: #2d9574;">'n'</span>
    <span style="color: #3a81c3; font-weight: bold;">then</span>
      <span style="color: #3a81c3; font-weight: bold;">do</span>
        putStrLn <span style="color: #2d9574;">"\nmaybe next time :)"</span>
        return <span style="color: #3a81c3; font-weight: bold;">()</span>
    <span style="color: #3a81c3; font-weight: bold;">else</span>
      <span style="color: #3a81c3; font-weight: bold;">if</span> response <span style="color: #715ab1;">/=</span> <span style="color: #2d9574;">'y'</span>
        <span style="color: #3a81c3; font-weight: bold;">then</span>
          <span style="color: #3a81c3; font-weight: bold;">do</span>
            putStrLn <span style="color: #2d9574;">"\n\nI doughnut understand..."</span>
            main
        <span style="color: #3a81c3; font-weight: bold;">else</span>
          <span style="color: #3a81c3; font-weight: bold;">do</span>
            putStrLn <span style="color: #2d9574;">"\nwoohoo!"</span>
            return <span style="color: #3a81c3; font-weight: bold;">()</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-org20d6260" class="outline-3">
<h3 id="org20d6260">Debugging</h3>
<div class="outline-text-3" id="text-org20d6260">
<ol class="org-ol">
<li>Load the relevant module: <code>λ&gt; :load &lt;module.hs&gt;</code></li>
<li>Set a break point: <code>λ&gt; :break &lt;n&gt;</code></li>
<li>Evaluate relevant expression</li>
</ol>

<p>
You can always use <code>:help</code> to get a listing, but here are some useful functions
</p>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">Command</th>
<th scope="col" class="org-left">Function</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-left"><code>:list</code></td>
<td class="org-left">See current line</td>
</tr>

<tr>
<td class="org-left"><code>:step</code></td>
<td class="org-left">Step to next line</td>
</tr>

<tr>
<td class="org-left"><code>:continue</code></td>
<td class="org-left">Run to next break</td>
</tr>

<tr>
<td class="org-left"><code>:show breaks</code></td>
<td class="org-left">Show break points</td>
</tr>

<tr>
<td class="org-left"><code>:delete &lt;n&gt;</code></td>
<td class="org-left">Delete break <code>n</code></td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-orgd8119cb" class="outline-3">
<h3 id="orgd8119cb">Testing <code>hspec</code></h3>
<div class="outline-text-3" id="text-orgd8119cb">
<p>
Add <code>hspec</code> to your dependencies and observe the following example 
</p>

<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #3a81c3; font-weight: bold;">import</span> <span style="color: #ba2f59; font-weight: bold;">Test.Hspec</span>
<span style="color: #3a81c3; font-weight: bold;">import</span> <span style="color: #ba2f59; font-weight: bold;">Control.Exception</span> <span style="color: #3a81c3;">(</span>evaluate<span style="color: #3a81c3;">)</span>

<span style="color: #6c3163; font-weight: bold;">main</span> <span style="color: #715ab1;">::</span> <span style="color: #ba2f59; font-weight: bold;">IO</span> <span style="color: #3a81c3; font-weight: bold;">()</span>
<span style="color: #6c3163; font-weight: bold;">main</span> <span style="color: #715ab1;">=</span> hspec <span style="color: #715ab1;">$</span> <span style="color: #3a81c3; font-weight: bold;">do</span>
  describe <span style="color: #2d9574;">"Prelude.head"</span> <span style="color: #715ab1;">$</span> <span style="color: #3a81c3; font-weight: bold;">do</span>
    it <span style="color: #2d9574;">"returns the first element of a list"</span> <span style="color: #715ab1;">$</span> <span style="color: #3a81c3; font-weight: bold;">do</span>
      head <span style="color: #3a81c3;">[</span><span style="color: #4e3163;">23</span> <span style="color: #715ab1;">..</span><span style="color: #3a81c3;">]</span> <span style="color: #715ab1;">`shouldBe`</span> <span style="color: #3a81c3;">(</span><span style="color: #4e3163;">23</span> <span style="color: #715ab1;">::</span> <span style="color: #ba2f59; font-weight: bold;">Int</span><span style="color: #3a81c3;">)</span>

    it <span style="color: #2d9574;">"throws an exception if used with an empty list"</span> <span style="color: #715ab1;">$</span> <span style="color: #3a81c3; font-weight: bold;">do</span>
      evaluate <span style="color: #3a81c3;">(</span>head <span style="color: #6c3163; font-weight: bold;">[]</span><span style="color: #3a81c3;">)</span> <span style="color: #715ab1;">`shouldThrow`</span> anyException
</pre>
</div>

<p>
There is also integration with QuickCheck available.
</p>
</div>
</div>

<div id="outline-container-orge97cd7d" class="outline-3">
<h3 id="orge97cd7d">Build tool stack</h3>
<div class="outline-text-3" id="text-orge97cd7d">
</div>
<div id="outline-container-orgfb5d8af" class="outline-4">
<h4 id="orgfb5d8af">Installation, upgrading and uninstalling</h4>
<div class="outline-text-4" id="text-orgfb5d8af">
<p>
There is a script from <code>commercialhaskell</code> which installs <code>stack</code>
</p>

<div class="org-src-container">
<pre class="src src-sh">curl -sSL https://get.haskellstack.org/ | sh
</pre>
</div>

<p>
The executable is in <code>/usr/local/bin</code> by default. To upgrade <code>stack</code> there is
the <code>stack upgrade</code> command. To uninstall, remove the stack executable and
<code>~/.stack</code> and the <code>.stack-work</code> from any projects using <code>stack</code>.
</p>

<p>
<code>stack</code> installs to <code>/home/&lt;username&gt;/.local/bin</code> by default, so you should add
this to your path
</p>

<div class="org-src-container">
<pre class="src src-sh"><span style="color: #3a81c3;">export</span> <span style="color: #715ab1;">PATH</span>=/home/&lt;username&gt;/.local/bin:$<span style="color: #715ab1;">PATH</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb0cc4cf" class="outline-4">
<h4 id="orgb0cc4cf">Starting a new project</h4>
<div class="outline-text-4" id="text-orgb0cc4cf">
<div class="org-src-container">
<pre class="src src-sh">stack new &lt;project-name&gt; &lt;template-name&gt;
<span style="color: #3a81c3;">cd</span> my-project
stack setup
stack build
stack exec my-project-exe
</pre>
</div>

<p>
Here <code>&lt;project-name&gt;</code> is the name of the directory that will be created to house
the project and <code>&lt;template-name&gt;</code> is the template to use; I like the <code>simple</code>
template because it uses cabal directly and is free from clutter. If there is
only library code and no executables, then the <code>simple-library</code> might be a
cleaner choice. Packages get added to <code>package.yaml</code> under <code>dependencies:</code> and
you start the REPL with <code>stack ghci</code>. Projects are configured by the <code>.cabal</code>
file, for <code>simple</code> and <code>simple-library</code>. <code>stack</code> can use <code>hpack</code> to convert a
<code>package.yaml</code> file to a <code>.cabal</code> file.
</p>
</div>
</div>

<div id="outline-container-org3f51ba1" class="outline-4">
<h4 id="org3f51ba1">Commands</h4>
<div class="outline-text-4" id="text-org3f51ba1">
<p>
If you are ever unsure about some aspect of <code>stack</code>, appending <code>--help</code> is
usually pretty enlightening.
</p>

<p>
There are few ways to initialise a project.
</p>

<div class="org-src-container">
<pre class="src src-sh">stack new &lt;package-name&gt;
stack new &lt;package-name&gt; &lt;template-name&gt;        <span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Use a particular template</span>
stack new &lt;package-name&gt; --bare &lt;template-name&gt; <span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Without subdirectory</span>
</pre>
</div>

<p>
There are many commands within <code>stack</code> which are listed in the documentation.
Run the executable with
</p>

<div class="org-src-container">
<pre class="src src-sh">stack exec -- project-exe
</pre>
</div>

<p>
Run the tests.
</p>

<div class="org-src-container">
<pre class="src src-sh">stack test
</pre>
</div>

<p>
Build and open documentation in the browser.
</p>

<div class="org-src-container">
<pre class="src src-sh">stack haddock
stack haddock --open
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgc0c2637" class="outline-3">
<h3 id="orgc0c2637"><span class="todo TODO">TODO</span> Building with cabal</h3>
</div>

<div id="outline-container-org61e7563" class="outline-3">
<h3 id="org61e7563">Building with nix</h3>
<div class="outline-text-3" id="text-org61e7563">
<ul class="org-ul">
<li>use <code>cabal2nix</code> to convert a project's cabal file into a nix derivation. As a
result, every time the cabal file changes the nix derivation will need to be
regenerated.</li>
<li>The <code>nix-build</code> command is used to build a package and the <code>nix-shell</code> command
is used to enter a shell configured for development of the package. You'll one
nix file for your overall package which imports the one that was generated by
<code>cabal2nix</code>.</li>
<li>Despite being able to use nix to build your haskell project, Gabriel
recommends sticking with cabal and just using nix to provision the development
environment.</li>
</ul>
</div>
</div>

<div id="outline-container-org61c5d4c" class="outline-3">
<h3 id="org61c5d4c">Profiling criterion</h3>
<div class="outline-text-3" id="text-org61c5d4c">
<p>
Criterion is <i>the</i> tools for profiling code. You build an application with
<code>defaultMain</code> which sets up the benchmarks with a CLI. The <code>defaultMain</code> expects
a <code>[Benchmark]</code>, you group multiple benchmarks with <code>bgroup</code>, you create
<code>Benchmark</code> objects with <code>bench</code>.
</p>

<p>
If you want to use some pre-computed environment variables in a benchmark, you
need the <code>env</code> function to manage this. The following snippet demonstrates how
to do this, generating some random variables once, and then passing them into a
function.
</p>

<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #3a81c3; font-weight: bold;">module</span> <span style="color: #ba2f59; font-weight: bold;">Main</span> <span style="color: #3a81c3; font-weight: bold;">where</span>

<span style="color: #3a81c3; font-weight: bold;">import</span> <span style="color: #ba2f59; font-weight: bold;">Control.Monad</span>
<span style="color: #3a81c3; font-weight: bold;">import</span> <span style="color: #ba2f59; font-weight: bold;">Criterion.Main</span>
<span style="color: #3a81c3; font-weight: bold;">import</span> <span style="color: #3a81c3; font-weight: bold;">qualified</span> <span style="color: #ba2f59; font-weight: bold;">Data.Vector</span> <span style="color: #3a81c3; font-weight: bold;">as</span> <span style="color: #ba2f59; font-weight: bold;">V</span>
<span style="color: #3a81c3; font-weight: bold;">import</span> <span style="color: #ba2f59; font-weight: bold;">Statistics.Sample</span>
<span style="color: #3a81c3; font-weight: bold;">import</span> <span style="color: #3a81c3; font-weight: bold;">qualified</span> <span style="color: #ba2f59; font-weight: bold;">System.Random.MWC</span> <span style="color: #3a81c3; font-weight: bold;">as</span> <span style="color: #ba2f59; font-weight: bold;">MWC</span>

<span style="color: #6c3163; font-weight: bold;">sampleMeanBench</span> <span style="color: #715ab1;">::</span> <span style="color: #ba2f59; font-weight: bold;">String</span> <span style="color: #715ab1;">-&gt;</span> <span style="color: #3a81c3;">[</span><span style="color: #ba2f59; font-weight: bold;">Double</span><span style="color: #3a81c3;">]</span> <span style="color: #715ab1;">-&gt;</span> <span style="color: #ba2f59; font-weight: bold;">Benchmark</span>
<span style="color: #6c3163; font-weight: bold;">sampleMeanBench</span> name xs <span style="color: #715ab1;">=</span> bench name <span style="color: #715ab1;">$</span> nf <span style="color: #3a81c3;">(</span>mean <span style="color: #715ab1;">.</span> V.fromList<span style="color: #3a81c3;">)</span> xs

<span style="color: #6c3163; font-weight: bold;">getRandomList</span> <span style="color: #715ab1;">::</span> <span style="color: #ba2f59; font-weight: bold;">Int</span> <span style="color: #715ab1;">-&gt;</span> <span style="color: #ba2f59; font-weight: bold;">IO</span> <span style="color: #3a81c3;">[</span><span style="color: #ba2f59; font-weight: bold;">Double</span><span style="color: #3a81c3;">]</span>
<span style="color: #6c3163; font-weight: bold;">getRandomList</span> n <span style="color: #715ab1;">=</span> <span style="color: #3a81c3; font-weight: bold;">do</span>
  gen <span style="color: #715ab1;">&lt;-</span> MWC.create
  foo <span style="color: #715ab1;">&lt;-</span> replicateM n <span style="color: #3a81c3;">(</span>MWC.uniform gen<span style="color: #3a81c3;">)</span>
  return foo

<span style="color: #2aa1ae; background-color: #ecf3ec;">-- </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Our benchmark harness.</span>
<span style="color: #6c3163; font-weight: bold;">main</span> <span style="color: #715ab1;">=</span>
  defaultMain
    <span style="color: #3a81c3;">[</span> bgroup
        <span style="color: #2d9574;">"meanPure"</span>
        <span style="color: #6c3163;">[</span> sampleMeanBench <span style="color: #2d9574;">"small"</span> <span style="color: #2d9574;">[</span><span style="color: #4e3163;">1</span> <span style="color: #715ab1;">..</span> <span style="color: #4e3163;">10</span><span style="color: #2d9574;">]</span>
        , sampleMeanBench <span style="color: #2d9574;">"medium"</span> <span style="color: #2d9574;">[</span><span style="color: #4e3163;">1</span> <span style="color: #715ab1;">..</span> <span style="color: #4e3163;">100</span><span style="color: #2d9574;">]</span>
        , sampleMeanBench <span style="color: #2d9574;">"large"</span> <span style="color: #2d9574;">[</span><span style="color: #4e3163;">1</span> <span style="color: #715ab1;">..</span> <span style="color: #4e3163;">1000</span><span style="color: #2d9574;">]</span>
        <span style="color: #6c3163;">]</span>
    , bgroup
        <span style="color: #2d9574;">"meanEnv"</span>
        <span style="color: #6c3163;">[</span> env <span style="color: #2d9574;">(</span>getRandomList <span style="color: #4e3163;">10</span><span style="color: #2d9574;">)</span> <span style="color: #2d9574;">(</span><span style="color: #715ab1;">\</span>xs <span style="color: #715ab1;">-&gt;</span> sampleMeanBench <span style="color: #2d9574;">"small"</span> xs<span style="color: #2d9574;">)</span>
        , env <span style="color: #2d9574;">(</span>getRandomList <span style="color: #4e3163;">100</span><span style="color: #2d9574;">)</span> <span style="color: #2d9574;">(</span><span style="color: #715ab1;">\</span>xs <span style="color: #715ab1;">-&gt;</span> sampleMeanBench <span style="color: #2d9574;">"medium"</span> xs<span style="color: #2d9574;">)</span>
        , env <span style="color: #2d9574;">(</span>getRandomList <span style="color: #4e3163;">1000</span><span style="color: #2d9574;">)</span> <span style="color: #2d9574;">(</span><span style="color: #715ab1;">\</span>xs <span style="color: #715ab1;">-&gt;</span> sampleMeanBench <span style="color: #2d9574;">"large"</span> xs<span style="color: #2d9574;">)</span>
        <span style="color: #6c3163;">]</span>
    <span style="color: #3a81c3;">]</span>
</pre>
</div>

<p>
This could be run with the following to get a HTML report as output.
</p>

<pre class="example">
$ stack exec -- criterion-demo --output report.html
</pre>

<p>
Note that in the linear regression results reported, this considers the
relationship between the number of evaluations and the time that required.
</p>
</div>
</div>

<div id="outline-container-orga7d68f5" class="outline-3">
<h3 id="orga7d68f5">Documentation with <code>haddock</code></h3>
<div class="outline-text-3" id="text-orga7d68f5">
</div>
<div id="outline-container-org784c0b7" class="outline-4">
<h4 id="org784c0b7">Language</h4>
<div class="outline-text-4" id="text-org784c0b7">
<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #da8b55;">-- | The </span><span style="color: #da8b55; font-style: italic;">/n/</span><span style="color: #da8b55;">th Fibonacci ... wait for it ...</span>
<span style="color: #da8b55;">-- </span><span style="color: #da8b55; font-weight: bold;">__number__</span>
<span style="color: #6c3163; font-weight: bold;">fib</span> <span style="color: #715ab1;">::</span> <span style="color: #ba2f59; font-weight: bold;">Int</span>  <span style="color: #da8b55;">-- ^ the n</span>
    <span style="color: #715ab1;">-&gt;</span> <span style="color: #ba2f59; font-weight: bold;">Int</span> 
</pre>
</div>

<ul class="org-ul">
<li><code>/italics/</code></li>
<li><code>__bold__</code></li>
<li><code>'hyperlink'</code></li>
<li><code>@monospace@</code></li>
</ul>
</div>
</div>

<div id="outline-container-orgc99b117" class="outline-4">
<h4 id="orgc99b117">Usage</h4>
<div class="outline-text-4" id="text-orgc99b117">
<p>
Build and open documentation in the browser.
</p>

<div class="org-src-container">
<pre class="src src-sh">stack haddock
stack haddock --open
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgadd64ef" class="outline-3">
<h3 id="orgadd64ef">Syntax</h3>
<div class="outline-text-3" id="text-orgadd64ef">
</div>
<div id="outline-container-orgfefc97b" class="outline-4">
<h4 id="orgfefc97b">Basic</h4>
<div class="outline-text-4" id="text-orgfefc97b">
<p>
There is some basic syntax which is easy to forget.
</p>

<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #da8b55;">-- |wild card</span>
<span style="color: #6c3163; font-weight: bold;">f</span> <span style="color: #3a81c3;">(</span><span style="color: #3a81c3; font-weight: bold;">_</span><span style="color: #ba2f59; font-weight: bold;">:</span>xs<span style="color: #3a81c3;">)</span> <span style="color: #715ab1;">=</span> xs

<span style="color: #da8b55;">-- |as-pattern</span>
<span style="color: #6c3163; font-weight: bold;">f</span> l<span style="color: #715ab1;">@</span><span style="color: #3a81c3;">(</span>x<span style="color: #ba2f59; font-weight: bold;">:</span>xs<span style="color: #3a81c3;">)</span> <span style="color: #715ab1;">=</span> x<span style="color: #ba2f59; font-weight: bold;">:</span>l

<span style="color: #da8b55;">-- |guards</span>
<span style="color: #6c3163; font-weight: bold;">f</span> x
  <span style="color: #715ab1;">|</span> x <span style="color: #715ab1;">&lt;</span> <span style="color: #4e3163;">0</span>     <span style="color: #715ab1;">=</span> <span style="color: #4e3163;">0</span>
  <span style="color: #715ab1;">|</span> x <span style="color: #715ab1;">&gt;=</span> <span style="color: #4e3163;">0</span>    <span style="color: #715ab1;">=</span> <span style="color: #4e3163;">1</span>
  <span style="color: #715ab1;">|</span> otherwise <span style="color: #715ab1;">=</span> undefined

<span style="color: #da8b55;">-- |case expression</span>
<span style="color: #6c3163; font-weight: bold;">f</span> x <span style="color: #715ab1;">=</span> <span style="color: #3a81c3; font-weight: bold;">case</span> x <span style="color: #3a81c3; font-weight: bold;">of</span>
  pattern1 <span style="color: #715ab1;">-&gt;</span> expression1
  pattern2 <span style="color: #715ab1;">-&gt;</span> expression2
  <span style="color: #3a81c3; font-weight: bold;">_</span>        <span style="color: #715ab1;">-&gt;</span> undefined

<span style="color: #da8b55;">-- |where clause</span>
<span style="color: #6c3163; font-weight: bold;">f</span> x <span style="color: #715ab1;">=</span> g z
  <span style="color: #3a81c3; font-weight: bold;">where</span>
    z <span style="color: #715ab1;">=</span> epxression

<span style="color: #da8b55;">-- |let expression</span>
<span style="color: #6c3163; font-weight: bold;">f</span> x <span style="color: #715ab1;">=</span> <span style="color: #3a81c3; font-weight: bold;">let</span> z <span style="color: #715ab1;">=</span> expression
      <span style="color: #3a81c3; font-weight: bold;">in</span> g z

<span style="color: #da8b55;">-- |list comprehension</span>
<span style="color: #3a81c3;">[</span>sqrt x <span style="color: #715ab1;">|</span> x <span style="color: #715ab1;">&lt;-</span> <span style="color: #6c3163;">[</span><span style="color: #4e3163;">1</span><span style="color: #715ab1;">..</span><span style="color: #4e3163;">9</span><span style="color: #6c3163;">]</span>, x <span style="color: #715ab1;">&gt;</span> <span style="color: #4e3163;">3</span><span style="color: #3a81c3;">]</span>
</pre>
</div>

<p>
You can use pattern matching to filter in a list comprehension as the following example demonstrates
</p>

<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #3a81c3; font-weight: bold;">data</span> <span style="color: #ba2f59; font-weight: bold;">Foobar</span> <span style="color: #715ab1;">=</span> <span style="color: #ba2f59; font-weight: bold;">Foo</span> <span style="color: #ba2f59; font-weight: bold;">Int</span> <span style="color: #715ab1;">|</span> <span style="color: #ba2f59; font-weight: bold;">Bar</span> <span style="color: #ba2f59; font-weight: bold;">Char</span> <span style="color: #3a81c3; font-weight: bold;">deriving</span> <span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">Show</span><span style="color: #3a81c3;">)</span>

<span style="color: #6c3163; font-weight: bold;">x</span> <span style="color: #715ab1;">=</span> <span style="color: #3a81c3;">[</span><span style="color: #ba2f59; font-weight: bold;">Foo</span> <span style="color: #4e3163;">1</span>, <span style="color: #ba2f59; font-weight: bold;">Bar</span> <span style="color: #2d9574;">'a'</span>, <span style="color: #ba2f59; font-weight: bold;">Foo</span> <span style="color: #4e3163;">2</span>, <span style="color: #ba2f59; font-weight: bold;">Bar</span> <span style="color: #2d9574;">'b'</span><span style="color: #3a81c3;">]</span>

<span style="color: #6c3163; font-weight: bold;">y</span> <span style="color: #715ab1;">=</span> <span style="color: #3a81c3;">[</span>n <span style="color: #715ab1;">|</span> <span style="color: #6c3163;">(</span><span style="color: #ba2f59; font-weight: bold;">Foo</span> n<span style="color: #6c3163;">)</span> <span style="color: #715ab1;">&lt;-</span> x<span style="color: #3a81c3;">]</span>
</pre>
</div>

<p>
In this snippet the variable <code>y</code> has the value <code>[1,2]</code>.
</p>
</div>
</div>

<div id="outline-container-org58fe787" class="outline-4">
<h4 id="org58fe787">Variable names</h4>
<div class="outline-text-4" id="text-org58fe787">
<p>
<i>The Haskell 98 Report</i> says 
</p>

<blockquote>
<p>
Underscore, "_", is treated as a lower-case letter, and can occur
wherever a lower-case letter can. However, "_" all by itself is a
reserved identifier, used as wild card in patterns. Compilers that offer
warnings for unused identifiers are encouraged to suppress such warnings for
identifiers beginning with underscore. This allows programmers to use
"_foo" for a parameter that they expect to be unused.
</p>
</blockquote>
</div>
</div>

<div id="outline-container-org637f9fb" class="outline-4">
<h4 id="org637f9fb">Typeclasses</h4>
<div class="outline-text-4" id="text-org637f9fb">
<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #3a81c3; font-weight: bold;">class</span> <span style="color: #ba2f59; font-weight: bold;">Eq</span> a <span style="color: #3a81c3; font-weight: bold;">where</span>  
    <span style="color: #3a81c3;">(</span><span style="color: #715ab1;">==</span><span style="color: #3a81c3;">)</span> <span style="color: #715ab1;">::</span> a <span style="color: #715ab1;">-&gt;</span> a <span style="color: #715ab1;">-&gt;</span> <span style="color: #ba2f59; font-weight: bold;">Bool</span>  
    <span style="color: #3a81c3;">(</span><span style="color: #715ab1;">/=</span><span style="color: #3a81c3;">)</span> <span style="color: #715ab1;">::</span> a <span style="color: #715ab1;">-&gt;</span> a <span style="color: #715ab1;">-&gt;</span> <span style="color: #ba2f59; font-weight: bold;">Bool</span>  
    x <span style="color: #715ab1;">==</span> y <span style="color: #715ab1;">=</span> not <span style="color: #3a81c3;">(</span>x <span style="color: #715ab1;">/=</span> y<span style="color: #3a81c3;">)</span>  
    x <span style="color: #715ab1;">/=</span> y <span style="color: #715ab1;">=</span> not <span style="color: #3a81c3;">(</span>x <span style="color: #715ab1;">==</span> y<span style="color: #3a81c3;">)</span>  

<span style="color: #3a81c3; font-weight: bold;">data</span> <span style="color: #ba2f59; font-weight: bold;">Foobar</span> <span style="color: #715ab1;">=</span> <span style="color: #ba2f59; font-weight: bold;">Foo</span> <span style="color: #715ab1;">|</span> <span style="color: #ba2f59; font-weight: bold;">Bar</span>

<span style="color: #3a81c3; font-weight: bold;">instance</span> <span style="color: #ba2f59; font-weight: bold;">Eq</span> <span style="color: #ba2f59; font-weight: bold;">Foobar</span> <span style="color: #3a81c3; font-weight: bold;">where</span>
    <span style="color: #ba2f59; font-weight: bold;">Foo</span> <span style="color: #715ab1;">==</span> <span style="color: #ba2f59; font-weight: bold;">Foo</span> <span style="color: #715ab1;">=</span> <span style="color: #ba2f59; font-weight: bold;">True</span>
    <span style="color: #ba2f59; font-weight: bold;">Bar</span> <span style="color: #715ab1;">==</span> <span style="color: #ba2f59; font-weight: bold;">Bar</span> <span style="color: #715ab1;">=</span> <span style="color: #ba2f59; font-weight: bold;">True</span>
    <span style="color: #3a81c3; font-weight: bold;">_</span> <span style="color: #715ab1;">==</span> <span style="color: #3a81c3; font-weight: bold;">_</span> <span style="color: #715ab1;">=</span> <span style="color: #ba2f59; font-weight: bold;">False</span>
</pre>
</div>

<p>
There are cases where a class will have multiple type parameters, e.g. <code>a</code>, <code>b</code>,
and <code>c</code>, but one of them may be determined by the others, <code>c</code> is determined by
<code>a</code> and <code>b</code>. One way to resolve this is by adding type annotations, but this is
unpleasant. <i>Functional dependencies</i> are a way to tell the compiler that <code>c</code> is
determined by <code>a</code> and <code>b</code>. The following snippet gives an example of the syntax
(a vertical bar, <code>|</code>) used to acheive this
</p>

<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #3a81c3; font-weight: bold;">class</span> <span style="color: #ba2f59; font-weight: bold;">Foo</span> a b c <span style="color: #715ab1;">|</span> a b <span style="color: #715ab1;">-&gt;</span> c <span style="color: #3a81c3; font-weight: bold;">where</span> <span style="color: #715ab1;">...</span>
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgee75f8d" class="outline-3">
<h3 id="orgee75f8d">Monad transformers with <code>mtl</code></h3>
<div class="outline-text-3" id="text-orgee75f8d">
</div>
<div id="outline-container-org2d81802" class="outline-4">
<h4 id="org2d81802"><code>ReaderT</code></h4>
<div class="outline-text-4" id="text-org2d81802">
<p>
To avoid explicitly passing environment data around, one can use the <code>ReaderT</code>
monad transformer to add read-only environment. The following example shows the
reader monad transformer in action. 
</p>

<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #3a81c3; font-weight: bold;">import</span> <span style="color: #ba2f59; font-weight: bold;">Control.Monad.Reader</span> <span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">ReaderT</span>, ask, liftIO, runReaderT<span style="color: #3a81c3;">)</span>

<span style="color: #3a81c3; font-weight: bold;">data</span> <span style="color: #ba2f59; font-weight: bold;">Env</span> <span style="color: #715ab1;">=</span> <span style="color: #ba2f59; font-weight: bold;">Env</span> <span style="color: #3a81c3;">{</span> envInput <span style="color: #715ab1;">::</span> <span style="color: #ba2f59; font-weight: bold;">FilePath</span> <span style="color: #3a81c3;">}</span>

<span style="color: #6c3163; font-weight: bold;">step1</span> <span style="color: #715ab1;">::</span> <span style="color: #ba2f59; font-weight: bold;">ReaderT</span> <span style="color: #ba2f59; font-weight: bold;">Env</span> <span style="color: #ba2f59; font-weight: bold;">IO</span> <span style="color: #ba2f59; font-weight: bold;">Int</span>
<span style="color: #6c3163; font-weight: bold;">step1</span> <span style="color: #715ab1;">=</span> <span style="color: #3a81c3; font-weight: bold;">do</span>
  liftIO <span style="color: #715ab1;">$</span> putStrLn <span style="color: #2d9574;">"Greetings from Step 1."</span>
  return <span style="color: #4e3163;">0</span>

<span style="color: #6c3163; font-weight: bold;">step2</span> <span style="color: #715ab1;">::</span> <span style="color: #ba2f59; font-weight: bold;">Int</span> <span style="color: #715ab1;">-&gt;</span> <span style="color: #ba2f59; font-weight: bold;">ReaderT</span> <span style="color: #ba2f59; font-weight: bold;">Env</span> <span style="color: #ba2f59; font-weight: bold;">IO</span> <span style="color: #3a81c3; font-weight: bold;">()</span>
<span style="color: #6c3163; font-weight: bold;">step2</span> n <span style="color: #715ab1;">=</span> <span style="color: #3a81c3; font-weight: bold;">do</span>
  liftIO <span style="color: #715ab1;">$</span> putStrLn <span style="color: #3a81c3;">(</span>show n<span style="color: #3a81c3;">)</span>
  fp <span style="color: #715ab1;">&lt;-</span> envInput <span style="color: #715ab1;">&lt;$&gt;</span> ask
  line <span style="color: #715ab1;">&lt;-</span> liftIO <span style="color: #715ab1;">$</span> readFile fp
  liftIO <span style="color: #715ab1;">$</span> putStr <span style="color: #3a81c3;">(</span><span style="color: #2d9574;">"Autobots, "</span> <span style="color: #715ab1;">++</span> line<span style="color: #3a81c3;">)</span>

<span style="color: #6c3163; font-weight: bold;">main</span> <span style="color: #715ab1;">::</span> <span style="color: #ba2f59; font-weight: bold;">IO</span> <span style="color: #3a81c3; font-weight: bold;">()</span>
<span style="color: #6c3163; font-weight: bold;">main</span> <span style="color: #715ab1;">=</span> <span style="color: #3a81c3; font-weight: bold;">do</span>
  runReaderT <span style="color: #3a81c3;">(</span>step1 <span style="color: #715ab1;">&gt;&gt;=</span> step2<span style="color: #3a81c3;">)</span> <span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">Env</span> <span style="color: #2d9574;">"autobots.txt"</span><span style="color: #3a81c3;">)</span>
</pre>
</div>

<p>
The <code>main</code> function sets up an environment which is passes to Step 1 which puts
a value of 0 in the monad. Then in the second function the value is printed and
the contents of the file referenced in the environment is printed out, i.e., the
file <code>autobots.txt</code> which just contains a single line with "roll out". Running
this in the REPL gives the following output.
</p>

<pre class="example">
λ&gt; main
Greetings from Step 1.
0
Autobots, roll out
</pre>
</div>
</div>

<div id="outline-container-orgf4ce313" class="outline-4">
<h4 id="orgf4ce313"><code>ReaderT</code> on <code>ExceptT</code></h4>
<div class="outline-text-4" id="text-orgf4ce313">
<p>
The example above using the reader monad transformer can be extended to improve
the error handling in the case where the file path in the environment does not
exist.
</p>

<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #3a81c3; font-weight: bold;">import</span> <span style="color: #ba2f59; font-weight: bold;">Control.Monad.Except</span> <span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">ExceptT</span>, runExceptT, throwError<span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3; font-weight: bold;">import</span> <span style="color: #ba2f59; font-weight: bold;">Control.Monad.Reader</span> <span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">ReaderT</span>, asks, liftIO, runReaderT<span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3; font-weight: bold;">import</span> <span style="color: #ba2f59; font-weight: bold;">System.Directory</span> <span style="color: #3a81c3;">(</span>doesFileExist<span style="color: #3a81c3;">)</span>

<span style="color: #3a81c3; font-weight: bold;">newtype</span> <span style="color: #ba2f59; font-weight: bold;">Env</span> <span style="color: #715ab1;">=</span> <span style="color: #ba2f59; font-weight: bold;">Env</span> <span style="color: #3a81c3;">{</span> envInput <span style="color: #715ab1;">::</span> <span style="color: #ba2f59; font-weight: bold;">FilePath</span> <span style="color: #3a81c3;">}</span>

<span style="color: #3a81c3; font-weight: bold;">type</span> <span style="color: #ba2f59; font-weight: bold;">Robot</span> a <span style="color: #715ab1;">=</span> <span style="color: #ba2f59; font-weight: bold;">ReaderT</span> <span style="color: #ba2f59; font-weight: bold;">Env</span> <span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">ExceptT</span> <span style="color: #ba2f59; font-weight: bold;">String</span> <span style="color: #ba2f59; font-weight: bold;">IO</span><span style="color: #3a81c3;">)</span> a

<span style="color: #6c3163; font-weight: bold;">runRobot</span> <span style="color: #715ab1;">::</span> <span style="color: #ba2f59; font-weight: bold;">Robot</span> a <span style="color: #715ab1;">-&gt;</span> <span style="color: #ba2f59; font-weight: bold;">Env</span> <span style="color: #715ab1;">-&gt;</span> <span style="color: #ba2f59; font-weight: bold;">IO</span> <span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">Either</span> <span style="color: #ba2f59; font-weight: bold;">String</span> a<span style="color: #3a81c3;">)</span>
<span style="color: #6c3163; font-weight: bold;">runRobot</span> robot env <span style="color: #715ab1;">=</span> runExceptT <span style="color: #3a81c3;">(</span>runReaderT robot env<span style="color: #3a81c3;">)</span>

<span style="color: #6c3163; font-weight: bold;">step1</span> <span style="color: #715ab1;">::</span> <span style="color: #ba2f59; font-weight: bold;">Robot</span> <span style="color: #ba2f59; font-weight: bold;">Int</span>
<span style="color: #6c3163; font-weight: bold;">step1</span> <span style="color: #715ab1;">=</span> <span style="color: #3a81c3; font-weight: bold;">do</span>
  liftIO <span style="color: #715ab1;">$</span> putStrLn <span style="color: #2d9574;">"Greetings from Step 1."</span>
  return <span style="color: #4e3163;">0</span>

<span style="color: #6c3163; font-weight: bold;">step2</span> <span style="color: #715ab1;">::</span> <span style="color: #ba2f59; font-weight: bold;">Int</span> <span style="color: #715ab1;">-&gt;</span> <span style="color: #ba2f59; font-weight: bold;">Robot</span> <span style="color: #3a81c3; font-weight: bold;">()</span>
<span style="color: #6c3163; font-weight: bold;">step2</span> n <span style="color: #715ab1;">=</span> <span style="color: #3a81c3; font-weight: bold;">do</span>
  liftIO <span style="color: #715ab1;">$</span> print n
  fp <span style="color: #715ab1;">&lt;-</span> asks envInput
  exists <span style="color: #715ab1;">&lt;-</span> liftIO <span style="color: #715ab1;">$</span> doesFileExist fp
  <span style="color: #3a81c3; font-weight: bold;">if</span> exists
  <span style="color: #3a81c3; font-weight: bold;">then</span> <span style="color: #3a81c3; font-weight: bold;">do</span> line <span style="color: #715ab1;">&lt;-</span> liftIO <span style="color: #715ab1;">$</span> readFile fp
          liftIO <span style="color: #715ab1;">$</span> putStr <span style="color: #3a81c3;">(</span><span style="color: #2d9574;">"Autobots, "</span> <span style="color: #715ab1;">++</span> line<span style="color: #3a81c3;">)</span>
  <span style="color: #3a81c3; font-weight: bold;">else</span> throwError <span style="color: #2d9574;">"Could not find file in step 2"</span>
</pre>
</div>

<p>
The <code>main</code> function has been remove but there is not much added code here.
Running the <code>runRobot</code> function in the REPL we get the following results which
demonstrate how the failure path evaluates.
</p>

<pre class="example">
λ&gt; runRobot (step1 &gt;&gt;= step2) (Env "autobots.txt")
Greetings from Step 1.
0
Autobots, roll out
Right ()
λ&gt; runRobot (step1 &gt;&gt;= step2) (Env "autobats.txt")
Greetings from Step 1.
0
Left "Could not find file in step 2"
</pre>
</div>
</div>
</div>

<div id="outline-container-orgda13fca" class="outline-3">
<h3 id="orgda13fca">Data structures</h3>
<div class="outline-text-3" id="text-orgda13fca">
</div>
<div id="outline-container-org7d102cf" class="outline-4">
<h4 id="org7d102cf">Numbers</h4>
<div class="outline-text-4" id="text-org7d102cf">

<div id="orgfeadc12" class="figure">
<p><img src="../images/numeric-tower-haskell.png" alt="numeric-tower-haskell.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-orgb640a74" class="outline-4">
<h4 id="orgb640a74"><code>Int</code> and <code>Word</code></h4>
<div class="outline-text-4" id="text-orgb640a74">
<p>
The package <code>Data.Int</code> provides signed integers and <code>Data.Word</code> provides
unsigned integers. The latter may be useful to encode that the number has to be
positive at the type level.
</p>
</div>
</div>
<div id="outline-container-org94d1c3b" class="outline-4">
<h4 id="org94d1c3b">Semigroup</h4>
<div class="outline-text-4" id="text-org94d1c3b">
<p>
A <i>semigroup</i> is a set with an associative binary operation. In <code>base</code> this type
class, <code>Data.Semigroup</code>, requires a function <code>&lt;&gt;</code>, and instances of this function must be
associative.
</p>
</div>
</div>
<div id="outline-container-org3996fd7" class="outline-4">
<h4 id="org3996fd7">Monoid</h4>
<div class="outline-text-4" id="text-org3996fd7">
<p>
A <i>monoid</i> is a semigroup which has an identity element. In <code>base</code> this type
class, <code>Data.Monoid</code>, requires the function <code>&lt;&gt;</code>, as in semigroup, and <code>mempty</code>
for the identity element. The <code>mempty</code> must be both a left and right identity.
</p>
<ul class="org-ul">
<li><code>Data.List.NonEmpty</code> (in <code>base</code>) for non-empty lists to avoid run time errors
due to bad calls to <code>head</code> or <code>tail</code>.</li>
<li><code>containers</code> has several efficient data structures that can be used as an
alternative to lists.
<ul class="org-ul">
<li><code>Data.Map</code> for look-up tables</li>
<li><code>Data.Sequence</code> if you finite lists you can access from both ends</li>
<li><code>Data.Set</code> for sets of elements in <code>Eq</code> and <code>Ord</code></li>
</ul></li>
<li><code>vector</code> has vectors.</li>
</ul>
</div>
</div>
<div id="outline-container-org7899406" class="outline-4">
<h4 id="org7899406">Foldable</h4>
<div class="outline-text-4" id="text-org7899406">
<p>
A data structure that reduced to a single summary value: <code>foldr :: (a -&gt; b -&gt; b)
-&gt; b -&gt; t a -&gt; b</code>. For example, you might add up all the values on a tree where
each node has a value. When the data form a monoid <code>foldMap</code> can be implemented
instead which just uses the monoid's addition.
</p>
</div>
</div>
<div id="outline-container-org84f3cab" class="outline-4">
<h4 id="org84f3cab">Traversable</h4>
<div class="outline-text-4" id="text-org84f3cab">
<p>
Like a more powerful functor: <code>traverse :: Applicative f =&gt; (a -&gt; f b) -&gt; t a -&gt;
f (t b)</code>
</p>
</div>
</div>
</div>

<div id="outline-container-org9abc739" class="outline-3">
<h3 id="org9abc739"><code>ST</code> monad</h3>
<div class="outline-text-3" id="text-org9abc739">
<p>
A classic example of the <code>ST</code> monad is 
</p>

<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #3a81c3; font-weight: bold;">import</span> <span style="color: #ba2f59; font-weight: bold;">Control.Monad.ST</span>
<span style="color: #3a81c3; font-weight: bold;">import</span> <span style="color: #ba2f59; font-weight: bold;">Data.STRef</span>
<span style="color: #3a81c3; font-weight: bold;">import</span> <span style="color: #ba2f59; font-weight: bold;">Data.Foldable</span>

<span style="color: #6c3163; font-weight: bold;">sumST</span> <span style="color: #715ab1;">::</span> <span style="color: #ba2f59; font-weight: bold;">Num</span> a <span style="color: #715ab1;">=&gt;</span> <span style="color: #3a81c3;">[</span>a<span style="color: #3a81c3;">]</span> <span style="color: #715ab1;">-&gt;</span> a
<span style="color: #6c3163; font-weight: bold;">sumST</span> xs <span style="color: #715ab1;">=</span> runST <span style="color: #715ab1;">$</span> <span style="color: #3a81c3; font-weight: bold;">do</span>
    n <span style="color: #715ab1;">&lt;-</span> newSTRef <span style="color: #4e3163;">0</span>
    for_ xs <span style="color: #715ab1;">$</span> <span style="color: #715ab1;">\</span>x <span style="color: #715ab1;">-&gt;</span>
        modifySTRef n <span style="color: #3a81c3;">(</span><span style="color: #715ab1;">+</span>x<span style="color: #3a81c3;">)</span>
    readSTRef n
</pre>
</div>

<p>
<del>in strange situations</del> sometimes a while loop would be nice as well.
The following function can help with this
</p>

<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #6c3163; font-weight: bold;">whileM_</span> <span style="color: #715ab1;">::</span> <span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">Monad</span> m<span style="color: #3a81c3;">)</span> <span style="color: #715ab1;">=&gt;</span> m <span style="color: #ba2f59; font-weight: bold;">Bool</span> <span style="color: #715ab1;">-&gt;</span> m a <span style="color: #715ab1;">-&gt;</span> m <span style="color: #3a81c3; font-weight: bold;">()</span>
<span style="color: #6c3163; font-weight: bold;">whileM_</span> p f <span style="color: #715ab1;">=</span> go
    <span style="color: #3a81c3; font-weight: bold;">where</span> go <span style="color: #715ab1;">=</span> <span style="color: #3a81c3; font-weight: bold;">do</span>
            x <span style="color: #715ab1;">&lt;-</span> p
            <span style="color: #3a81c3; font-weight: bold;">if</span> x
                <span style="color: #3a81c3; font-weight: bold;">then</span> f <span style="color: #715ab1;">&gt;&gt;</span> go
                <span style="color: #3a81c3; font-weight: bold;">else</span> return <span style="color: #3a81c3; font-weight: bold;">()</span>
</pre>
</div>

<p>
We can re-write the <code>sumST</code> function using this as follows.
</p>

<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #6c3163; font-weight: bold;">sumST'</span> <span style="color: #715ab1;">::</span> <span style="color: #ba2f59; font-weight: bold;">Num</span> a <span style="color: #715ab1;">=&gt;</span> <span style="color: #3a81c3;">[</span>a<span style="color: #3a81c3;">]</span> <span style="color: #715ab1;">-&gt;</span> a
<span style="color: #6c3163; font-weight: bold;">sumST'</span> xs <span style="color: #715ab1;">=</span> runST <span style="color: #715ab1;">$</span> <span style="color: #3a81c3; font-weight: bold;">do</span>
  n <span style="color: #715ab1;">&lt;-</span> newSTRef <span style="color: #4e3163;">0</span>
  p <span style="color: #715ab1;">&lt;-</span> newSTRef <span style="color: #3a81c3;">(</span>not <span style="color: #715ab1;">$</span> null xs<span style="color: #3a81c3;">)</span>
  i <span style="color: #715ab1;">&lt;-</span> newSTRef <span style="color: #4e3163;">0</span>
  m <span style="color: #715ab1;">&lt;-</span> pure <span style="color: #715ab1;">$</span> length xs
  whileM_ <span style="color: #3a81c3;">(</span>readSTRef p<span style="color: #3a81c3;">)</span> <span style="color: #715ab1;">$</span> <span style="color: #3a81c3; font-weight: bold;">do</span>
    ix <span style="color: #715ab1;">&lt;-</span> readSTRef i
    modifySTRef n <span style="color: #3a81c3;">(</span><span style="color: #715ab1;">+</span> <span style="color: #6c3163;">(</span>xs <span style="color: #715ab1;">!!</span> ix<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
    modifySTRef i <span style="color: #3a81c3;">(</span><span style="color: #715ab1;">+</span> <span style="color: #4e3163;">1</span><span style="color: #3a81c3;">)</span>
    modifySTRef p <span style="color: #3a81c3;">(</span><span style="color: #715ab1;">\</span><span style="color: #3a81c3; font-weight: bold;">_</span> <span style="color: #715ab1;">-&gt;</span> <span style="color: #6c3163;">(</span>ix <span style="color: #715ab1;">+</span> <span style="color: #4e3163;">1</span> <span style="color: #715ab1;">&lt;</span> m<span style="color: #6c3163;">)</span><span style="color: #3a81c3;">)</span>
  readSTRef n
</pre>
</div>
</div>
</div>

<div id="outline-container-orga79116a" class="outline-3">
<h3 id="orga79116a">Linting <code>hindent</code></h3>
<div class="outline-text-3" id="text-orga79116a">
<p>
<code>hindent</code> is a pretty printer which can be used to lint Haskell code.
Install it with <code>stack install hindent</code> and pay attention to where it installs because you need that on your path.
There is an Emacs minor mode, <code>hindent-mode</code>, which exposes the functionality of this program: <code>hindent-reformat-*</code>.
</p>

<p>
I have the following shortcuts:
</p>

<ul class="org-ul">
<li><code>SPC o h h r</code> owner haskell hindent region</li>
<li><code>SPC o h h b</code> owner haskell hindent buffer</li>
</ul>
</div>
</div>

<div id="outline-container-org1a3f118" class="outline-3">
<h3 id="org1a3f118">JSON with Aeson</h3>
<div class="outline-text-3" id="text-org1a3f118">
<p>
<code>aeson</code> is <i>the</i> package for working with JSON. The important functions provided
are <code>encode</code> and <code>decode</code> and the typeclasses <code>ToJson</code> and <code>FromJson</code> which
ensure a type can be encoded and decoded. They can be derived automatically
along with <code>Generic</code>, although this requires the <code>DeriveGeneric</code> and
<code>DeriveAnyClass</code> extensions to be include. The <code>OverloadedStrings</code> is also very
useful to include. In addition to loading <code>import Data.Aeson as JSON</code> you need
to <code>import GHC.Generics</code>. This stuff tends to work with lazy bytestrings, so
there may be a little bit of messing around to get that working but it is not
too bad.
</p>

<p>
<b>Note</b> that when decoding an object from a JSON file, the order of the key-value
pairs in the JSON does not matter, nor does the existance of additional fields
provided the important ones can be parsed correctly.
</p>

<p>
There is a useful <a href="https://williamyaoh.com/posts/2019-10-19-a-cheatsheet-to-json-handling.html">cheatsheet</a> on parsing JSON from William Yao which may be worth
looking at.
</p>
</div>
</div>

<div id="outline-container-orgbdc9004" class="outline-3">
<h3 id="orgbdc9004">Haskell layer in Spacemacs</h3>
<div class="outline-text-3" id="text-orgbdc9004">
<p>
To enable the <a href="https://github.com/syl20bnr/spacemacs/tree/master/layers/%2Blang/haskell">Haskell layer</a> add the following to <code>dotspacemacs-configuration-layers</code>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #3a81c3;">(</span>haskell <span style="color: #3a81c3;">:variables</span>
         haskell-enable-hindent-style <span style="color: #2d9574;">"johan-tibell"</span>
         haskell-process-type 'stack-ghci<span style="color: #3a81c3;">)</span>
</pre>
</div>

<p>
If you want to make use of <code>hindent</code>, you'll need to make sure that the executable is on the path Emacs uses: <code>exec-path</code> or <code>eshell-path-env</code>.
</p>
</div>
</div>

<div id="outline-container-orgbc15a80" class="outline-3">
<h3 id="orgbc15a80">GHC extensions</h3>
<div class="outline-text-3" id="text-orgbc15a80">
</div>
<div id="outline-container-orgf492c12" class="outline-4">
<h4 id="orgf492c12"><a href="https://downloads.haskell.org/~ghc/8.2.1/docs/html/users_guide/glasgow_exts.html#overloaded-string-literals"><code>OverloadedStrings</code></a></h4>
<div class="outline-text-4" id="text-orgf492c12">
<p>
Allows you to use string literals to mean other string-ey type things.
For instance, this would be useful when working with <code>Text</code>.
</p>
</div>
</div>
<div id="outline-container-orgb3111b5" class="outline-4">
<h4 id="orgb3111b5"><a href="https://ocharles.org.uk/posts/2014-12-04-record-wildcards.html"><code>RecordWildcards</code></a></h4>
<div class="outline-text-4" id="text-orgb3111b5">
<p>
Neat syntax for pattern matching a record based on its field names.
</p>
</div>
</div>
<div id="outline-container-org6a663d0" class="outline-4">
<h4 id="org6a663d0"><a href="https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#unicode-syntax"><code>UnicodeSyntax</code></a></h4>
<div class="outline-text-4" id="text-org6a663d0">
<p>
This allows you to make use of Unicode characters in your code which is
particularly nice if you are going a verbatim translation of some mathematics.
Emacs provides a nice way to make it easy to <a href="https://www.gnu.org/software/emacs/manual/html_node/emacs/Select-Input-Method.html">input Unicode</a> but to make it even
easier, I've added the following bindings.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Set the input method to TeX so typing TeX defaults to the Unicode.</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">Use C-\ to escape this input method.</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;">;; </span><span style="color: #2aa1ae; background-color: #ecf3ec;">MNEMONIC: owner-haskell-unicode</span>
<span style="color: #3a81c3;">(</span>spacemacs/set-leader-keys <span style="color: #2d9574;">"ohu"</span> 'set-input-method<span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc033725" class="outline-4">
<h4 id="orgc033725"><a href="https://gitlab.haskell.org/ghc/ghc/-/wikis/overloaded-lists"><code>OverloadedLists</code></a></h4>
<div class="outline-text-4" id="text-orgc033725">
<p>
This desugars list syntax to make it easier to use list syntax to construct
things.
</p>

<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #6c3163;">{-# LANGUAGE OverloadedLists #-}</span>

<span style="color: #6c3163; font-weight: bold;">foo</span> <span style="color: #715ab1;">=</span> <span style="color: #3a81c3;">[</span><span style="color: #6c3163;">(</span><span style="color: #4e3163;">1</span>,<span style="color: #4e3163;">2</span><span style="color: #6c3163;">)</span>,<span style="color: #6c3163;">(</span><span style="color: #4e3163;">2</span>,<span style="color: #4e3163;">3</span><span style="color: #6c3163;">)</span><span style="color: #3a81c3;">]</span> <span style="color: #715ab1;">::</span> <span style="color: #ba2f59; font-weight: bold;">Map</span> <span style="color: #ba2f59; font-weight: bold;">Int</span> <span style="color: #ba2f59; font-weight: bold;">Int</span>
</pre>
</div>

<p>
This will only work with the <code>OverloadedLists</code> extension.
</p>
</div>
</div>
</div>
<div id="outline-container-org8436955" class="outline-3">
<h3 id="org8436955">GHC extensions: <code>DeriveX</code></h3>
<div class="outline-text-3" id="text-org8436955">
<ul class="org-ul">
<li><code>DeriveFunctor</code></li>
<li><code>DeriveFoldable</code></li>
<li><code>DeriveTraversable</code></li>
<li><code>GeneralizedNewtypeDeriving</code> to make better use of <code>newtype</code>.</li>
</ul>
</div>
</div>

<div id="outline-container-org447016e" class="outline-3">
<h3 id="org447016e">Packages I like</h3>
<div class="outline-text-3" id="text-org447016e">
</div>
<div id="outline-container-org7251c9d" class="outline-4">
<h4 id="org7251c9d"><a href="http://hackage.haskell.org/package/ad"><code>ad</code></a>: combinators for automatic differentiation</h4>
</div>
<div id="outline-container-org738805e" class="outline-4">
<h4 id="org738805e"><a href="https://hackage.haskell.org/package/aeson"><code>aeson</code></a>: a JSON parsing and encoding library</h4>
</div>
<div id="outline-container-org1a60f24" class="outline-4">
<h4 id="org1a60f24"><a href="https://hackage.haskell.org/package/cassava"><code>cassava</code></a>: parsing and encoding RFC 4180 compliant CSV data</h4>
<div class="outline-text-4" id="text-org1a60f24">
<p>
One example of using <code>cassava</code> is to make the <code>Chain</code> type from <code>mcmc-types</code> an
instance of <code>ToRecord</code> which makes it easier to write MCMC samples to a CSV. The
following snippet demonstrates how you might do this with an orphan-instance.
</p>

<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #3a81c3; font-weight: bold;">import</span> <span style="color: #ba2f59; font-weight: bold;">Data.Csv</span>
<span style="color: #3a81c3; font-weight: bold;">import</span> <span style="color: #ba2f59; font-weight: bold;">Data.Maybe</span> <span style="color: #3a81c3;">(</span>fromMaybe<span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3; font-weight: bold;">import</span> <span style="color: #3a81c3; font-weight: bold;">qualified</span> <span style="color: #ba2f59; font-weight: bold;">Data.Vector</span> <span style="color: #3a81c3; font-weight: bold;">as</span> <span style="color: #ba2f59; font-weight: bold;">V</span>

<span style="color: #3a81c3; font-weight: bold;">instance</span> <span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">ToRecord</span> a, <span style="color: #ba2f59; font-weight: bold;">ToRecord</span> b<span style="color: #3a81c3;">)</span> <span style="color: #715ab1;">=&gt;</span> <span style="color: #ba2f59; font-weight: bold;">ToRecord</span> <span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">Chain</span> a b<span style="color: #3a81c3;">)</span> <span style="color: #3a81c3; font-weight: bold;">where</span>
  toRecord <span style="color: #ba2f59; font-weight: bold;">Chain</span> <span style="color: #3a81c3;">{</span><span style="color: #715ab1;">..</span><span style="color: #3a81c3;">}</span> <span style="color: #715ab1;">=</span>
    V.concat
      <span style="color: #3a81c3;">[</span> <span style="color: #6c3163;">(</span>record <span style="color: #2d9574;">[</span>toField chainScore<span style="color: #2d9574;">]</span><span style="color: #6c3163;">)</span>
      , <span style="color: #6c3163;">(</span>toRecord chainPosition<span style="color: #6c3163;">)</span>
      , fromMaybe V.empty <span style="color: #6c3163;">(</span>toRecord <span style="color: #715ab1;">&lt;$&gt;</span> chainTunables<span style="color: #6c3163;">)</span>
      <span style="color: #3a81c3;">]</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orge88bf30" class="outline-4">
<h4 id="orge88bf30"><a href="https://hackage.haskell.org/package/math-functions"><code>math-functions</code></a>: various utilities for numerical computing</h4>
</div>
<div id="outline-container-org78f107a" class="outline-4">
<h4 id="org78f107a"><a href="https://hackage.haskell.org/package/moo"><code>moo</code></a>: provides building blocks to build genetic algorithms</h4>
</div>
<div id="outline-container-orge8c6d4a" class="outline-4">
<h4 id="orge8c6d4a"><a href="https://hackage.haskell.org/package/monad-par"><code>monad-par</code></a> which makes use of combinators in <a href="https://hackage.haskell.org/package/monad-par-extras"><code>monad-par-extras</code></a></h4>
<div class="outline-text-4" id="text-orge8c6d4a">
<p>
Without knowing anything about how this works internally, the following functions should be sufficient for running a map type computation in parallel.
</p>

<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #3a81c3; font-weight: bold;">import</span> <span style="color: #ba2f59; font-weight: bold;">Control.Monad.Par</span> <span style="color: #3a81c3;">(</span>runPar<span style="color: #3a81c3;">)</span>
<span style="color: #3a81c3; font-weight: bold;">import</span> <span style="color: #ba2f59; font-weight: bold;">Control.Monad.Par.Combinator</span> <span style="color: #3a81c3;">(</span>parMap<span style="color: #3a81c3;">)</span>

<span style="color: #3a81c3; font-weight: bold;">data</span> <span style="color: #ba2f59; font-weight: bold;">Par</span> a

<span style="color: #6c3163; font-weight: bold;">runPar</span> <span style="color: #715ab1;">::</span> <span style="color: #ba2f59; font-weight: bold;">Par</span> a <span style="color: #715ab1;">-&gt;</span> a
<span style="color: #6c3163; font-weight: bold;">parMap</span> <span style="color: #715ab1;">::</span> <span style="color: #ba2f59; font-weight: bold;">Traversable</span> t <span style="color: #715ab1;">=&gt;</span> <span style="color: #3a81c3;">(</span>a <span style="color: #715ab1;">-&gt;</span> b<span style="color: #3a81c3;">)</span> <span style="color: #715ab1;">-&gt;</span> t a <span style="color: #715ab1;">-&gt;</span> p <span style="color: #3a81c3;">(</span>t b<span style="color: #3a81c3;">)</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcbe83d6" class="outline-4">
<h4 id="orgcbe83d6"><a href="https://hackage.haskell.org/package/statistics"><code>statistics</code></a>: common functions and types useful in statistics</h4>
</div>
</div>

<div id="outline-container-org657981f" class="outline-3">
<h3 id="org657981f">Type theory</h3>
<div class="outline-text-3" id="text-org657981f">
<p>
See my <a href="./type-theory-notes.html">type theory notes</a>
</p>
</div>
</div>
</div>

<div id="outline-container-org2ddd1c0" class="outline-2">
<h2 id="org2ddd1c0">Hackage</h2>
<div class="outline-text-2" id="text-org2ddd1c0">
</div>
<div id="outline-container-orga61f174" class="outline-3">
<h3 id="orga61f174">Notes about uploading a package to hackage</h3>
<div class="outline-text-3" id="text-orga61f174">
<ul class="org-ul">
<li>Once a package is uploaded, it is there forever so make sure it is correct,
that is why there is the package candidate system.</li>
<li>The utility <code>cabal gen-bounds</code> makes it easy to generate suitable bounds on
dependency versions. To keep the version bounds DRY you only need to specify
them on their first occurrence in the cabal file.</li>
<li>There is a cabal <code>sdist</code> utility to zip up a package prior to submission.</li>
<li>When a package is updated the <i>package versioning policy</i> should be used to
update the package version. There is a useful <a href="https://pvp.haskell.org/#decision-tree">decision tree</a> to help you apply
this policy. A version must be of the form <code>A.B.C</code> with an optional suffix of
<code>.D</code>.</li>
<li>The command <code>stack sdist</code> will check the package for common mistakes and
produce a tarball ready for uploading. When a package is uploaded, it may take
a while for the documentation to be build and uploaded.</li>
<li>To use the uploaded package before it has made it onto stackage you can copy
the link for the tarball into <code>extra-deps</code> in the stack YAML file.</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org2c2b0ae" class="outline-2">
<h2 id="org2c2b0ae">Haskell for science</h2>
<div class="outline-text-2" id="text-org2c2b0ae">
</div>
<div id="outline-container-orgb140f27" class="outline-3">
<h3 id="orgb140f27">Optimisation</h3>
<div class="outline-text-3" id="text-orgb140f27">
<p>
Use <code>moo</code> for a rough estimate.
</p>
</div>
</div>
<div id="outline-container-orgaf64ec8" class="outline-3">
<h3 id="orgaf64ec8">Root finding</h3>
<div class="outline-text-3" id="text-orgaf64ec8">
<p>
Use <code>statistics</code> for finding roots if you know a bounding interval, with or without derivatives, both Ridders and Newton have good convergence.
</p>
</div>
</div>
<div id="outline-container-org2378bf5" class="outline-3">
<h3 id="org2378bf5">Differential equations</h3>
<div class="outline-text-3" id="text-org2378bf5">
<p>
Consider
</p>

<p>
\[
\frac{dx}{dt} = \alpha x(t), \quad x(0) = x_0
\]
</p>

<p>
This example needs <code>hmatrix</code> and <code>hmatrix-gsl</code>.
</p>

<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #3a81c3; font-weight: bold;">import</span> <span style="color: #ba2f59; font-weight: bold;">Numeric.GSL.ODE</span>
<span style="color: #3a81c3; font-weight: bold;">import</span> <span style="color: #ba2f59; font-weight: bold;">Numeric.LinearAlgebra</span>
<span style="color: #3a81c3; font-weight: bold;">import</span> <span style="color: #ba2f59; font-weight: bold;">Numeric.LinearAlgebra.Data</span>

<span style="color: #6c3163; font-weight: bold;">alpha</span> <span style="color: #715ab1;">=</span> <span style="color: #4e3163;">0.1</span>

<span style="color: #6c3163; font-weight: bold;">xdash</span> <span style="color: #3a81c3; font-weight: bold;">_</span> <span style="color: #3a81c3;">[</span>x<span style="color: #3a81c3;">]</span> <span style="color: #715ab1;">=</span> <span style="color: #3a81c3;">[</span>x <span style="color: #715ab1;">*</span> alpha<span style="color: #3a81c3;">]</span>

<span style="color: #6c3163; font-weight: bold;">x0</span> <span style="color: #715ab1;">=</span> <span style="color: #4e3163;">1.0</span>

<span style="color: #6c3163; font-weight: bold;">ts</span> <span style="color: #715ab1;">=</span> linspace <span style="color: #4e3163;">100</span> <span style="color: #3a81c3;">(</span><span style="color: #4e3163;">0</span>,<span style="color: #4e3163;">3</span><span style="color: #3a81c3;">)</span>

<span style="color: #6c3163; font-weight: bold;">numericSol</span> <span style="color: #715ab1;">=</span> odeSolve xdash <span style="color: #3a81c3;">[</span>x0<span style="color: #3a81c3;">]</span> ts

<span style="color: #6c3163; font-weight: bold;">exactSol</span> <span style="color: #715ab1;">=</span> asColumn <span style="color: #715ab1;">$</span> x0' <span style="color: #715ab1;">*</span> exp <span style="color: #3a81c3;">(</span>alpha' <span style="color: #715ab1;">*</span> ts<span style="color: #3a81c3;">)</span>
  <span style="color: #3a81c3; font-weight: bold;">where</span>
    x0' <span style="color: #715ab1;">=</span> scalar x0
    alpha' <span style="color: #715ab1;">=</span> scalar alpha


<span style="color: #6c3163; font-weight: bold;">main</span> <span style="color: #715ab1;">::</span> <span style="color: #ba2f59; font-weight: bold;">IO</span> <span style="color: #3a81c3; font-weight: bold;">()</span>
<span style="color: #6c3163; font-weight: bold;">main</span> <span style="color: #715ab1;">=</span>
  <span style="color: #3a81c3; font-weight: bold;">if</span> maxElement <span style="color: #3a81c3;">(</span>numericSol <span style="color: #715ab1;">-</span> exactSol<span style="color: #3a81c3;">)</span> <span style="color: #715ab1;">&lt;</span> <span style="color: #4e3163;">1e-10</span>
    <span style="color: #3a81c3; font-weight: bold;">then</span> putStrLn <span style="color: #2d9574;">"They are equal!"</span>
    <span style="color: #3a81c3; font-weight: bold;">else</span> putStrLn <span style="color: #2d9574;">"Huge error :("</span>
</pre>
</div>
</div>
</div>

<div id="outline-container-orga6232d5" class="outline-3">
<h3 id="orga6232d5">Random number simulation</h3>
<div class="outline-text-3" id="text-orga6232d5">
<div class="org-src-container">
<pre class="src src-haskell"><span style="color: #3a81c3; font-weight: bold;">import</span> <span style="color: #ba2f59; font-weight: bold;">System.Random.MWC</span>

<span style="color: #6c3163; font-weight: bold;">foobar</span> <span style="color: #715ab1;">::</span> <span style="color: #ba2f59; font-weight: bold;">IO</span> <span style="color: #3a81c3;">(</span><span style="color: #ba2f59; font-weight: bold;">Double</span>,<span style="color: #ba2f59; font-weight: bold;">Double</span><span style="color: #3a81c3;">)</span>
<span style="color: #6c3163; font-weight: bold;">foobar</span> <span style="color: #715ab1;">=</span> <span style="color: #3a81c3; font-weight: bold;">do</span>
  gen <span style="color: #715ab1;">&lt;-</span> create
  x1 <span style="color: #715ab1;">&lt;-</span> uniform gen
  x2 <span style="color: #715ab1;">&lt;-</span> uniform gen
  return <span style="color: #3a81c3;">(</span>x1,x2<span style="color: #3a81c3;">)</span>
</pre>
</div>

<p>
This returns a pair of <i>different</i> numbers because it is working in an instance of <code>PrimMonad</code> and managing the state between uses of <code>gen</code>.
Multiple calls to this function always return the same values because the <code>create</code> function starts with a hardcoded seed in the library.
</p>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Alex Zarebski</p>
<p class="date">Created: 2020-10-15 Thu 16:04</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
