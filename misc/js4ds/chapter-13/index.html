<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2022-04-15 Fri 12:30 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>aez-notes-js4ds</title>
<meta name="author" content="Alex Zarebski" />
<meta name="generator" content="Org Mode" />
<style>
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
</style>
<link id="stylesheet" rel="stylesheet" type="text/css" href="../../../css/stylesheet.css" />
</head>
<body>
<div id="content" class="content">
<h1 class="title">aez-notes-js4ds</h1>
<p>
<a href="../../../index.html">Home</a>
</p>

<p>
<a href="../index.html">Chapter listing</a>
</p>

<div id="outline-container-org1bc25bd" class="outline-2">
<h2 id="org1bc25bd">Testing</h2>
<div class="outline-text-2" id="text-org1bc25bd">
</div>
<div id="outline-container-orgc90d0b2" class="outline-3">
<h3 id="orgc90d0b2">Set up</h3>
<div class="outline-text-3" id="text-orgc90d0b2">
<div class="org-src-container">
<pre class="src src-sh">mkdir testing
<span style="color: #3a81c3;">cd</span> testing
npm init -y
npm install cheerio express mocha supertest
mkdir test
touch test/my_tests.js
touch standalone.js
touch server.js
<span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">include the testing code</span>
<span style="color: #2aa1ae; background-color: #ecf3ec;"># </span><span style="color: #2aa1ae; background-color: #ecf3ec;">edit package.json to add test command</span>
npm test -- test/my_tests.js
</pre>
</div>

<p>
The contents of <code>my_tests.js</code> should be
</p>

<div class="org-src-container">
<pre class="src src-javascript"><span style="color: #3a81c3;">const</span> <span style="color: #715ab1;">assert</span> = require<span style="color: #3a81c3;">(</span><span style="color: #2d9574;">'assert'</span><span style="color: #3a81c3;">)</span>;
<span style="color: #3a81c3;">const</span> <span style="color: #715ab1;">request</span> = require<span style="color: #3a81c3;">(</span><span style="color: #2d9574;">'supertest'</span><span style="color: #3a81c3;">)</span>;
<span style="color: #3a81c3;">const</span> <span style="color: #715ab1;">cheerio</span> = require<span style="color: #3a81c3;">(</span><span style="color: #2d9574;">'cheerio'</span><span style="color: #3a81c3;">)</span>;
<span style="color: #3a81c3;">const</span> <span style="color: #715ab1;">server</span> = require<span style="color: #3a81c3;">(</span><span style="color: #2d9574;">'../server'</span><span style="color: #3a81c3;">)</span>;

describe<span style="color: #3a81c3;">(</span><span style="color: #2d9574;">'server'</span>, <span style="color: #6c3163;">()</span> =&gt; <span style="color: #6c3163;">{</span>

    it<span style="color: #2d9574;">(</span><span style="color: #2d9574;">'should return HTML with expected title'</span>, <span style="color: #67b11d;">(</span>done<span style="color: #67b11d;">)</span> =&gt; <span style="color: #67b11d;">{</span>
        request<span style="color: #b1951d;">(</span>server<span style="color: #b1951d;">)</span>
            .get<span style="color: #b1951d;">(</span><span style="color: #2d9574;">'/'</span><span style="color: #b1951d;">)</span>
            .expect<span style="color: #b1951d;">(</span><span style="color: #4e3163;">200</span><span style="color: #b1951d;">)</span>
            .expect<span style="color: #b1951d;">(</span><span style="color: #2d9574;">'Content-Type'</span>, <span style="color: #2d9574;">/html/</span><span style="color: #b1951d;">)</span>
            .end<span style="color: #b1951d;">(</span><span style="color: #3a81c3;">(</span>err, res<span style="color: #3a81c3;">)</span> =&gt; <span style="color: #3a81c3;">{</span>
                assert<span style="color: #6c3163;">(</span>res.text.includes<span style="color: #2d9574;">(</span><span style="color: #2d9574;">'Home'</span><span style="color: #2d9574;">)</span>, <span style="color: #2d9574;">'Has expected title'</span><span style="color: #6c3163;">)</span>;
                done<span style="color: #6c3163;">()</span>;
            <span style="color: #3a81c3;">}</span><span style="color: #b1951d;">)</span>;
    <span style="color: #67b11d;">}</span><span style="color: #2d9574;">)</span>;

    it<span style="color: #2d9574;">(</span><span style="color: #2d9574;">'should return page as HTML with expected title'</span>, <span style="color: #67b11d;">(</span>done<span style="color: #67b11d;">)</span> =&gt; <span style="color: #67b11d;">{</span>
        request<span style="color: #b1951d;">(</span>server<span style="color: #b1951d;">)</span>
            .get<span style="color: #b1951d;">(</span><span style="color: #2d9574;">'/asteroids'</span><span style="color: #b1951d;">)</span>
            .expect<span style="color: #b1951d;">(</span><span style="color: #4e3163;">200</span><span style="color: #b1951d;">)</span>
            .expect<span style="color: #b1951d;">(</span><span style="color: #2d9574;">'Content-Type'</span>, <span style="color: #2d9574;">/html/</span><span style="color: #b1951d;">)</span>
            .end<span style="color: #b1951d;">(</span><span style="color: #3a81c3;">(</span>err, res<span style="color: #3a81c3;">)</span> =&gt; <span style="color: #3a81c3;">{</span>
                assert<span style="color: #6c3163;">(</span>res.text.includes<span style="color: #2d9574;">(</span><span style="color: #2d9574;">'Asteroids'</span><span style="color: #2d9574;">)</span>, <span style="color: #2d9574;">'Has expected title'</span><span style="color: #6c3163;">)</span>;
                done<span style="color: #6c3163;">()</span>;
            <span style="color: #3a81c3;">}</span><span style="color: #b1951d;">)</span>;
    <span style="color: #67b11d;">}</span><span style="color: #2d9574;">)</span>;

    it<span style="color: #2d9574;">(</span><span style="color: #2d9574;">'should 404 for other pages'</span>, <span style="color: #67b11d;">(</span>done<span style="color: #67b11d;">)</span> =&gt; <span style="color: #67b11d;">{</span>
        request<span style="color: #b1951d;">(</span>server<span style="color: #b1951d;">)</span>
            .get<span style="color: #b1951d;">(</span><span style="color: #2d9574;">'/other'</span><span style="color: #b1951d;">)</span>
            .expect<span style="color: #b1951d;">(</span><span style="color: #4e3163;">404</span><span style="color: #b1951d;">)</span>
            .end<span style="color: #b1951d;">(</span><span style="color: #3a81c3;">(</span>err, res<span style="color: #3a81c3;">)</span> =&gt; <span style="color: #3a81c3;">{</span>
                assert<span style="color: #6c3163;">(</span>res.text.includes<span style="color: #2d9574;">(</span><span style="color: #2d9574;">'ERROR'</span><span style="color: #2d9574;">)</span>, <span style="color: #2d9574;">'Has expected error message'</span><span style="color: #6c3163;">)</span>;
                done<span style="color: #6c3163;">()</span>;
            <span style="color: #3a81c3;">}</span><span style="color: #b1951d;">)</span>;
    <span style="color: #67b11d;">}</span><span style="color: #2d9574;">)</span>;

    it<span style="color: #2d9574;">(</span><span style="color: #2d9574;">'should have the correct headings'</span>, <span style="color: #67b11d;">(</span>done<span style="color: #67b11d;">)</span> =&gt; <span style="color: #67b11d;">{</span>
        request<span style="color: #b1951d;">(</span>server<span style="color: #b1951d;">)</span>
            .get<span style="color: #b1951d;">(</span><span style="color: #2d9574;">'/'</span><span style="color: #b1951d;">)</span>
            .expect<span style="color: #b1951d;">(</span><span style="color: #2d9574;">'Content-Type'</span>, <span style="color: #2d9574;">/html/</span><span style="color: #b1951d;">)</span>
            .expect<span style="color: #b1951d;">(</span><span style="color: #4e3163;">200</span><span style="color: #b1951d;">)</span>
            .end<span style="color: #b1951d;">(</span><span style="color: #3a81c3;">(</span>err, res<span style="color: #3a81c3;">)</span> =&gt; <span style="color: #3a81c3;">{</span>
                <span style="color: #3a81c3;">const</span> <span style="color: #715ab1;">tree</span> = cheerio.load<span style="color: #6c3163;">(</span>res.text<span style="color: #6c3163;">)</span>;
                assert.equal<span style="color: #6c3163;">(</span>tree<span style="color: #2d9574;">(</span><span style="color: #2d9574;">'h1'</span><span style="color: #2d9574;">)</span>.length, <span style="color: #4e3163;">1</span>, <span style="color: #2d9574;">'Correct number of headings'</span><span style="color: #6c3163;">)</span>;
                assert.equal<span style="color: #6c3163;">(</span>tree<span style="color: #2d9574;">(</span><span style="color: #2d9574;">'h1'</span><span style="color: #2d9574;">)</span>.text<span style="color: #2d9574;">()</span>, <span style="color: #2d9574;">'Home'</span>, <span style="color: #2d9574;">'Correct heading text'</span><span style="color: #6c3163;">)</span>;
                done<span style="color: #6c3163;">()</span>;
            <span style="color: #3a81c3;">}</span><span style="color: #b1951d;">)</span>;
    <span style="color: #67b11d;">}</span><span style="color: #2d9574;">)</span>;

<span style="color: #6c3163;">}</span><span style="color: #3a81c3;">)</span>;
</pre>
</div>

<p>
The scipt command in <code>package.json</code> should look like
</p>

<div class="org-src-container">
<pre class="src src-json"><span style="color: #3a81c3;">"scripts"</span>: <span style="color: #3a81c3;">{</span>
  <span style="color: #3a81c3;">"test"</span>: <span style="color: #2d9574;">"mocha"</span>
<span style="color: #3a81c3;">}</span>
</pre>
</div>

<p>
The contents of <code>standalone.js</code> should be
</p>

<div class="org-src-container">
<pre class="src src-javascript"><span style="color: #3a81c3;">const</span> <span style="color: #715ab1;">server</span> = require<span style="color: #3a81c3;">(</span><span style="color: #2d9574;">'./server'</span><span style="color: #3a81c3;">)</span>;
<span style="color: #3a81c3;">const</span> <span style="color: #715ab1;">PORT</span> = <span style="color: #4e3163;">3418</span>;
server.listen<span style="color: #3a81c3;">(</span>PORT,
              <span style="color: #6c3163;">()</span> =&gt; <span style="color: #6c3163;">{</span> console.log<span style="color: #2d9574;">(</span><span style="color: #2d9574;">`listening on port ${PORT}...`</span><span style="color: #2d9574;">)</span> <span style="color: #6c3163;">}</span><span style="color: #3a81c3;">)</span>;
</pre>
</div>

<p>
The contents of <code>server.js</code> should be
</p>

<div class="org-src-container">
<pre class="src src-javascript"><span style="color: #3a81c3;">const</span> <span style="color: #715ab1;">express</span> = require<span style="color: #3a81c3;">(</span><span style="color: #2d9574;">'express'</span><span style="color: #3a81c3;">)</span>;

<span style="color: #3a81c3;">let</span> <span style="color: #715ab1;">app</span> = express<span style="color: #3a81c3;">()</span>;

app.get<span style="color: #3a81c3;">(</span><span style="color: #2d9574;">'/'</span>, <span style="color: #6c3163;">(</span>req, res, next<span style="color: #6c3163;">)</span> =&gt; <span style="color: #6c3163;">{</span>
    res.status<span style="color: #2d9574;">(</span><span style="color: #4e3163;">200</span><span style="color: #2d9574;">)</span>.send<span style="color: #2d9574;">(</span><span style="color: #2d9574;">'&lt;html&gt;&lt;body&gt;&lt;h1&gt;Home&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;'</span><span style="color: #2d9574;">)</span>;
<span style="color: #6c3163;">}</span><span style="color: #3a81c3;">)</span>;

app.get<span style="color: #3a81c3;">(</span><span style="color: #2d9574;">'/asteroids'</span>, <span style="color: #6c3163;">(</span>req, res, next<span style="color: #6c3163;">)</span> =&gt; <span style="color: #6c3163;">{</span>
    res.status<span style="color: #2d9574;">(</span><span style="color: #4e3163;">200</span><span style="color: #2d9574;">)</span>.send<span style="color: #2d9574;">(</span><span style="color: #2d9574;">'&lt;html&gt;&lt;body&gt;&lt;h1&gt;Asteroids&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;'</span><span style="color: #2d9574;">)</span>;
<span style="color: #6c3163;">}</span><span style="color: #3a81c3;">)</span>;

app.use<span style="color: #3a81c3;">(</span><span style="color: #6c3163;">(</span>req, res, next<span style="color: #6c3163;">)</span> =&gt; <span style="color: #6c3163;">{</span>
    res
        .status<span style="color: #2d9574;">(</span><span style="color: #4e3163;">404</span><span style="color: #2d9574;">)</span>
        .send<span style="color: #2d9574;">(</span><span style="color: #2d9574;">`&lt;html&gt;&lt;body&gt;&lt;p&gt;ERROR: ${req.url} not found&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;`</span><span style="color: #2d9574;">)</span>;
<span style="color: #6c3163;">}</span><span style="color: #3a81c3;">)</span>;

module.exports = app;
</pre>
</div>

<p>
Running <code>npm test -- test/my_tests.js</code> should produce the following output
</p>

<pre class="example">
&gt; testing@1.0.0 test
&gt; mocha "test/my_tests.js"



  server
    ✔ should return HTML with expected title
    ✔ should return page as HTML with expected title
    ✔ should 404 for other pages
    ✔ should have the correct headings


  4 passing (45ms)

</pre>
</div>
</div>

<div id="outline-container-org6a11c37" class="outline-3">
<h3 id="org6a11c37">Exercises</h3>
<div class="outline-text-3" id="text-org6a11c37">
</div>
<div id="outline-container-orgd166119" class="outline-4">
<h4 id="orgd166119">Not Done</h4>
<div class="outline-text-4" id="text-orgd166119">
<p>
The test will fail (due to timing out) because it does not know that the test
has finished.
</p>
</div>
</div>

<div id="outline-container-org4f084e6" class="outline-4">
<h4 id="org4f084e6"><span class="todo TODO">TODO</span> Adding Tests</h4>
<div class="outline-text-4" id="text-org4f084e6">
<p>
A sensible test for the asteroids application would be to ensure that some data
is returned from the NASA API and that the dates on this are sensible. While
testing the dates occur in the correct order (with <code>new Date(...)</code> and
<code>date.getTime()</code>) is simple enough, getting Mocha to wait for the data to return
is a real pain.
</p>
</div>
</div>

<div id="outline-container-org62f403c" class="outline-4">
<h4 id="org62f403c"><span class="todo TODO">TODO</span> Lifecycle</h4>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Alex Zarebski</p>
<p class="date">Created: 2022-04-15 Fri 12:30</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
